# Activity Summary for 10/2/2026

## 9:14:12
The code changes primarily occurred between February 2nd and February 5th, 2026, focusing on two main areas: Smart TV application development and image handling utilities.

### File-Specific Updates:

*   **`c:\Users\Usuario\Documents\Trabajo\3cat_pro\gateway\js\app.js` (2/2/2026, 14:16:27)**
    *   This file contains a JavaScript `init()` function for a WebOS gateway application.
    *   It determines the `connectionmanager` service (WebOS vs. Palm) and `REMOTE` URL based on the `sdkVersion`.
    *   It checks for internet connection availability and redirects to `REMOTE + query` if connected.
    *   If no internet, it displays an alert and sets up a keydown listener for the `VK_BACK` button to exit the platform.
    *   It also subscribes to connection status changes to redirect once connectivity is restored.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\infoGroup\index.jsx` (2/2/2026, 16:31:34)**
    *   This React component (`InfoGroup`) is responsible for displaying media information such as episode/season counts, publication dates, and live/upcoming event details.
    *   It includes logic for formatting dates (`formatDateToCatalan`, `formatFullDateWithLabelUTC`, `formatCatalanDayMonthWithLabelUTC`).
    *   A commented-out section (`// JIRA CCMA-2104`) indicates the removal of "A partir del" publication date functionality.
    *   It conditionally renders `SeasonsCount` and `EpisodeCount` based on `item` properties and `LIVE_REFRESH_INTERVAL` from settings.
    *   It also handles the display of expiration information (`showExpiration`) and determines image types (`logoImage`, `channelLogo`).
    *   Extensive conditional logic is used to determine the `title` and `description` to display, considering default episodes, live streams, audio, and linked collections.
    *   Logic for `rating_tags` is added to filter out empty labels.
    *   New props like `showAgeRating` were added.
    *   `useExternalEmission` hook is used for external content indicators (`isLiveExternal`, `whiteTagText`).
    *   Rendering includes `MediaTag`, `MediaTitle`, `AgeRateImg`, `Duration`, `MediaSmallDescription`, and `MediaFeatures`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\mediaTitle\styles.scss` (2/2/2026, 16:33:36)**
    *   Styling for `.mediaTitle` was adjusted, specifically updating font-size and font-weight for different title types (`.title_program`, `.live`, `.isLive_or_upcoming_event`, `.stream`, `.menu_detail`, `.external`).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\styles.scss` (2/2/2026, 16:39:57)**
    *   Added styles for `.platform-logo` within `.portraitItem` to display external platform logos, including `.externalLogo` and `.externalIcon`.
    *   The `:hover` and `.focused` states were updated with box-shadow, border-color, and outline properties, specifically using `$base-color-3cat-red`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\keyboard\styles.scss` (2/2/2026, 16:56:08 & 2/2/2026, 17:09:25)**
    *   Initial styling for a virtual keyboard (`.keyboard`, `.keyboard-row`, `.keyboard-key`) was added, defining layout, colors, font sizes, and button dimensions.
    *   Specific styles for different key sizes (`.SMALL`, `.MEDIUM`, `.LARGE`) and icons (`.icon-BACKSPACE`, `.icon-SPACE_BAR`, `.icon-RETURN`) were included.
    *   The `.focused` state styling was defined with a box-shadow and a red border (`#dc2c52`).
    *   A `:hover` state was added later, mirroring the `.focused` state with a red box-shadow and border.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js` (2/2/2026, 17:08:44 & 5/2/2026, 13:32:40)**
    *   This file manages generic keyboard navigation for Smart TV platforms.
    *   It defines `window.AppGlobal.KeyMemory` for tracking key combinations (e.g., "979899" for enabling ads).
    *   `IinitKeyboardNavigation_SmartTV()` sets up a `onKeyDownHandler` that prevents default behavior, throttles key events, and dispatches custom navigation events.
    *   It handles common key codes (up, down, left, right, enter, back) and platform-specific codes for WebOS and Tizen (play, pause, stop, rewind, fast forward).
    *   The back key (`VK_BACK`, `10009`, `461`, `88`, `VK_ESCAPE`, `VK_BACK_SPACE`) logic was updated to check `window.isUserModalVisible` before calling `goBackHistory` or `openExitAppModal`.
    *   **Significant change (5/2/2026, 13:32:40):** Comments for `e.preventDefault(); e.stopPropagation();` were added at the beginning of `onKeyDownHandler` and `THROTTLE_MS` was commented out (line `if (now - lastTs < THROTTLE_MS) return;`). Also, `dispatchRewindEvent()` and `dispatchFastForwardEvent()` calls were commented out within the platform-specific `switch` statements, indicating a temporary disabling or refactoring of these functionalities.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\sideMenu\index.jsx` (2/2/2026, 17:36:09 & 2/2/2026, 17:36:22)**
    *   This React component (`SideMenu`) manages the application's side navigation.
    *   It dynamically generates L1 and L2 menu data based on user type (kid/adult) and settings.
    *   Includes logic for refreshing selected menu options, handling user-related actions (change user, exit app), and navigating to different routes.
    *   A `window.__isEntry` assignment was added and then slightly adjusted (from `window.__isEntry = isMenuVisible;` to `window.__isEntry = isMenuVisible;`). This suggests a change in how the entry point or menu visibility is tracked.
    *   The `manageFocused` function logic was updated to ensure correct focusing behavior when entering/leaving the menu, especially for 'explora' and 'userside' options.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\onboarding\usersScreen\index.jsx` (multiple timestamps between 2/2/2026, 17:45:11 and 2/2/2026, 18:14:59)**
    *   This React component (`UsersScreen`) allows users to select or add profiles.
    *   Initial changes related to `window.__isEntry`: it was first set from `location.state?.isEntry || false`, then changed to `true` (2/2/2026, 18:05:33 & 2/2/2026, 18:06:49), and then commented out while still setting `window.__foceEntry = true;` with a cleanup in `useEffect` (2/2/2026, 18:14:59). This suggests an evolving approach to managing the "entry" state of the application for navigation purposes.
    *   The `onBackClick` prop for `PageHead` was consistently set to `window.AppGlobal.Actions.openExitAppModal`, replacing conditional logic.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\goBackHistory.js` (2/2/2026, 18:15:16)**
    *   The `goBackHistory` utility function was updated to include `window.__foceEntry` in its condition for calling `callBackFunc()` (which opens the exit app modal).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx` (multiple timestamps between 2/2/2026, 18:50:50 and 2/2/2026, 19:14:36)**
    *   The main `App` component defines routing and context providers.
    *   Multiple minor modifications to the `openExitAppModal` function, including:
        *   Initially, `window.AppMenu?.exitMenu?.();` was called, followed by setting `window.isUserModalVisible = true; nav.storedFocus = nav.getCurrentId(); setExitModal(ModalTypes.EXIT);`.
        *   Later, the lines setting `window.isUserModalVisible`, `nav.storedFocus`, and `setExitModal` were commented out in one version (2/2/2026, 18:51:35), suggesting an attempt to remove or temporarily disable the exit modal.
        *   This was quickly reverted, re-enabling the lines (2/2/2026, 18:54:07), and then later `window.AppMenu.manageFocused?.();` was added (2/2/2026, 18:52:39), which was subsequently removed (2/2/2026, 19:14:36). This indicates active iteration on the exit application flow and focus management.
    *   The `BrowserRouter` was updated to include `future={{v7_startTransition: true, v7_relativeSplatPath: true}}` props, suggesting an upgrade or preparation for `react-router-dom` v7.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pro\config.xml` (3/2/2026, 13:24:24, 5/2/2026, 10:47:12, 5/2/2026, 11:41:17)**
    *   The `id` attribute of the `<widget>` element changed from `"http://tizen.tv3.ccma.cat.qa"` to `"http://tizen.qa.ccma.cat"`.
    *   The `id` attribute of the `<tizen:application>` element changed from `"PzkKxRdFT6.TV3.qa"` to `"PzkKxRdFT6qa.TV3"`. These changes indicate adjustments to application identifiers, possibly related to different deployment environments (e.g., QA).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\roundItem\index.jsx` (multiple timestamps between 4/2/2026, 11:36:24 and 4/2/2026, 14:01:29)**
    *   This React component (`RoundItem`) renders circular items in rows.
    *   Initial logic for `image` and `type` determination was based on `item.images` and `isKidsProfile`.
    *   **Significant changes regarding `isKidsProfile` and `isBigRound`:**
        *   Initially, `isKidsProfile` was used to find `round` image format and set `type: 'kids-round'`. (4/2/2026, 11:41:47)
        *   It then looked for `big-round` for `isKidsProfile` (4/2/2026, 12:08:06).
        *   Later, the `isKidsProfile` logic was removed from the `useMemo` that determines `image` and `type`, implying that the `type` for kids might be handled differently or simplified (4/2/2026, 12:21:39).
        *   Subsequently, a new prop `isBigRound` was introduced, which impacts the `image` and `type` logic, looking for 'round' images and setting `type: 'big-round'` when true (4/2/2026, 13:44:59).
        *   The `className` was updated to use `(type === 'round' || type === 'big-round') ? 'round-image' : ''` (4/2/2026, 13:45:24).
        *   The `data-nav-fixed-focus-shape` attribute was made dynamic based on `isBigRound` (4/2/2026, 14:01:29).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\roundItem\styles.scss` (4/2/2026, 13:53:09)**
    *   New styles were added for `.biground_row .roundElement` to adjust width, height, and margin for larger round items. The `.round-image` class styling was also updated.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\roundItem\styles.kids.scss` (multiple timestamps between 4/2/2026, 12:22:36 and 4/2/2026, 13:54:47)**
    *   This file was frequently updated, primarily to define `.roundElement` styles specific to `kid-mode`.
    *   It consistently sets `background-color` to `$base-color-3cat-kid-bright-purple` and often includes a matching `border` style. Some intermediate changes included adding/removing `border` and `outline` properties, indicating fine-tuning of the focused/hovered appearance for kid mode.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\fixedFocus\fixedFocus.kids.scss` (multiple timestamps between 4/2/2026, 12:26:49 and 4/2/2026, 14:14:40)**
    *   This stylesheet defines the `fixed-focus` styling for kid mode.
    *   It consistently sets `box-shadow` and `border-color` to `$base-color-3cat-kid-light-purple` for the `.inner` element.
    *   There were several iterations on the `outline` property for `.inner` (sometimes `0px`, sometimes `3px solid $base-color-3cat-kid-light-purple`).
    *   Styles for `&.round` focus shape were added, removed, and re-added.
    *   **Significant change (4/2/2026, 14:14:40):** The `&.round, &.bigRound` rule was added, setting `outline: 0px;` for these specific shapes in kid mode, indicating that round focus elements in kid mode should not have an explicit outline.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\rows\rowUtils.js` (4/2/2026, 12:01:27 & 4/2/2026, 12:01:36)**
    *   The `getRowkind` function, which determines the type of row, was updated.
    *   Specifically, the condition for a `ROUND` row was changed from `rowData.format === 'round' || rowData.format === 'square-mini'` to `rowData.format === 'round' || rowData.format === 'square_mini'`. This is a minor correction from `square-mini` to `square_mini` (underscore instead of hyphen).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\rows\genericRow\index.jsx` (multiple timestamps between 4/2/2026, 12:02:26 and 4/2/2026, 13:22:28)**
    *   This React component (`GenericRow`) renders various types of content rows.
    *   The `getRowElement` function was updated to map `SQUARE_MINI` to `SquareItem`.
    *   The `getShowAllElementsFocusShape` function was updated to map `SQUARE_MINI` to `'square'`.
    *   A line `// {isKidsProfile && <div className="roundItemTitle">{item.title}</div>}` was temporarily added inside the main return block and then removed, suggesting an experiment with displaying `item.title` directly on the row for kid profiles (4/2/2026, 12:49:54 to 4/2/2026, 12:54:35).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\rows\roundRow\index.jsx` (multiple timestamps between 4/2/2026, 12:27:53 and 4/2/2026, 13:42:39)**
    *   This React component (`RoundRow`) renders a row of `RoundItem`s.
    *   Initially included `styles.kids.scss` import, then removed it (4/2/2026, 12:30:58), and re-added it (4/2/2026, 13:35:58).
    *   **Key changes related to `isKidsProfile` and `isBigRound`:**
        *   The `textAlign` style for `roundItemWrapper` was initially conditional on `isKidsProfile`, then removed, and later made conditional on `isBigRound`.
        *   The `RoundItem` component started receiving an `isKidsProfile` prop, which was then replaced by `isBigRound`.
        *   A conditional `roundItemTitle` was added to display the item title below the `RoundItem` when `isBigRound` is true (4/2/2026, 13:35:58).
        *   The main `div`'s `className` became dynamic, using `biground_row` or `round_row` based on `isBigRound` (4/2/2026, 13:38:35).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\rows\roundRow\styles.scss` (4/2/2026, 12:28:04 & 4/2/2026, 13:40:37)**
    *   Initial styling defined fixed `height` for `.round_row`.
    *   **Significant update (4/2/2026, 13:40:37):** Introduced `.biground_row` with a larger `height`, and refactored common styles for both `.round_row` and `.biground_row`. Also added styles for `.roundItemTitle` for typography and alignment.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\index.jsx` (multiple timestamps between 4/2/2026, 13:25:55 and 4/2/2026, 13:34:44)**
    *   This React component (`Page`) handles displaying content pages, including home screens and other data-driven views.
    *   The `filterChildren` function, responsible for filtering rows, added a condition to exclude `user_row` for `UserType.KID`. This is a key change for kid profiles.
    *   The component also updated its `useEffect` hooks for handling menu navigation (`menu:navigate`) and user changes (`evChangeUser`), specifically resetting virtualization, fixed focus, and page data.
    *   The `getHomeData` and `getPageData` functions fetch content, and `getHomeData` now uses `settingsData?.child_home_id` or `settingsData?.home_id` based on `activeUser?.type`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\externalContentModal\index.jsx` (4/2/2026, 15:12:08 & 4/2/2026, 15:17:01)**
    *   This React component (`ExternalContentModal`) displays a modal for external content.
    *   The `popupLeft` class now dynamically includes `partner` if `isPartner` is true, affecting its layout.
    *   The `generateImageData` call now passes `isPartner` to determine image dimensions, specifically adjusting height for partner content (4/2/2026, 15:17:01).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\externalContentModal\styles.scss` (4/2/2026, 15:15:02)**
    *   Added styles for `.popupLeft.partner` to adjust its height within the modal.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\libs\img.js` (multiple timestamps between 5/2/2026, 9:38:25 and 5/2/2026, 9:46:57)**
    *   This utility file handles image processing and URL generation.
    *   The `NOT_ALLOWED_FORMATS` array for `getBestImage` and `getBestImageV2` was updated.
    *   Specifically, `square-round` was added to `NOT_ALLOWED_FORMATS` for `getBestImageV2` at one point (5/2/2026, 9:38:51) and then removed from the general `NOT_ALLOWED_FORMATS` but kept in the `getBestImageV2` local `notAllowedFomats` array.
    *   `big-round` was also added to the `notAllowedFomats` array within `getBestImageV2` for landscape aspect ratio (5/2/2026, 9:44:04).
    *   The `NOT_ALLOWED_FORMATS` array for `getBestImage` was updated, removing a duplicate 'round' entry and keeping 'square-round' as disallowed globally for `getBestImage` at one point. This was then reverted back (5/2/2026, 9:46:50).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.kids.scss` (4/2/2026, 14:18:09)**
    *   New styling added for `.V-SCROLLABLE:not(.fixed) .focused` in `kid-mode`, setting box-shadow, border-color, and outline to `$base-color-3cat-kid-light-purple`.

### Patterns and Recurring Elements:

1.  **Kid Mode / User Type Differentiation:** A significant recurring theme is the introduction and refinement of "kid-mode" or `UserType.KID` specific logic and styling. This is evident in:
    *   `SideMenu`: dynamic menu generation based on user type.
    *   `UsersScreen`: logic for selecting "Super3" (kids profile).
    *   `Page`: filtering rows and selecting home data based on `activeUser?.type`.
    *   `RoundItem`: conditional rendering and styling based on `isKidsProfile` and `isBigRound`.
    *   SCSS files (`styles.kids.scss`, `fixedFocus.kids.scss`, `App.kids.scss`): extensive use of the `.kid-mode` class to apply distinct visual styles (colors, box-shadows, borders) for focused elements, round items, and general scrollables.
2.  **Focus Management and Navigation:**
    *   Heavy reliance on `nav.focusById()` and `registerFocusAction`/`unregisterFocusAction` for managing element focus in Smart TV interfaces.
    *   Use of `data-block-focus-up`, `data-block-focus-down`, `data-block-focus-left`, `data-block-focus-right` attributes for explicit navigation control.
    *   Frequent updates to `fixed-focus` styling in SCSS files across various components (`RoundItem`, `GenericRow`, `fixedFocus.scss`, `fixedFocus.kids.scss`).
3.  **Exit Application Flow:** Multiple iterations in `App.jsx` and `platform\generic.js` to control how the application exits, especially concerning modals (`ExitAppModal`) and user states (kid vs. adult, logged in vs. guest). The `window.__isEntry` and `window.__foceEntry` flags suggest a complex state management for initial load and back navigation behavior.
4.  **Image Handling Refinement:** `src\libs\img.js` shows continuous adjustments to `NOT_ALLOWED_FORMATS` and the logic within `getBestImage` and `getBestImageV2`. This indicates ongoing work to optimize image selection and display based on aspect ratios, formats, and priorities, with special considerations for various item types and profiles (e.g., `big-round` images).
5.  **Platform-Specific Adaptations:** `platform\generic.js` demonstrates explicit handling for WebOS and Tizen platforms for keyboard input, and `App.jsx` uses `isHbbTV` for conditional rendering and routing. `gateway\js\app.js` is also platform-aware (WebOS vs. Palm).
6.  **React Component Structure:** The use of `memo`, `useMemo`, `useEffect`, and `useRef` is consistent across React components (`infoGroup\index.jsx`, `sideMenu\index.jsx`, `usersScreen\index.jsx`, `roundItem\index.jsx`, `genericRow\index.jsx`, `page\index.jsx`, `App.jsx`, `externalContentModal\index.jsx`), indicating a functional component-based architecture with performance optimizations.
7.  **SCSS for Styling:** A consistent pattern of using SCSS for styling, with separate files for "kids" specific styles (`.kids.scss`), reflecting a modular and themed approach to UI design.
8.  **API Interaction:** Components like `Page` actively interact with `ApiHome`, `ApiGetNowPlayingSelector`, `ApiGetNowPlaying`, and `ApiContent_NO_PROMISE`, managing loading states, errors, and authentication.