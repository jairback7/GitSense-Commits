# Activity Summary for 22/2/2026

## 2:19:20
This log primarily details updates to the `3cat_smarttv` application, focusing on core UI components, platform-specific integrations for Smart TVs, player functionality, and global application structure. The changes highlight a multi-platform approach (Tizen, WebOS, HbbTV) with a strong emphasis on media playback, dynamic content, and keyboard navigation.

### File-Specific Updates:

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\index.jsx`**
    *   **20/2/2026, 12:11:57:** Initial changes included hardcoding `live_refresh_interval` to `3000` (from an original `10000` or `settingsData`). A `useEffect` hook's cleanup function for `evChangeUser` event was incorrectly set to `document.addEventListener` instead of `removeEventListener`.
    *   **20/2/2026, 12:12:08:** The `live_refresh_interval` was reverted to its previous hardcoded value of `10000`. The `useEffect` cleanup error remained.
    *   **20/2/2026, 12:27:43:** The `live_refresh_interval` was finally updated to dynamically use `settingsData?.live_refresh_interval` with a fallback to `10000`, making it configurable. The `useEffect` cleanup bug persisted across all these changes.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\index.html`**
    *   **20/2/2026, 12:16:22:** Significant updates to the HTML structure and script imports. This included adding a `build-environment` meta tag, updating the Shaka player library to version `4.13.8`, integrating the Google IMA SDK (`ima3.js`), and introducing several module scripts for focus management (`navigable.js`, `scroll.js`), a custom console (`purple-console.min.js`), and QR code generation (`easy.qrcode.min.js`). New `div` elements for player components (`playerContainer`, `cueContainer`, `video-container`, `ad-container`) were added, indicating a restructured player setup.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`**
    *   **20/2/2026, 12:16:57:** This timestamp marks a major refactor of the application's root component. It introduced numerous React Context Providers for global state management (e.g., `AuthContext`, `SettingsContext`, `CapabilitiesContext`, `HighlightContext`), demonstrating a shift towards a more modular and context-driven architecture. Debugging tools (`DevNavMenu`, `DebugModalsLauncher`, `DebugConfigPane`, `DebugSessionSettingsPane`) and build information display (`BuildInfo` component) were integrated. The `App` component was split into `AppInner` to manage routing and modals, including platform-specific exit and logout flows. Custom `ajsrConsole` setup for enhanced logging was also introduced.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js`**
    *   **20/2/2026, 13:13:26:** This file received comprehensive updates for Tizen platform integration. It now includes functions to initialize the Tizen application (`initAppTizen`), listen for network state changes (`initNetworkStateListener`), manage screen saver behavior (`initScreenSaverHelpers` with `enableScreenSaver`/`disableScreenSaver`), and register extra Samsung remote control keys (media and numeric keys via `tizen.tvinputdevice.registerKey`). Additionally, functions for launching other Tizen apps (`launchAppTizen`) and opening the Samsung App Store (`openSamsungStore`) were added.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerLoader.jsx`**
    *   **20/2/2026, 18:52:39:** Significant enhancements to the media player loading logic. This involved fetching related content (`ApiRelated`), live stream parameters (`ApiGetLiveExtraParams`), and 'now playing' data (`ApiGetNowPlaying`). New state variables and refs were introduced to manage UI state, program data, live data, and start-over functionality. Subtitle styling functions (`setSubtitlesStyles`, `removeSubtitlesStyles`) were added, enabling dynamic adjustment based on user options. The ad `vmapUrl` construction was improved to replace macros with real values, supporting dynamic ad integration. Player lifecycle management was reinforced with `onCleanup` for proper player destruction and global state reset.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`**
    *   **20/2/2026, 18:58:23:** The `IinitKeyboardNavigation_SmartTV` function was introduced to standardize keyboard navigation across Smart TV platforms. It defined common key codes for navigation, action, and back/exit, as well as platform-specific media control keys for WebOS and Tizen. Numeric keys were mapped to debug actions like enabling/disabling player ads and displaying build info.
    *   **20/2/2026, 19:05:58:** `e.preventDefault()` and `e.stopPropagation()` were uncommented within the `onKeyDownHandler`, indicating a shift to explicitly control browser/platform default key behaviors and event propagation.
    *   **20/2/2026, 19:15:17:** `e.stopPropagation()` was commented out, suggesting that event propagation was intentionally allowed after preventing default actions.
    *   **20/2/2026, 19:21:43:** `e.stopPropagation()` was moved to the very end of the `onKeyDownHandler` function, ensuring it's the last action in the event handler chain.
    *   **20/2/2026, 19:25:16:** No functional changes were observed in this entry, the code was identical to the previous timestamp.

### Patterns and Recurring Elements:

*   **Platform-Specific Development:** A clear pattern of developing and integrating features specifically for Tizen, WebOS, and HbbTV platforms is evident, particularly in keyboard handling, player control, and core application initialization.
*   **Global State Management (`window.AppGlobal`):** The application heavily relies on a global `window.AppGlobal` object to store and access application-wide state, player instances, and action functions, acting as a central hub for inter-component communication.
*   **Debugging Tools and Logging:** Extensive use of a custom `ajsrConsole` and conditional rendering of debug information (`BuildInfo`, `DebugModalsLauncher`) suggests a robust debugging environment for Smart TV development.
*   **Player Functionality Evolution:** Consistent updates across `index.html`, `playerLoader.jsx`, `tizen.js`, and `generic.js` indicate ongoing development and refinement of the media player, including support for live content, ads, subtitles, and hardware key integration.
*   **React Context API Adoption:** The `App.jsx` changes showcase a modern React approach using the Context API to manage various application concerns (authentication, settings, capabilities), promoting better state separation and reusability.
*   **Keyboard Navigation Refinement:** The iterative changes in `src\platform\generic.js` regarding `e.preventDefault()` and `e.stopPropagation()` reflect a meticulous tuning process for handling remote control inputs and ensuring precise user interaction.
*   **Live Content Integration:** Dedicated logic for fetching and managing live broadcast data, including refresh intervals and "now playing" information, is present in `page/index.jsx` and `playerLoader.jsx`.
*   **Recurring `useEffect` Cleanup Bug:** A minor but persistent bug in `src\views\page\index.jsx` involves the `useEffect` cleanup function incorrectly using `document.addEventListener` instead of `document.removeEventListener`, which could lead to memory leaks.

## 7:21:13
The code changes primarily involve updates to a React application for Smart TVs, focusing on page content, platform-specific integrations, player functionality, and keyboard event handling.

### File-Specific Updates:

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\index.jsx`**
    *   **20/2/2026, 12:11:57**: The `live_refresh_interval` variable was temporarily hardcoded to `3000`. This file defines a `Page` React component responsible for fetching and displaying home or content data, managing live content updates, and filtering content based on user type (e.g., kid) and platform capabilities (e.g., live streaming support). It integrates with numerous contexts for authentication, settings, options, and analytics. A potential bug exists in a `useEffect` cleanup where `document.addEventListener` is called instead of `removeEventListener` for `evChangeUser`.
    *   **20/2/2026, 12:12:08**: `live_refresh_interval` was reverted to a hardcoded `10000`, removing the previous `3000` value.
    *   **20/2/2026, 12:27:43**: `live_refresh_interval` was set to dynamically fetch from `settingsData?.live_refresh_interval` or default to `10000`, restoring the intended configurable behavior.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\index.html`**
    *   **20/2/2026, 12:16:22**: This file was updated to include various vendor JavaScript libraries crucial for the application, such as `underscore.js`, `visitorAPI.min.js`, `omniture.js`, `comscore.min.js`, `springstreams.min.js`, and `ima3.js` (Google IMA SDK for ads). Notably, the Shaka Player library was updated to `shaka.4.13.8.js`, suggesting a player version upgrade. It also defines global debugging functions and sets up essential HTML elements for the video player (`playerContainer`, `cueContainer`, `video-container`, `ad-container`).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`**
    *   **20/2/2026, 12:16:57**: This entry represents a snapshot of the main application component. It establishes the entire React application structure, including routing, a comprehensive set of React Context providers for global state management (e.g., authentication, settings, capabilities), and platform-specific initializations. It defines various routes for user onboarding, content browsing, playback, and configuration. Debugging components and global actions for modals (exit, logout) are also implemented, with adaptive behavior for HbbTV platforms.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js`**
    *   **20/2/2026, 13:13:26**: This file provides extensive integration with the Tizen operating system. It includes functions to retrieve device information, listen for `visibilitychange` and `evExitApplication` events for application lifecycle management, and monitor network state changes. Crucially, it manages the platform's screensaver, defines helpers to check and debug `webapis.appcommon` features, registers additional Samsung TV remote control keys (media controls, color keys, numeric keys), and offers functionality to launch other Tizen applications or the Samsung Store.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerLoader.jsx`**
    *   **20/2/2026, 18:52:39**: This React component is central to media playback. It fetches stream data, related content, and live program information, integrating with various application contexts. A significant change is the enhanced handling of advertising VMAP URLs: instead of merely stripping query parameters, it now dynamically replaces macros within the URL (e.g., `__platform__`, `__gdpr__`) using `build3catVmapUrl` for more precise ad targeting. The component also controls subtitles styling, manages the screensaver state (disabling during playback), and initializes the `PlayerController`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`**
    *   **20/2/2026, 18:58:23**: The `onKeyDownHandler` function had `e.preventDefault()` and `e.stopPropagation()` commented out, implying that default key actions and event propagation were initially allowed. This file implements generic keyboard navigation and key event handling for Smart TVs, including common navigation (up, down, left, right, enter), back/escape keys, and media control keys, with platform-specific handling for WebOS and Tizen. Debugging keys for ad control and build info display are also present.
    *   **20/2/2026, 19:05:58**: `e.preventDefault()` and `e.stopPropagation()` were uncommented in `onKeyDownHandler`, preventing default key actions and stopping event propagation.
    *   **20/2/2026, 19:15:17**: `e.stopPropagation()` was commented out again, while `e.preventDefault()` remained active. This allowed event propagation after preventing the default key action.
    *   **20/2/2026, 19:21:43**: `e.stopPropagation()` was moved to the very end of the `onKeyDownHandler` function, ensuring `e.preventDefault()` is called early while propagation is stopped as a final step.
    *   **20/2/2026, 19:25:16**: No functional code changes were introduced compared to the previous timestamp, indicating a potential re-save or minor non-functional adjustment.

### Patterns and Recurring Elements:

1.  **Platform Adaptability:** The codebase consistently uses `window.AppGlobal.platform` to tailor functionality (e.g., keyboard handling, player support, redirection) to specific Smart TV environments like Tizen, WebOS, and HbbTV.
2.  **Global State Management:** There's extensive use of React's Context API to manage and share global application state, including user authentication, settings, capabilities, and player options across various components.
3.  **Debugging and Logging:** Custom console logging (`ajsrConsole`) and standard `console.log` are widely employed, often with setup for colored output and aliases (`InitDevConsole` in `App.jsx`, `debugTizenAppCommon` in `tizen.js`).
4.  **Event Handling Refinement:** The frequent changes to `e.preventDefault()` and `e.stopPropagation()` in `generic.js` indicate ongoing fine-tuning of keyboard event handling to ensure proper interaction between application logic and native platform behaviors, especially for navigation and media controls.
5.  **Dynamic Content and Live Updates:** Features like `live_refresh_interval` and the `checkTimeFrame` function in `page/index.jsx` demonstrate a focus on managing and updating dynamic content, particularly for live streams.
6.  **Ad Integration:** Ad-related logic is present in both `index.html` (IMA SDK) and `playerLoader.jsx` (dynamic VMAP URL construction), with debugging controls available in `generic.js`.
7.  **Screensaver Control:** Interaction with platform-specific screensaver functionality (disabling during player activity, re-enabling afterward) is a recurring concern, as seen in `tizen.js` and `playerLoader.jsx`.

## 12:23:07
The code changes log primarily focuses on updates to the application's core functionality, including the main page view, overall application structure, player logic, and platform-specific integrations for Smart TVs. All recorded changes occurred on **20/2/2026**.

**File-Specific Updates:**

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\index.jsx`**
    *   **Timestamp: 20/2/2026, 12:11:57**
        The `live_refresh_interval` variable was initially hardcoded to `3000` milliseconds, with a commented-out fallback to `10000`.
    *   **Timestamp: 20/2/2026, 12:12:08**
        The `live_refresh_interval` was changed to `10000` milliseconds, indicating an adjustment to the live content refresh rate.
    *   **Timestamp: 20/2/2026, 12:27:43**
        The `live_refresh_interval` was made dynamic, now fetching its value from `settingsData?.live_refresh_interval` with a fallback to `10000` milliseconds, allowing for configurable refresh rates.
    *   This file, a core React component, handles page data fetching, live content refreshing, and user interaction, extensively using React hooks and global application contexts. It includes logic for filtering content based on user type (`KID`) and platform capabilities (e.g., `isLiveSupported`, `isShakaPlayerSupported`).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\index.html`**
    *   **Timestamp: 20/2/2026, 12:16:22**
        This update primarily involves changes to script inclusions and HTML structure.
        *   The Shaka Player library was updated from an older `4-7-1.js` version (commented out) to `shaka.4.13.8.js`.
        *   The Google IMA SDK (`imasdk.googleapis.com/js/sdkloader/ima3.js`) was added, suggesting enhanced ad capabilities.
        *   New utility scripts like `purple-console.min.js` and `easy.qrcode.min.js` were included.
        *   New `div` elements for player components (`playerContainer`, `cueContainer`, `video-container`, `ad-container`, `video`) were added, indicating a restructured player integration.
        *   An Adobe DTM script was commented out.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`**
    *   **Timestamp: 20/2/2026, 12:16:57**
        This update reveals a major architectural overhaul for the application.
        *   Numerous React Context Providers (e.g., `AuthContextProvider`, `SitecatalystProvider`, `SettingsContextProvider`, `CapabilitiesProvider`, `ParentalControlProvider`) were integrated to manage global state.
        *   A comprehensive routing system was implemented using `react-router-dom`, defining routes for various sections like `/home`, `/live`, `/catalog`, `/search`, and media playback (`/media/:id`, `/stream/:id`).
        *   Global `window.AppGlobal.Actions` were set up to handle app-wide events like opening exit modals.
        *   Debugging utilities, including `InitDevConsole` and a `BuildInfo` component, were added to display environment and build details.
        *   Platform-specific initialization (`Platform.initPlatform()`, `Platform.initKeyboard()`) was centralized.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js`**
    *   **Timestamp: 20/2/2026, 13:13:26**
        This file introduces extensive Tizen OS-specific integrations.
        *   `initAppTizen` manages application lifecycle events (visibility changes) and integrates with the Tizen `systeminfo` API.
        *   `initNetworkStateListener` handles network connectivity changes.
        *   Functions for screen saver control (`initScreenSaverHelpers`, `enableScreenSaver`, `disableScreenSaver`) using `webapis.appcommon.setScreenSaver` were implemented.
        *   `initExtraSamsungKeys` registers additional remote control keys (media controls, color keys, numeric keys) for a richer user experience.
        *   Utilities for launching other Tizen applications or opening the Samsung store (`launchAppTizen`, `openSamsungStore`) were added.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerLoader.jsx`**
    *   **Timestamp: 20/2/2026, 18:52:39**
        This update significantly enhances the media player loading and management.
        *   It orchestrates the fetching of stream data, related content, and live program information using several API calls.
        *   Manages player UI state, start-over functionality for live streams, and dynamically adjusts subtitle styles based on user options.
        *   Integrates an ad manager, specifically updating how VMAP URLs are built (`build3catVmapUrl`) to dynamically replace macros with real values, ensuring proper ad delivery.
        *   Utilizes a `PlayerController` for core playback functionality and extensively leverages React hooks and global contexts.
        *   Includes lifecycle management for the player, including cleanup on unmount and managing buffering indicators and screen saver states.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`**
    *   This file underwent several rapid iterations of changes related to keyboard event handling.
    *   **Timestamp: 20/2/2026, 18:58:23**
        Initial implementation of `IinitKeyboardNavigation_SmartTV` to set up a global `onKeyDownHandler`. This handler processes common navigation keys (arrows, enter, back) and platform-specific media keys (WebOS, Tizen). Numeric keys were introduced to toggle ads and display build info.
    *   **Timestamp: 20/2/2026, 19:05:58**
        `e.preventDefault()` and `e.stopPropagation()` were added at the beginning of the `onKeyDownHandler`, preventing default browser/system behavior and stopping event propagation for all handled keys.
    *   **Timestamp: 20/2/2026, 19:15:17**
        `e.stopPropagation()` was commented out from the beginning of `onKeyDownHandler`, allowing event propagation while still preventing default behavior.
    *   **Timestamp: 20/2/2026, 19:21:43**
        `e.stopPropagation()` was moved to the end of the `onKeyDownHandler`, ensuring default behavior is prevented and propagation is stopped only after all specific key actions are evaluated.
    *   **Timestamp: 20/2/2026, 19:25:16**
        `e.stopPropagation()` at the end of the `onKeyDownHandler` was commented out, reverting to a state where `e.preventDefault()` is active, but events are allowed to propagate up the DOM. These changes suggest ongoing debugging and fine-tuning of keyboard input handling.

**Patterns and Recurring Elements:**

*   **Platform Specificity:** A strong pattern of catering to different Smart TV platforms (Tizen, WebOS, HbbTV) is evident across multiple files, especially `generic.js` and `tizen.js`, for keyboard input, player actions, and system features like screen savers.
*   **React Context and Hooks:** The application heavily relies on React's Context API for global state management and various hooks (`useEffect`, `useRef`, `useState`) for component logic, indicating a modern React development approach.
*   **Global `window.AppGlobal` Object:** There's consistent use of a global `window.AppGlobal` object to expose application-wide functionalities, player controls, and platform utilities, allowing for centralized access and cross-component communication.
*   **Debugging and Logging:** Extensive use of `ajsrConsole.log` and `console.log` is present in almost all modified files, particularly within platform-specific code, highlighting an active debugging phase.
*   **Player-centric Development:** A significant portion of the changes revolves around the media player, including stream data fetching, ad integration, live program handling, and player control mechanisms, indicating a focus on robust media playback.
*   **Iterative Refinement:** The rapid sequence of changes in `generic.js` (keyboard event handling) demonstrates an iterative process of fine-tuning crucial functionalities, likely in response to testing across different target devices.
*   **Configuration and Settings:** The updates show a move towards more configurable options, such as the `live_refresh_interval` being pulled from `settingsData` and ad URLs being built dynamically.

## 16:36:51
The changes log details updates across several core components and platform-specific files of the 3cat Smart TV application.

### File-Specific Updates:

1.  **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\index.jsx`**
    *   **20/2/2026, 12:11:57:** The `Page` component, responsible for displaying home or content pages, initializes with a hardcoded `live_refresh_interval` of `3000`. It includes extensive logic for fetching home/page data, handling live content updates (`refreshLives`, `checkTimeFrame`), filtering child content based on capabilities (e.g., live support, Shaka player support, HbbTV external content), and user type (kid vs. adult). Error handling includes redirection for unauthorized users. The `useEffect` cleanup for the `evChangeUser` event listener erroneously re-attaches the listener instead of removing it.
    *   **20/2/2026, 12:12:08:** The `live_refresh_interval` variable is updated to `10000`, overriding the previous hardcoded value.
    *   **20/2/2026, 12:27:43:** The `live_refresh_interval` is made dynamic, now deriving its value from `settingsData?.live_refresh_interval` with a fallback to `10000`. The `useEffect` cleanup for `evChangeUser` still shows a re-attachment of the listener.

2.  **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\index.html`**
    *   **20/2/2026, 12:16:22:** This file defines the core HTML structure and initial script/style loading. It configures viewport settings, includes CSS for fonts and global styles, and imports numerous vendor JavaScript libraries (e.g., `underscore`, `visitorAPI`, `omniture`, `comscore`, `springstreams`, `shaka.4.13.8.js`, `ima3.js`). Debugging utilities (`purple-console.min.js`, `easy.qrcode.min.js`) and custom focus/navigation scripts (`navigable.js`, `scroll.js`) are also imported as modules. The `window.ajsrConsole` object is set up for enhanced logging. The body includes containers for a splash screen, player, video, and the main React application (`#root`).

3.  **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`**
    *   **20/2/2026, 12:16:57:** This is the main application component, orchestrating routing and context providers. It defines all application routes, distinguishing between public and private routes. Numerous context providers (Auth, Broadcast, History, Sitecatalyst, Capabilities, Options, Didomi, ParentalControl, Settings, Texts, Highlight, Virtualization) are wrapped around the main application logic. It initializes a custom development console, platform utilities, and includes a `BuildInfo` component for displaying debug information. Global actions for opening exit/logout modals are exposed via `window.AppGlobal.Actions`. The `handleOk` function manages logout and application exit, with specific logic for HbbTV and kid users.

4.  **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js`**
    *   **20/2/2026, 13:13:26:** This file encapsulates Tizen-specific platform integrations. It handles retrieving device information, manages application visibility changes (pausing/playing the player), and provides an `evExitApplication` event listener to exit the Tizen app. Network state changes are monitored, and screen saver functionality (`initScreenSaverHelpers`) is integrated using Tizen APIs. Crucially, it registers extra Samsung TV remote keys (media controls, numeric, color keys) and offers functions (`launchAppTizen`, `openSamsungStore`) to launch other applications or the Samsung app store.

5.  **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerLoader.jsx`**
    *   **20/2/2026, 18:52:39:** This React component is responsible for loading and controlling the media player. It fetches stream data and related content, handling distinctions between live, VOD, video, and audio streams. Subtitle styles are dynamically applied based on user options. A significant update involves the ad VMAP URL processing: it now dynamically builds the VMAP URL by replacing macros (`__platform__`, `__gdpr__`, etc.) with real values, a change from an earlier approach that merely stripped query parameters. It manages "now playing" data for live audio, and integrates screen saver management (disabling during playback, enabling after cleanup) and a buffering indicator.

6.  **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`**
    *   **20/2/2026, 18:58:23:** This file provides generic keyboard navigation and input handling for Smart TV platforms. The `onKeyDownHandler` manages global key presses, including navigation (Up, Down, Left, Right, Enter), back/exit functionality (which can trigger modals), and debug-related numeric keys. It defines `PLAYER_KEYS` to selectively handle player controls and includes platform-specific key code mappings for WebOS and Tizen. Initially, `e.preventDefault()` and `e.stopPropagation()` were commented out.
    *   **20/2/2026, 19:05:58:** `e.preventDefault()` and `e.stopPropagation()` are uncommented at the beginning of `onKeyDownHandler`, making all key events handled by this function prevent default browser actions and stop propagation immediately.
    *   **20/2/2026, 19:15:17:** `e.stopPropagation()` is commented out again at the beginning of `onKeyDownHandler`, while `e.preventDefault()` remains active.
    *   **20/2/2026, 19:21:43:** `e.stopPropagation()` is moved from the beginning of `onKeyDownHandler` to its end, ensuring `e.preventDefault()` is called first and propagation is stopped after the handler's logic.
    *   **20/2/2026, 19:25:16:** The code remains functionally identical to the previous timestamp, indicating a re-save or minor non-functional change.

### Patterns and Recurring Elements:

*   **Global State and Actions (`window.AppGlobal`):** There's a strong reliance on a global `window.AppGlobal` object to share player state (`window.AppGlobal.Player`), platform information (`window.AppGlobal.platform`, `window.AppGlobal.tvOsVersion`), actions (`window.AppGlobal.Actions.openExitAppModal`), and screen saver control (`window.AppGlobal.ScreenSaver`) across different parts of the application.
*   **Debugging and Logging (`ajsrConsole`):** The application extensively uses `ajsrConsole.log`, `ajsrConsole.error`, and `ajsrConsole.warn` for detailed logging and debugging, with custom console configurations defined in `index.html` and `App.jsx`. Debugging elements like build info (`BuildInfo`) and debug panels (`DebugConfigPane`, `DebugSessionSettingsPane`, `DebugModalsLauncher`) are integrated.
*   **Platform-Specific Logic:** The codebase frequently uses conditional logic based on `window.AppGlobal.platform` (e.g., `'hbbtv'`, `'tizen'`, `'webos'`) to adapt behavior for different Smart TV environments, particularly for keyboard input, screen savers, and player features.
*   **Context API for State Management:** React's Context API is heavily utilized (`AuthContext`, `SettingsContext`, `OptionsContext`, `CapabilitiesContext`, etc.) to provide global state and functions to various components, promoting a clean separation of concerns and easier state access.
*   **Focus Management:** The presence of `useFixedFocus` hook and references to `nav.fixedFocus` and `nav.move` functions, along with event listeners like `menu:navigate` and `customNavigation`, indicates a custom navigation and focus management system tailored for D-pad (directional pad) controls common on Smart TVs.
*   **Data Fetching and Live Updates:** Multiple components handle data fetching from APIs (`ApiHome`, `ApiStreamData`, `ApiGetNowPlayingSelector`) often involving asynchronous operations and real-time updates for live content using `setInterval` (e.g., `refreshLives`).
*   **Modal Usage:** Various modal components (`GenericErrorModal`, `UserModal`, `ExternalContentModal`, `ExitAppModal`, `GeoRestrictionPlayerModal`) are used for user interaction, error display, and application flow control.
*   **User Type Specific Features:** Logic often distinguishes between `UserType.KID` and other user types, affecting content filtering (`filterChildren`) and application exit behavior.