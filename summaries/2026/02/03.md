# Activity Summary for 3/2/2026

## 2:17:37
The code changes primarily focus on enhancing the Smart TV application's robustness, user experience, and platform compatibility, with significant updates occurring on January 30, 2026, and a concentrated effort on February 2, 2026.

**File-Specific Updates:**

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\styles.scss` (January 30, 2026, 9:04:15):**
    *   Introduced initial or foundational styling for the `.page_view` and `.bottom-gradient` elements, defining their background (including a `3cat_red-bg` image), positioning, dimensions, and text styles for `.rankingText`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js` (January 30, 2026, multiple times; February 2, 2026, 17:08:44):**
    *   Multiple updates refined the generic keyboard navigation logic (`IinitKeyboardNavigation_SmartTV`), which handles input throttling, key combination detection, and dispatches actions based on common and platform-specific key codes (up, down, left, right, enter, back/escape, player controls, numeric keys).
    *   Player control actions were standardized to `window.AppGlobal.Player.Actions.play()`/`pause()`, etc.
    *   A significant update on February 2 introduced `initNetworkHandlers` to pause the player on `evNetworkDisconnected` and resume on `evNetworkConnected` (if not in an ad break), and added `e.preventDefault(); e.stopPropagation();` to the `onKeyDownHandler` for better event control. A `hasNetwork` property and `hasNetworkConnection()` method were also added to the `PlayerController`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\keycodes.js` (January 30, 2026, 11:54:49):**
    *   A static `KeyCodes` object was defined, mapping HbbTV-specific key names (e.g., `VK_LEFT`, `VK_RED`, `VK_PLAY`) to their numerical key codes with fallback values.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\hbbtv.js` (January 30, 2026, multiple times; February 2, 2026, 12:29:39):**
    *   Initial setup for HbbTV application initialization (`initAppHbbTV`) and keyboard navigation (`IinitKeyboardNavigation_SmartHbbTV`). It includes logic to log device info, destroy the application on `evExitApplication`, and register keys via `app.privateData.keyset`.
    *   Player control calls were generally moved from `Controller` to `Actions` for consistency.
    *   On February 2, `VK_REWIND` and `VK_FAST_FWD` actions were updated to dispatch `customSeekKeyDown` events.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\didomiContext.jsx` (January 30, 2026, multiple times; February 2, 2026, multiple times until 12:38:36):**
    *   This component manages user consent via the Didomi SDK. Numerous iterative changes were made to refine the display logic of the consent notice and preferences modal.
    *   Key updates on February 2 include:
        *   Introduction of `handleNetworkDisconnected` to hide Didomi modals and reset state if the network is lost (10:28:16).
        *   Addition of `handleNetworkConnected` to potentially re-show Didomi notices if consent is still pending (10:42:48).
        *   Refinements in how `didomiHostElement.current` and `window.displayingDidomi` flags are managed during initialization and modal closure (12:27:25, 12:32:31).
        *   The `closeDidomi` function was updated to remove network event listeners, ensuring proper cleanup (12:38:36).
        *   Conditional rendering of the `AppModals` component was introduced, initially based on `displayingDidomiNotice.current` and later on `didomiHostElement.current`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js` (January 30, 2026, 12:29:46; February 2, 2026, multiple times until 13:31:01):**
    *   Sets up Tizen-specific application initialization (`initAppTizen`), screen saver helpers, and registration of extra Samsung remote keys (media, color, numeric, channel).
    *   The `initNetworkStateListener` was significantly updated on February 2:
        *   It moved from commented-out code to actively dispatching `evNetworkDisconnected` and `evNetworkConnected` events (10:20:15, 10:24:00), replacing direct modal calls with a more event-driven approach.
    *   The `visibilitychange` listener in `initAppTizen` was updated to use `window.AppGlobal.Player.Actions.pause()` for consistency (13:29:59).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerController.js` (February 2, 2026, multiple times until 13:56:25):**
    *   This core player logic manages various player handlers and integrates with analytics plugins.
    *   A new `initNetworkHandlers` method was added to the class, registering listeners for `evNetworkDisconnected` and `evNetworkConnected` to pause and play the video, respectively (13:36:14, 13:41:16).
    *   A `hasNetwork` property and `hasNetworkConnection()` method were added to track and expose the network status, which is updated by the network event handlers (13:56:25).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerOverlay.jsx` (February 2, 2026, multiple times until 13:59:00):**
    *   Manages the player's UI overlay, displaying controls, spinners, and modals.
    *   On February 2, the `showPlayerControls` function was updated to check `playerController.hasNetworkConnection()` (13:57:54) before showing controls, preventing UI issues when the network is unavailable.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\webos\webos.js` (February 2, 2026, multiple times until 14:13:52):**
    *   Manages WebOS-specific app lifecycle events (`webOSLaunch`, `webOSRelaunch`, `visibilitychange`, `evExitApplication`).
    *   The `initNetworkStateListener` was significantly improved on February 2:
        *   It now dynamically determines the correct connection manager service (`luna://com.webos.service.connectionmanager` or `luna://com.palm.connectionmanager`) based on the WebOS SDK version using `getWebOSConnectionManager` (14:12:47).
        *   Logic was added to prevent duplicate `evNetworkConnected`/`evNetworkDisconnected` events if the network state has not actually changed.

*   **`c:\Users\Usuario\Documents\Trabajo\3cat_pro\gateway\js\app.js` (February 2, 2026, 14:16:27):**
    *   This file, located in a separate `gateway` project, configures the WebOS gateway. It dynamically sets the connection manager service and a remote URL based on SDK version. It handles initial internet connectivity for redirection and subscribes to network status changes to redirect if a connection becomes available. It also implements a `VK_BACK` handler for basic exit functionality.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\infoGroup\index.jsx` (February 2, 2026, 16:31:34):**
    *   Refinements to how media information, such as titles, descriptions, and tags, are rendered. The logic for determining the primary title and description for live streams, episodes, and general content was updated.
    *   Removed "A partir del" functionality.
    *   Introduced a dynamic dot-separated list for metadata items like tags, duration, and episode/season counts.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\mediaTitle\styles.scss` (February 2, 2026, 16:33:36):**
    *   Adjusted font styles for various `.mediaTitle` variants, specifically changing `font-weight` and `font-size` for program/live titles and adding a bolder style for `.menu_detail` and specific sizing for `.external`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\styles.scss` (February 2, 2026, 16:39:57):**
    *   Added visual feedback (box-shadow, border) for focused and hovered portrait items, indicating interactive elements. Introduced new styling for `.tag` and `.platform-logo` within these items.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\keyboard\styles.scss` (February 2, 2026, 16:56:08, 17:09:25):**
    *   Added hover styles to `.keyboard-key` on February 2, 2026, 17:09:25, mimicking the existing focus styles for improved user interaction feedback.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\sideMenu\index.jsx` (February 2, 2026, 17:36:09, 17:36:22):**
    *   Manages the app's two-level side menu. Logic for dynamically generating menu items based on user type (kid/adult) and authentication state.
    *   Added `window.__isEntry = isMenuVisible;` in a `useEffect` hook (17:36:22).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\onboarding\usersScreen\index.jsx` (February 2, 2026, multiple times until 18:14:59):**
    *   Underwent several small, iterative changes to refine the user selection screen.
    *   The `onBackClick` prop for `PageHead` was simplified to always call `window.AppGlobal.Actions.openExitAppModal`.
    *   Temporary hardcoding of `window.__isEntry = true;` (18:05:33) was followed by its removal and the introduction of a new global `window.__foceEntry` flag with a cleanup mechanism (18:14:59), indicating an active development phase to control initial entry and back navigation behavior.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\goBackHistory.js` (February 2, 2026, 18:15:16):**
    *   The `goBackHistory` utility function was updated to incorporate the `window.__isEntry` or `window.__foceEntry` flags, allowing specific paths (like `/welcomeScreen`, `/home`, `/`) to trigger a provided callback function (e.g., exit app) instead of standard history navigation. It also added logic to hide the audio/subtitle menu in the player before navigating back.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx` (February 2, 2026, multiple times until 19:14:36):**
    *   The root application component saw numerous small updates to its modal handling and global actions.
    *   The `openExitAppModal` function was temporarily commented out, then re-instated, and `window.AppMenu.manageFocused?.()` was added, suggesting active debugging and coordination with the side menu's focus management.
    *   The `DidomiProvider` was updated to pass `openExitDialog` as a prop to handle exit modal opening from the consent context.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\appModals\index.jsx` (February 2, 2026, multiple times until 13:22:01):**
    *   A generic `AppModals` component for displaying various error/incident messages.
    *   Network event listeners (`evNetworkDisconnected`, `evNetworkConnected`) were added on February 2 (10:29:08) to automatically open/close the 'NO_CONNECTION' modal.
    *   The "NO_CONNECTION" modal's "OK" button was initially removed (`btnOkLabel: null`, 10:44:30), and later a `noButtons` property was introduced (12:55:03) for more flexible button rendering.
    *   Detailed focus management logic was implemented, using `nav.capture()/disable()` and `nav.release()/enable()` for modals without buttons, and `nav.storedFocus` for modals with buttons (from 13:07:37 onwards).
    *   A global `window.isUserModalVisible` flag was introduced to track if any user-facing modal is open (13:22:01).

**Patterns and Recurring Elements:**

*   **Centralized Global State and Actions (`window.AppGlobal`):** The application extensively uses `window.AppGlobal` to expose common actions (e.g., `openExitAppModal`, `onVisibilityChange`, player controls) and state (`platform`, `keyFuntionsInit`, `ScreenSaver`), indicating a shared global interface for different modules and platforms.
*   **Platform-Specific Adaptations:** There's a clear modular design for different Smart TV platforms (WebOS, Tizen, HbbTV, and a generic fallback) in handling keyboard inputs, network events, and application lifecycle. This is evident in the distinct `platform` folders and their respective initialization functions.
*   **Custom Event-Driven Communication:** Frequent use of `CustomEvent` and `document.dispatchEvent` (e.g., `evNetworkDisconnected`, `evNetworkConnected`, `customKeyDown`, `customNavigation`, `evExitApplication`, `evChangeUser`) suggests a decoupled architecture where components communicate through a central event bus.
*   **Robust Network Handling:** A recurring pattern across `playerController.js`, `didomiContext.jsx`, `tizen.js`, `webos.js`, and `appModals/index.jsx` involves listening for `evNetworkDisconnected` and `evNetworkConnected` events to trigger specific UI behaviors (pausing/playing media, showing/hiding modals, managing consent dialogs). This highlights an emphasis on resilience to network interruptions.
*   **Advanced Focus Management (`nav` library):** The `nav` object (presumably a custom navigation library) is consistently used across interactive components like `SideMenu`, `AppModals`, and generic keyboard handling. It includes functionalities like `focusById`, `move.up/down/left/right`, `capture`/`release`/`disable`/`enable` for managing focus flow, especially around modals and complex UI elements.
*   **Modal System Integration:** The `AppModals` and `ExitAppModal` components are tightly integrated with global actions and state (`window.isUserModalVisible`), ensuring consistent behavior for user interactions such as exiting the app or handling network errors.
*   **Iterative Refinement:** Multiple commits within the same files on consecutive timestamps (especially on February 2) indicate an iterative development process, where functionalities like Didomi integration, network handling, and focus management were continuously fine-tuned.
*   **Debugging and Observability:** The presence of `ajsrConsole.log` statements and conditional debug UI components in `App.jsx` and other files suggests active debugging and monitoring capabilities within the application.

## 9:20:28
A series of code changes were implemented between January 30, 2026, and February 2, 2026, primarily focusing on Smart TV application functionality, user interface, and platform integration.

**File-Specific Updates:**

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\styles.scss` (30/1/2026, 9:04:15):**
    *   Defined base styles for `.page_view`, including background image, fixed dimensions (1920x1080px), and absolute positioning for text elements like `.rankingText`.
    *   Added styles for a `.bottom-gradient` overlay with a background image.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js` (Multiple timestamps: 30/1/2026, 11:38:08 to 2/2/2026, 17:08:44):**
    *   **30/1/2026, 11:38:08:** Introduced `IinitKeyboardNavigation_SmartTV` with global `AppGlobal.KeyMemory` for handling key combinations, throttling key events, and dispatching custom navigation events. Implemented common and platform-specific (WebOS, Tizen) key codes, including basic navigation and player controls.
    *   **30/1/2026, 11:53:37:** Added explicit `VK_PLAY_PAUSE` handling for WebOS.
    *   **30/1/2026, 12:29:17 & 12:29:26:** Refactored player action calls from `window.AppGlobal.Player.Controller` to `window.AppGlobal.Player.Actions` for consistency across WebOS and Tizen player controls.
    *   **2/2/2026, 17:08:44:** Enhanced keyboard event handling by adding `e.preventDefault(); e.stopPropagation();` to `onKeyDownHandler` to prevent default browser actions and event bubbling.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\keycodes.js` (30/1/2026, 11:54:49):**
    *   Standardized HbbTV key code definitions by creating a `KeyCodes` object that uses `window.KeyEvent` properties with fallback values for various keys (navigation, color buttons, media controls, numeric keys).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\hbbtv.js` (Multiple timestamps: 30/1/2026, 11:55:42 to 30/1/2026, 12:33:41):**
    *   **30/1/2026, 11:55:42:** Implemented `initAppHbbTV` for application lifecycle events and `IinitKeyboardNavigation_SmartHbbTV` for key registration and processing.
    *   **30/1/2026, 12:29:39:** Aligned HbbTV player action calls with the new `window.AppGlobal.Player.Actions` pattern, including `VK_PLAY_PAUSE`.
    *   **30/1/2026, 12:33:41:** Modified `VK_REWIND` and `VK_FAST_FWD` to dispatch custom seek events, centralizing seek logic.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js` (Multiple timestamps: 30/1/2026, 12:29:46 to 2/2/2026, 13:31:01):**
    *   **30/1/2026, 12:29:46:** Introduced Tizen platform-specific initialization including `initAppTizen` (handling visibility changes, pausing player, exiting app) and `initNetworkStateListener` (monitoring network status and opening a "NO_CONNECTION" modal).
    *   **2/2/2026, 10:19:43 - 10:24:00:** Refactored `initNetworkStateListener` to dispatch generic `evNetworkDisconnected` and `evNetworkConnected` events instead of directly managing the "NO_CONNECTION" modal.
    *   **2/2/2026, 13:29:59 & 13:31:01:** Removed `history.go(-1); webapis.avplay.stop();` from the `visibilitychange` handler, indicating a change in how Tizen app hidden state is managed.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\didomiContext.jsx` (Multiple timestamps: 30/1/2026, 12:20:04 to 2/2/2026, 12:38:36):**
    *   **30/1/2026, 12:20:04:** Established `DidomiProvider` for managing Didomi (consent management platform) notices, handling user preferences, and integrating an `ExitAppModal`. Introduced `window.displayingDidomi` flag.
    *   **30/1/2026, 12:21:34 & 2/2/2026, 10:25:12:** Integrated `ExtraAppModals` (later renamed `AppModals`) into the provider.
    *   **2/2/2026, 10:28:16 - 11:34:47:** Added and refined `handleNetworkDisconnected` and `handleNetworkConnected` functions to manage Didomi notice visibility based on network status. Network event listeners were added and later improved for conditional execution and cleanup.
    *   **2/2/2026, 12:09:49 - 12:25:37:** Iterated on conditional rendering for `AppModals` within the `DidomiProvider`, initially linking it to `displayingDidomiNotice.current`, then `window.displayingDidomi`, and finally `didomiHostElement.current`.
    *   **2/2/2026, 12:27:25 - 12:38:36:** Added logic to explicitly set `didomiHostElement.current = false;` when consent is not required or Didomi is closed, and added cleanup for network event listeners in `closeDidomi`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\appModals\index.jsx` (Multiple timestamps: 2/2/2026, 10:29:08 to 2/2/2026, 13:22:01):**
    *   **2/2/2026, 10:29:08:** Initialized a generic `AppModals` component with a `MODALS_CONFIG` for various error and informational modals. It integrates `openModal` globally and listens for network events to display/hide a "NO_CONNECTION" modal.
    *   **2/2/2026, 10:44:30 - 10:46:07:** Briefly removed and then re-added an "OK" button for the "NO_CONNECTION" modal, indicating a testing phase for buttonless modals.
    *   **2/2/2026, 12:48:28:** Changed `||` to `??` for `btnOkLabel` default value handling, distinguishing `null`/`undefined` from empty strings.
    *   **2/2/2026, 12:55:03:** Introduced a `noButtons` property to `MODALS_CONFIG` and adapted rendering logic to support modals without action buttons.
    *   **2/2/2026, 13:03:49 - 13:12:25:** Refined `nav` focus management for modals. If a modal has `noButtons`, `nav.disable()` is called to block navigation outside, and `nav.enable()` on close. Otherwise, it stores and restores focus on specific buttons (`btnModalCancel`, `btnModalOk`).
    *   **2/2/2026, 13:22:01:** Added `window.isUserModalVisible` flag management (set to `true` on open, `false` on close), indicating a new global mechanism to track modal presence.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerController.js` (Multiple timestamps: 2/2/2026, 13:35:20 to 2/2/2026, 13:56:25):**
    *   **2/2/2026, 13:35:20 - 13:41:16:** Implemented `initNetworkHandlers` to pause the player on network disconnect and resume (conditionally, if not in an ad break) on reconnect, using custom `evNetworkDisconnected`/`evNetworkConnected` events.
    *   **2/2/2026, 13:56:25:** Added a `hasNetwork` property and `hasNetworkConnection()` method to the player controller for internal network status tracking.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerOverlay.jsx` (Multiple timestamps: 2/2/2026, 13:48:48 to 2/2/2026, 13:59:00):**
    *   **2/2/2026, 13:57:54 & 13:59:00:** Integrated network status check by adding `if (!playerController.hasNetworkConnection()) return` to `showPlayerControls`, preventing control display when offline.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\webos\webos.js` (Multiple timestamps: 2/2/2026, 14:07:27 to 2/2/2026, 14:13:52):**
    *   **2/2/2026, 14:07:27:** Established WebOS platform initialization (`initAppWebos`) and `initNetworkStateListener` for subscribing to network status updates.
    *   **2/2/2026, 14:12:47 & 14:13:52:** Improved `initNetworkStateListener` to dynamically select the correct connection manager service based on WebOS SDK version and to avoid redundant event dispatches for unchanged network states.

*   **`c:\Users\Usuario\Documents\Trabajo\3cat_pro\gateway\js\app.js` (2/2/2026, 14:16:27):**
    *   Updated the gateway file to also dynamically determine the WebOS connection manager service and redirect to different `REMOTE` URLs based on SDK version. It also includes initial network status checks and a back key handler.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\infoGroup\index.jsx` (2/2/2026, 16:31:34):**
    *   Added a `LIVE_REFRESH_INTERVAL` property to `EpisodeCount` component, likely to limit the display of episodes.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\mediaTitle\styles.scss` (2/2/2026, 16:33:36):**
    *   Added a new style rule `.mediaTitle.stream` to standardize its font weight and size.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\styles.scss` (2/2/2026, 16:39:57):**
    *   Introduced `:hover` and `.V-SCROLLABLE:not(.fixed) &.focused` styles for visual feedback, applying `box-shadow` and `border` with a specific red color.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\keyboard\styles.scss` (2/2/2026, 16:56:08 & 2/2/2026, 17:09:25):**
    *   **2/2/2026, 16:56:08:** Added specific styling for different keyboard key sizes (`.SMALL`, `.MEDIUM`, `.LARGE`) and icons (`.icon-BACKSPACE`, `.icon-SPACE_BAR`, `.icon-RETURN`). Defined focused styles for keyboard keys.
    *   **2/2/2026, 17:09:25:** Added a `:hover` style for keyboard keys, mirroring the focused state for enhanced user interaction.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\sideMenu\index.jsx` (2/2/2026, 17:36:09 & 2/2/2026, 17:36:22):**
    *   Minor modifications related to the `window.__isEntry` flag, which likely controls initial menu behavior.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\onboarding\usersScreen\index.jsx` (Multiple timestamps: 2/2/2026, 17:45:11 to 2/2/2026, 18:14:59):**
    *   **2/2/2026, 17:45:11:** The `PageHead`'s `onBackClick` was conditionally set based on `window.__isEntry`.
    *   **2/2/2026, 18:04:11 - 18:05:22:** `onBackClick` was made to always trigger `window.AppGlobal.Actions.openExitAppModal`.
    *   **2/2/2026, 18:05:33 - 18:10:38:** `window.__isEntry` was explicitly set to `true` to influence back navigation behavior, then moved to a `useEffect`.
    *   **2/2/2026, 18:14:59:** Introduced `window.__foceEntry` flag with a cleanup function to manage "force entry" state more explicitly.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\goBackHistory.js` (2/2/2026, 18:15:16):**
    *   Modified the `goBackHistory` utility to check `window.__isEntry` or `window.__foceEntry` for special exit conditions. It also added logic to hide player audio/subtitles menus before navigating back from the player.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx` (Multiple timestamps: 2/2/2026, 18:50:50 to 2/2/2026, 19:14:36):**
    *   **2/2/2026, 18:50:50:** Shows the main application structure, including routing and context providers. `ExtraAppModals` is rendered.
    *   **2/2/2026, 18:51:35 - 18:52:39:** Temporarily commented out then re-enabled modal state management within `openExitAppModal`. Added `window.AppMenu.manageFocused?.();` to `openExitAppModal`.
    *   **2/2/2026, 18:54:07 - 19:14:36:** Removed explicit `AppMenu.exitMenu()` call from `openExitAppModal`, indicating a change in the menu behavior when the exit modal is triggered.

**Patterns and Recurring Elements:**

*   **Platform-Specific Logic:** A significant portion of changes involves adapting the application for different Smart TV platforms (WebOS, Tizen, HbbTV) for keyboard navigation, player controls, and network state detection.
*   **Centralized Global State:** Extensive use of `window.AppGlobal` to expose common actions, player controls (`Player.Actions`), key combinations (`KeyMemory`, `keyCombinations`), and platform information (`platform`, `ScreenSaver`).
*   **Keyboard Navigation Refinement:** Frequent updates to keyboard input handling and focus management using a `nav` object, especially in the context of modals and menus, indicating a strong focus on remote control interaction.
*   **Modal System Enhancements:** Continuous iteration on the `DidomiContext` and `AppModals` components to handle user consent, generic application messages, network status, and ensure proper focus and visibility management. The `window.isUserModalVisible` flag is a key part of this.
*   **Network Connectivity Awareness:** Multiple files (`tizen.js`, `webos.js`, `playerController.js`, `didomiContext.jsx`, `appModals\index.jsx`) now implement or consume custom network disconnected/connected events (`evNetworkDisconnected`, `evNetworkConnected`), demonstrating a push to make the application more robust to network changes.
*   **Player Control Abstraction:** Player actions were refactored from direct `Controller` calls to `Actions` for better abstraction and consistency.
*   **Entry Point Management:** The introduction and manipulation of `window.__isEntry` and `window.__foceEntry` flags suggest intricate control over the application's back navigation behavior, especially from onboarding screens.

## 10:20:43
The changes span across several core areas of a Smart TV application, primarily focusing on platform-specific integrations, user interaction (keyboard navigation, modals), and player functionality. The timestamps indicate a concentrated period of development and refinement from January 30th to February 2nd, 2026.

Here's a summary of the key information:

**File-Specific Updates:**

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\styles.scss` (30/1/2026, 9:04:15):**
    *   Initial styling for a `page_view` and `bottom-gradient`. The `page_view` is configured for a 1920x1080px resolution with a background image and defines `rankingText` styles. The `bottom-gradient` adds a fixed gradient overlay.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js` (30/1/2026, 11:38:08 - 2/2/2026, 17:08:44):**
    *   **Keyboard Navigation:** Sets up global `KeyMemory` and `keyCombinations` for handling key sequences, especially for enabling/disabling player ads. `IinitKeyboardNavigation_SmartTV` handles general navigation (arrows, Enter, Back) with a 200ms throttle.
    *   **Platform-Specific Key Handling:** Includes distinct `switch` statements for WebOS, Tizen, and other non-HbbTV platforms to process player control keys (Play, Pause, Stop, Rewind, FastForward).
    *   **Player Actions:** Transitioned player control calls from `window.AppGlobal.Player.Controller` to `window.AppGlobal.Player.Actions` for better abstraction.
    *   **Event Handling:** Dispatches custom events (`customKeyDown`, `customKeyUp`, `customNavigation`, `customSeekKeyDown`).
    *   **Event Prevention:** Introduced `e.preventDefault(); e.stopPropagation();` in `onKeyDownHandler` to prevent default browser behavior and stop event bubbling for handled keys (2/2/2026, 17:08:44).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\keycodes.js` (30/1/2026, 11:54:49):**
    *   Defines HbbTV-specific `KeyCodes` using `window.KeyEvent` with fallback values for navigation, color buttons, media controls, back, and numeric keys.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\hbbtv.js` (30/1/2026, 11:55:42 - 30/1/2026, 12:33:41):**
    *   **HbbTV Initialization:** Implements `initAppHbbTV` for device information and `evExitApplication` handling.
    *   **Keyboard Integration:** `IinitKeyboardNavigation_SmartHbbTV` registers keys (color, navigation, VCR controls) and processes key presses, including player actions and dispatching `customSeekKeyDown` events for rewind/fast-forward.
    *   **Player Actions:** Updated player control calls from `window.AppGlobal.Player.Controller` to `window.AppGlobal.Player.Actions`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\didomiContext.jsx` (30/1/2026, 12:20:04 - 2/2/2026, 12:38:36):**
    *   **Consent Management:** Introduced `DidomiProvider` to manage user consent (Didomi SDK). It handles visibility of consent notices and preferences, with a timeout for SDK loading.
    *   **Modal Integration:** Manages an `exitModalOpened` state, allowing an `ExitAppModal` to be displayed.
    *   **Network Event Handling:** Implemented `handleNetworkDisconnected` and `handleNetworkConnected` listeners (2/2/2026, 10:28:16 onwards) to react to network changes, potentially hiding/showing the Didomi notice or managing keydown listeners.
    *   **AppModals Integration:** `AppModals` component was dynamically added and removed from the render logic, eventually being conditionally rendered based on `didomiHostElement.current` or `window.displayingDidomi`.
    *   **Cleanup:** `closeDidomi` was enhanced to remove network event listeners and explicitly clear Didomi-related states on exit (2/2/2026, 12:38:36).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js` (30/1/2026, 12:29:46 - 2/2/2026, 13:31:01):**
    *   **Tizen Initialization:** `initAppTizen` logs device info, handles app visibility changes (pausing/playing the player), and provides an `evExitApplication` listener to exit the Tizen app.
    *   **Network State Listener:** `initNetworkStateListener` was initially implemented, then commented out, then refactored to dispatch generic `evNetworkDisconnected` and `evNetworkConnected` events (2/2/2026, 10:24:00).
    *   **Screen Saver & Keys:** Includes helpers for screen saver management (`initScreenSaverHelpers`) and registering extra Samsung remote keys (`initExtraSamsungKeys`).
    *   **App Launch:** Exports functions to launch other Tizen apps (`launchAppTizen`) or open the Samsung Store (`openSamsungStore`).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerController.js` (2/2/2026, 13:35:20 - 2/2/2026, 13:56:25):**
    *   **Player Core:** Manages playback, integrates various analytics plugins (KantarST, MarkerHW, Sitecatalyst, Youbora, GoogleIma), and uses different player handlers (Shaka, Avplay, Html, Html5).
    *   **Event Handling:** `setupEvents` registers numerous player events (`loadedmetadata`, `timeupdate`, `playing`, `pause`, `ended`, `error`, etc.) to update UI and analytics. Includes a fix to ignore "ended" events during ad breaks.
    *   **Network Integration:** Added `initNetworkHandlers` to pause playback on `evNetworkDisconnected` and resume on `evNetworkConnected`. A `hasNetwork` property and `hasNetworkConnection()` method were introduced to track and expose network status (2/2/2026, 13:56:25).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerOverlay.jsx` (2/2/2026, 13:48:48 - 2/2/2026, 13:59:00):**
    *   **Player UI:** React component to display player controls, information overlays (live/VOD), and state (loading, playing, error).
    *   **State Management:** Manages `playerState`, `playingData`, `error`, `playerOverlayIsVisible`, `configMenuIsVisible`, and `onGoingAd`.
    *   **Controls:** Provides functions for Play/Pause, Start Over, Return to Live, and config menu. Exposes `play`, `pause`, `togglePlayPause` globally via `window.AppGlobal.Player.Actions`.
    *   **Conditional Visibility:** `showPlayerControls` now checks `playerController.hasNetworkConnection()` before showing controls (2/2/2026, 13:57:54).
    *   **Ad Integration:** Renders `AdOverlayWrapper` and `VideoSpinner` during ad playback, hiding other UI.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\webos\webos.js` (2/2/2026, 14:07:27 - 2/2/2026, 14:13:52):**
    *   **WebOS Initialization:** `initAppWebos` sets up listeners for webOS lifecycle events (`webOSLaunch`, `webOSRelaunch`, `visibilitychange`) and `evExitApplication`.
    *   **Network State Listener:** `initNetworkStateListener` was significantly refactored (2/2/2026, 14:12:47) to dynamically select the correct connection manager service (`luna://com.webos.service.connectionmanager` or `luna://com.palm.connectionmanager`) based on the SDK version, and dispatches `evNetworkConnected`/`evNetworkDisconnected` events.
    *   **App/Store Launch:** Exports functions to launch other WebOS apps (`launchAppWebOS`) or open the LG Content Store (`openLGStore`).

*   **`c:\Users\Usuario\Documents\Trabajo\3cat_pro\gateway\js\app.js` (2/2/2026, 14:16:27):**
    *   This is a WebOS gateway script. Its `init` function fetches WebOS SDK version to determine the appropriate connection manager. It checks network status: if connected, it redirects to the Smart TV application; if disconnected, it shows an alert and continuously monitors network status, redirecting once connection is restored.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\infoGroup\index.jsx` (2/2/2026, 16:31:34):**
    *   React component for displaying media metadata (title, description, tags, age rating, duration, episode/season counts).
    *   Includes logic for filtering rating tags and dynamically determining titles/descriptions for various content types (live, audio, external).
    *   Manages the display of `MediaTag` for live, external content, and upcoming events.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\mediaTitle\styles.scss` (2/2/2026, 16:33:36):**
    *   Styling for the `mediaTitle` component, including responsive font sizes and weights for different contexts (program title, live, stream, menu detail, external).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\styles.scss` (2/2/2026, 16:39:57):**
    *   Styling for `portraitItem` components used in content rows, defining dimensions, layout, and visual feedback for `focused` and `hover` states (red box-shadow/outline). Also includes styles for tags and platform logos for external content.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\keyboard\styles.scss` (2/2/2026, 16:56:08 - 2/2/2026, 17:09:25):**
    *   Defines styles for a virtual keyboard, including layout, key dimensions, and appearance.
    *   Includes specific styles for different key sizes (`SMALL`, `MEDIUM`, `LARGE`) and icon keys (Backspace, Space Bar, Return).
    *   Added a `:hover` state for keys that mimics the `:focused` state (red glow effect) (2/2/2026, 17:09:25).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\sideMenu\index.jsx` (2/2/2026, 17:36:09 - 2/2/2026, 17:36:22):**
    *   **Side Menu Logic:** React component managing a multi-level navigation side menu, integrated with authentication and settings contexts.
    *   **Menu State:** Controls visibility (`show_1st_mnu`, `show_2nd_mnu`) and navigation state (`navigate_2nd_mnu`).
    *   **Dynamic Menus:** Generates L1 (main) and L2 (sub) menu data, including dynamically attaching a 'Search' option.
    *   **Focus Management:** Uses a global `nav` object to manage focus within the menu, capturing and restoring focus as menus open/close or items are selected.
    *   **User Actions:** Handles changing users (`fnDoChangeUser`) and exiting the application (`fnExitApp`) from the user menu.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\onboarding\usersScreen\index.jsx` (2/2/2026, 17:45:11 - 2/2/2026, 18:14:59):**
    *   **User Selection Screen:** Displays available user profiles (logged-in users, Super3/kids, Add User) and a guest option for HbbTV.
    *   **Navigation & Auth:** Handles user selection, setting active users, and navigating to the home screen or add user screen.
    *   **Exit Flow:** The `onBackClick` for the `PageHead` component now consistently triggers `window.AppGlobal.Actions.openExitAppModal`.
    *   **Entry Point Flag:** Introduced and repeatedly modified `window.__isEntry` and `window.__foceEntry` flags, seemingly for debugging or controlling initial back button behavior, with `__foceEntry` specifically managed for this screen's lifecycle.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\goBackHistory.js` (2/2/2026, 18:15:16):**
    *   **Back Button Logic:** Modified to check for `window.__isEntry` or `window.__foceEntry` to directly trigger a `callBackFunc()` (e.g., `openExitAppModal`) if the app is considered an initial entry point, overriding standard history navigation. Also handles player-specific back actions.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx` (2/2/2026, 18:50:50 - 2/2/2026, 19:14:36):**
    *   **Application Entry Point:** Sets up React Router for the entire application, including public and private routes. Integrates various context providers for authentication, settings, capabilities, consent (Didomi), parental control, etc.
    *   **Debug Features:** Includes optional debug consoles (`InitDevConsole`), build information (`BuildInfo`), and debug launchers (`DebugModalsLauncher`, `DebugConfigPane`).
    *   **Global Actions:** Defines global `window.AppGlobal.Actions` for `onVisibilityChange`, `openExitAppModal`, and `openCloseSessionModal`.
    *   **Exit Modal Behavior:** The `openExitAppModal` function's behavior was repeatedly adjusted, first enabling a direct modal opening, then commenting out the modal display, then re-enabling it, reflecting ongoing development of the app's exit strategy. `window.AppMenu.manageFocused?.();` was added to ensure correct menu focus before attempting to open the exit modal.
    *   **Platform Redirect:** Uses `PlatformRedirect` to guide users to either `/home` (HbbTV) or `/welcomeScreen` (other platforms) on initial load.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\appModals\index.jsx` (2/2/2026, 10:29:08 - 2/2/2026, 13:22:01):**
    *   **Centralized Modals:** `AppModals` component manages a configuration (`MODALS_CONFIG`) for various modals (geoblocking, no connection, exit, technical problems, incidents).
    *   **Dynamic Modals:** `openModal` function, exposed globally, allows opening modals with customizable content and callbacks.
    *   **Network Modals:** Automatically opens the 'NO_CONNECTION' modal on `evNetworkDisconnected` and closes it on `evNetworkConnected`.
    *   **Button Configuration:** Evolved to support modals without buttons (`noButtons: true` in config), impacting rendering and focus management.
    *   **Focus Management:** The `useEffect` for modal `isOpen` was refined several times to correctly handle focus: using `nav.capture()/nav.disable()` for buttonless modals and `nav.storedFocus`/`nav.focusById` for modals with buttons.
    *   **Global Modal State:** Introduced `window.isUserModalVisible = true/false` to indicate whether any user-facing modal is currently open (2/2/2026, 13:22:01).

**Patterns and Recurring Elements:**

1.  **Platform Abstraction:** A strong pattern of abstracting platform-specific functionalities (keyboard input, network status, app lifecycle) through global `window.AppGlobal` objects and custom events (e.g., `evNetworkDisconnected`, `evNetworkConnected`, `evExitApplication`).
2.  **Global State (`window.AppGlobal`):** Frequent use of a global `window.AppGlobal` object to share actions, player state, platform information, and configuration across the application.
3.  **Keyboard Navigation (`nav`):** Consistent use of a `nav` object for managing focus in a Smart TV environment, including `focusById`, `move`, `capture`, `release`, `disable`, and `enable` methods. The API appears to be undergoing slight changes over time.
4.  **Modal Management:** Dedicated React components (`DidomiProvider`, `AppModals`, `ExitAppModal`, `GeoRestrictionModal`, `GenericErrorModal`) are used for a structured approach to showing, hiding, and handling user interactions with various types of modals. The behavior of back/exit keys and network events is closely tied to modal state.
5.  **Iterative Refinement:** Multiple re-saves and minor functional adjustments within short timeframes are observed for key files like `didomiContext.jsx`, `generic.js`, `playerController.js`, `playerOverlay.jsx`, `tizen.js`, `webos.js`, and `appModals.jsx`. This indicates active development, testing, and debugging, particularly around critical user flows (app exit, network connectivity, consent).
6.  **React Hooks:** Modern React development practices are evident with extensive use of `useState`, `useEffect`, `useRef`, `useCallback`, and `useMemo` in components like `DidomiProvider`, `PlayerOverlay`, `AppModals`, and `SideMenu`.
7.  **Debugging & Logging:** The presence of `ajsrConsole.log` calls throughout the code, along with conditional rendering of debug panels in `App.jsx`, highlights a focus on debugging and monitoring the application's behavior.

## 14:20:40
The provided log details a series of code changes across a Smart TV application codebase, with significant updates focusing on platform-specific functionalities, user interface responsiveness, modal management, and player controls. The changes occurred primarily on January 30th and February 2nd, 2026.

### File-Specific Updates:

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\styles.scss` (30/1/2026, 9:04:15):** This file defines the base visual layout for `page_view` elements, including a fixed resolution background image (`3cat_red-bg_1920x270.png`), position, and specific text styling for `.rankingText`. It also styles a `.bottom-gradient` with a masking image (`mask_1080.png`), indicating a layered UI design.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js` (30/1/2026, 11:38:08 -> 2/2/2026, 17:08:44):**
    *   Initial commits establish a robust keyboard navigation system for generic SmartTV platforms, utilizing `window.AppGlobal.KeyMemory` for key combinations (e.g., ad enabling/disabling via "123" or "321" sequences) and a `onKeyDownHandler` with input throttling. It includes extensive `switch` statements to handle common keys (directional, Enter, Back/Escape, numeric) and separate blocks for WebOS and Tizen platform-specific key codes.
    *   **30/1/2026, 11:53:37:** Enhanced WebOS key handling to explicitly support `VK_PLAY_PAUSE` for toggling player state.
    *   **30/1/2026, 12:29:17 & 12:29:26:** Refactored player control calls across WebOS and Tizen sections, transitioning from direct `window.AppGlobal.Player.Controller` methods (like `play()`, `pause()`) to a more abstract `window.AppGlobal.Player.Actions` interface.
    *   **2/2/2026, 17:08:44:** Added `e.preventDefault(); e.stopPropagation();` to the `onKeyDownHandler`, critical for preventing default browser/platform key actions and ensuring custom navigation takes precedence.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\keycodes.js` (30/1/2026, 11:54:49):** This file defines a `KeyCodes` object specifically for HbbTV, mapping a comprehensive set of remote control keys (directional, colored buttons, media playback, numeric, back) to their corresponding key codes, often with fallback values for wider compatibility.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\hbbtv.js` (30/1/2026, 11:55:42 -> 30/1/2026, 12:33:41):**
    *   Initial implementation for HbbTV application and keyboard navigation. It includes `evExitApplication` handling, HbbTV keyset registration for color buttons, navigation, and VCR controls. Player actions initially called `Player.Controller`.
    *   **30/1/2026, 11:56:04:** Added explicit handling for `VK_PLAY_PAUSE` in HbbTV, mapping it to `window.AppGlobal.Player.Actions.togglePlayPause()`.
    *   **30/1/2026, 12:29:39:** Updated HbbTV player control calls from `Player.Controller` to `Player.Actions` for play, pause, and stop, aligning with the generic platform changes.
    *   **30/1/2026, 12:33:41:** Modified fast-forward and rewind actions in HbbTV to dispatch custom `evNetworkDisconnected` and `evNetworkConnected` events (`customSeekKeyDown`) instead of directly manipulating the player's seek position, promoting event-driven handling.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\didomiContext.jsx` (30/1/2026, 12:20:04 -> 2/2/2026, 12:38:36):**
    *   The `DidomiProvider` context manages the visibility and lifecycle of the Didomi consent notice and an exit modal. It initializes Didomi SDK, registers listeners for consent notice events, and includes a `handleKeyDown` function for managing modals using back/exit keys.
    *   **30/1/2026, 12:21:34:** Integrated a generic `AppModals` component into the Didomi context's rendering, indicating centralized modal management.
    *   **2/2/2026, 10:28:16 -> 2/2/2026, 12:38:36:** Introduced and iteratively refined `handleNetworkDisconnected` and `handleNetworkConnected` functions. These functions now dynamically manage the Didomi notice and its associated keydown listeners based on network status events, and explicitly reset related state variables, ensuring that consent modals are appropriately displayed or hidden during connectivity changes. The rendering of `AppModals` was also made conditional on `didomiHostElement.current`, effectively linking its visibility to the Didomi consent state.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js` (30/1/2026, 12:29:46 -> 2/2/2026, 13:31:01):**
    *   Initial Tizen platform integration includes `initAppTizen` for device information and `visibilitychange` event handling (pausing player on app hidden, resuming on visible). `initNetworkStateListener` was introduced to monitor network status.
    *   **2/2/2026, 10:19:43 -> 2/2/2026, 10:24:00:** The `initNetworkStateListener` was temporarily commented out, then re-enabled with a significant change: instead of directly opening a modal on network disconnect, it now dispatches `evNetworkDisconnected` and `evNetworkConnected` custom events, externalizing network feedback.
    *   **2/2/2026, 13:29:59 & 13:31:01:** Removed `history.go(-1);` from the `visibilitychange` handler when the application is hidden, preventing unintended navigation during backgrounding.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\appModals\index.jsx` (2/2/2026, 10:29:08 -> 2/2/2026, 13:12:25):**
    *   This component defines a centralized system for displaying various application modals (e.g., Geoblocking, No Connection, Exit App, Technical Problem). It provides `openModal` and `closeModal` functions, exposed globally via `window.AppGlobal.Actions.openModal`.
    *   **2/2/2026, 10:44:30:** Modified the `NO_CONNECTION` modal configuration to explicitly set `btnOkLabel` to `null`.
    *   **2/2/2026, 12:55:03:** Introduced a `noButtons: true` property for the `NO_CONNECTION` modal in `MODALS_CONFIG`, and updated rendering logic to conditionally hide the entire button section for such modals.
    *   **2/2/2026, 13:03:49 -> 2/2/2026, 13:12:25:** The `useEffect` hook handling navigation focus was updated to respect `modal.noButtons`. For modals without buttons, `nav.capture()` (later `nav.disable()`) is called on open, and `nav.release()` (later `nav.enable()`) on close, indicating specific handling for non-interactive modals to manage global navigation state.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\infoGroup\index.jsx` (2/2/2026, 16:31:34):** Displays detailed media information (tags, title, age rating, description, features, duration, season/episode counts, expiration). It includes complex logic to determine title/description priority based on media type (live, episode), and uses a `useExternalEmission` hook to manage external content display.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\mediaTitle\styles.scss` (2/2/2026, 16:33:36):** Styles for media titles, specifying font families, sizes, weights, and text shadows, with variations for different contexts like `title_program`, `live`, `menu_detail`, and `external` titles.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\styles.scss` (2/2/2026, 16:39:57):** Styles for portrait-oriented media items, including dimensions, overflow, focus states (red box-shadow/border), and styling for tags, future dates, and external platform logos.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\keyboard\styles.scss` (2/2/2026, 16:56:08 -> 2/2/2026, 17:09:25):**
    *   Defines the visual style for a virtual keyboard, including key dimensions, colors, and specific icon backgrounds for backspace, space, and return. Focus states are highlighted with a red box shadow and border.
    *   **2/2/2026, 17:09:25:** Added a `:hover` style for keyboard keys, mirroring the `:focused` style, which enhances user feedback for pointer interactions.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerController.js` (2/2/2026, 13:35:20 -> 2/2/2026, 13:56:25):**
    *   The `PlayerController` class orchestrates media playback, integrating various analytics and ad plugins (Google IMA, Kantar ST, Youbora) and handling different player technologies (Shaka, Avplay, Html, Html5). It manages player state, event listeners, and playback logic.
    *   **2/2/2026, 13:36:14 -> 2/2/2026, 13:41:16:** Introduced and refined `initNetworkHandlers()` to pause playback on `evNetworkDisconnected` and resume (conditionally, if not in an ad break) on `evNetworkConnected`. Event listeners are now managed as class properties for better cleanup.
    *   **2/2/2026, 13:56:25:** Added a `hasNetwork` property to the class and a `hasNetworkConnection()` method, explicitly exposing the player's internal network state.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerOverlay.jsx` (2/2/2026, 13:48:48 -> 2/2/2026, 13:59:00):**
    *   This component renders the player's user interface overlay, displaying player states, media information, and controls for both live and VOD content. It also manages ad overlays and displays various error modals.
    *   **2/2/2026, 13:57:54 & 13:59:00:** Modified `showPlayerControls()` to only display controls if `playerController.hasNetworkConnection()` returns true, ensuring the UI accurately reflects network availability.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\webos\webos.js` (2/2/2026, 14:07:27 -> 2/2/2026, 14:13:52):**
    *   Initial WebOS platform setup, including event listeners for `webOSLaunch`, `webOSRelaunch`, and `visibilitychange`. Provides functions for launching other WebOS applications and opening the LG Content Store.
    *   **2/2/2026, 14:12:47 & 14:13:52:** Enhanced `initNetworkStateListener` with `getWebOSConnectionManager` to dynamically select the correct connection manager service based on the WebOS SDK version, improving compatibility. It also added `lastNetworkState` to prevent redundant network events.
*   **`c:\Users\Usuario\Documents\Trabajo\3cat_pro\gateway\js\app.js` (2/2/2026, 14:16:27):** This gateway script for WebOS initializes the application by determining the correct connection manager based on SDK version. It checks for internet connectivity: if available, it redirects to the main application URL; otherwise, it displays a "no connection" alert and sets up a keydown listener for the back button, subscribing to network state changes to redirect once connectivity is restored.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\sideMenu\index.jsx` (2/2/2026, 17:36:09 -> 2/2/2026, 17:36:22):** This `SideMenu` component manages the application's main navigation, including a two-level menu structure, user authentication states (regular, kid, guest), and dynamic content generation. It handles menu visibility, focus management, and navigation to different routes.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\onboarding\usersScreen\index.jsx` (2/2/2026, 17:45:11 -> 2/2/2026, 18:14:59):**
    *   Displays a user selection screen, allowing navigation to individual user profiles, a kids' mode, or an add user screen. It includes specific UI elements for HbbTV guest users.
    *   **2/2/2026, 18:04:11:** Changed the back button's behavior to always open the exit app modal, regardless of how the screen was entered.
    *   **2/2/2026, 18:05:33 -> 2/2/2026, 18:14:59:** Iteratively introduced and refined a `window.__foceEntry` flag to specifically mark this screen as an entry point for exit logic, independent of general `__isEntry` checks. This flag is managed within a `useEffect` with a cleanup.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\goBackHistory.js` (2/2/2026, 18:15:16):** This utility dictates the application's back navigation flow. It checks if the current route is a "root" screen or if `window.__isEntry` or `window.__foceEntry` flags are active. If so, it executes a provided callback (e.g., to open an exit modal). Otherwise, it handles player-specific back actions (like closing a menu) or reverts to standard browser history navigation.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx` (2/2/2026, 18:50:50 -> 2/2/2026, 19:14:36):**
    *   The core application component, responsible for setting up routing, various contexts (authentication, broadcast, history, sitecatalyst, capabilities, options, Didomi, parental control, settings, texts, highlight, virtualization), and global actions. It includes debug components, platform initialization, and handles exit and logout modals.
    *   **2/2/2026, 18:51:35:** Temporarily commented out the core logic for opening the `ExitAppModal` within `openExitAppModal`, indicating a testing phase or an attempt to delegate this responsibility elsewhere.
    *   **2/2/2026, 18:52:39:** Restored the `ExitAppModal` opening logic and added `window.AppMenu.manageFocused?.();`, suggesting that exit modal presentation should now also trigger menu focus management.
    *   **2/2/2026, 18:54:07:** Reverted the `openExitAppModal` implementation back to its earlier state, removing the menu focus management call, streamlining the modal opening to its original intent.
*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pro\config.xml` (3/2/2026, 13:24:24):** This Tizen application configuration file specifies fundamental app metadata, permissions (privileges like `application.launch`, `internet`, `tv.inputdevice`, `network.public`), and platform-specific settings. Notably, it sets `http://samsung.com/tv/metadata/use.network` to `false`, which is an interesting configuration given the extensive network detection in the JavaScript code.

### Patterns and Recurring Elements:

1.  **Platform Abstraction and Specialization:** A consistent pattern of detecting the Smart TV platform (`window.AppGlobal.platform`) and implementing platform-specific logic (e.g., key handling, network status retrieval) while maintaining a generic interface (e.g., `window.AppGlobal.Player.Actions`) for core functionalities like player control.
2.  **Global State Management:** Reliance on a global `window.AppGlobal` object to store shared application state and actions, allowing for inter-component communication and exposing platform-specific functions.
3.  **Event-Driven Communication:** Frequent use of custom DOM events (`evNetworkDisconnected`, `evNetworkConnected`, `customNavigation`, `customKeyDown`, `evExitApplication`, `customSeekKeyDown`) for decoupled communication between different layers and components of the application.
4.  **Sophisticated Keyboard Navigation:** The application employs a custom navigation system (`nav` object) to manage focus within the UI, including mechanisms for throttling key presses, capturing/releasing focus, and handling focused element actions, crucial for TV remote interactions.
5.  **Centralized Modal and Exit Handling:** Extensive logic for managing various modals (Didomi consent, app errors, exit confirmation) is evident. This includes careful control over UI visibility, focus management, and custom back button logic using `goBackHistory` that considers the current route and modal state. The `window.isUserModalVisible` and `window.__isEntry`/`window.__foceEntry` flags are key to this.
6.  **Network Resilience:** A strong emphasis on handling network connectivity changes, with multiple components (Didomi, PlayerController, Tizen, WebOS platform files, AppModals) responding to network events to adjust behavior (e.g., pause playback, hide consent, show alerts).
7.  **Player Control Refinement:** A gradual shift towards a more abstract `window.AppGlobal.Player.Actions` interface for player commands, simplifying interaction with the underlying player handlers.
8.  **Debuggability:** The presence of a `BuildInfo` component and various `window.appConfig.test_app.show...` flags indicates a comprehensive internal debugging system for monitoring application environment, version, platform, player status, and more.

## 17:20:40
The log details significant updates across several core components of a Smart TV application, primarily focusing on keyboard navigation, platform-specific integrations (Tizen, WebOS, HbbTV), consent management (Didomi), player controls, and modal handling.

Here's a breakdown of the key information:

**File-Specific Updates:**

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\page\styles.scss`** (30/1/2026, 9:04:15):
    *   This file defines the styling for the main application view (`.page_view`), setting a full-screen background image (`3cat_red-bg_1920x270.png`) and positioning elements like `.rankingText`. It also styles a `.bottom-gradient` with `mask_1080.png`. This is the initial definition for these core UI elements.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`** (Significant changes on 30/1/2026 at 11:53:37, 12:29:17, and 2/2/2026 at 17:08:44):
    *   **30/1/2026, 11:53:37**: Introduced `VK_PLAY_PAUSE` handling for WebOS, allowing a single key to toggle play/pause functionality.
    *   **30/1/2026, 12:29:17**: Refactored player control calls within platform-specific key handlers (WebOS and Tizen). Actions like play, pause, and stop were moved from `window.AppGlobal.Player.Controller` to `window.AppGlobal.Player.Actions` for better abstraction.
    *   **2/2/2026, 17:08:44**: Added `e.preventDefault(); e.stopPropagation();` to the global `onKeyDownHandler`. This change is crucial for preventing default browser behavior for key presses and stopping event propagation, ensuring the application's custom key handling takes precedence.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\keycodes.js`** (30/1/2026, 11:54:49):
    *   This file defines HbbTV-specific key codes, using `window.KeyEvent` if available and providing fallback hexadecimal values. It consolidates key definitions like `VK_LEFT`, `VK_PLAY`, `VK_RED`, etc.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\hbbtv\hbbtv.js`** (Significant changes on 30/1/2026 at 11:56:04, 12:29:39, and 13:33:41):
    *   **30/1/2026, 11:56:04**: `VK_PLAY_PAUSE` was added to the destructured `KeyCodes` import for HbbTV.
    *   **30/1/2026, 12:29:39**: Similar to `generic.js`, player control actions (`PLAY`, `PAUSE`, `STOP`, `REWIND`, `FAST_FWD`) were shifted from `window.AppGlobal.Player.Controller` to `window.AppGlobal.Player.Actions`.
    *   **30/1/2026, 13:33:41**: The `VK_REWIND` and `VK_FAST_FWD` key actions were updated to dispatch custom events (`dispatchRewindEvent`, `dispatchFastForwardEvent`) rather than directly calling player methods.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\tizen\tizen.js`** (Significant changes on 2/2/2026 at 10:19:43, 10:20:15, 10:24:00, and 13:29:59):
    *   **2/2/2026, 10:19:43 - 10:24:00**: The `initNetworkStateListener` function underwent several rapid iterations. Initially, it was largely commented out, then partially uncommented with a direct `window.AppGlobal.Actions.openModal("NO_CONNECTION")` call, and finally refactored to properly use `webapis.network.addNetworkStateChangeListener` and dispatch generic `evNetworkDisconnected` and `evNetworkConnected` custom events. This change centralizes network status reporting.
    *   **2/2/2026, 13:29:59**: Simplified the `visibilitychange` event listener, moving `history.go(-1)` and `webapis.avplay.stop()` calls out of a `try/catch` block for player pause, indicating better error handling or restructuring.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\didomiContext.jsx`** (Many changes, key ones on 30/1/2026 at 12:21:34, and 2/2/2026 at 10:28:16, 10:42:48, 11:26:47, 11:32:22, 12:27:25, 12:32:31, 12:38:36):
    *   **30/1/2026, 12:21:34**: The `ExtraAppModals` component was added to the Didomi context's render output, indicating a new modal system integration. (Later renamed to `AppModals`).
    *   **2/2/2026, 10:28:16**: Introduced `handleNetworkDisconnected` and corresponding event listener for `evNetworkDisconnected`, which removes keydown listeners, hides Didomi notice, and resets internal Didomi state.
    *   **2/2/2026, 10:42:48**: Added `handleNetworkConnected` and listener for `evNetworkConnected`. This function re-displays the Didomi notice if consent is required and the notice isn't already visible.
    *   **2/2/2026, 11:26:47 - 11:34:47**: `handleNetworkDisconnected` was simplified to primarily remove keydown listeners and conditionally call `switchNoticeModalViews()`. The `handleNetworkConnected` function was refined to ensure the keydown listener is re-added before `switchNoticeModalViews()` is called.
    *   **2/2/2026, 12:27:25 - 12:38:36**: Refined Didomi initialization and cleanup logic. `didomiHostElement.current` is now explicitly set to `false` if consent is not required or if `displayingDidomiNotice.current` is false, ensuring correct conditional rendering of the `AppModals` component. `closeDidomi` now also explicitly removes the network event listeners, preventing memory leaks.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\appModals\index.jsx`** (Many changes, key ones on 2/2/2026 at 10:29:08, 12:48:28, 12:55:03, 13:07:37, 13:12:19, 13:22:01):
    *   **2/2/2026, 10:29:08**: Initial setup for a generic `AppModals` component with a `MODALS_CONFIG` array for predefined modal types (e.g., 'GEOBLOCKING', 'NO_CONNECTION', 'EXIT_APP', 'TECHNICAL_PROBLEM'). It registers `window.AppGlobal.Actions.openModal` for external control and handles network disconnected/connected events to show/hide the 'NO_CONNECTION' modal. It also manages navigation focus based on modal visibility.
    *   **2/2/2026, 12:48:28**: Switched to using nullish coalescing `??` for `btnOkLabel` in `openModal`, allowing `null` values in `MODALS_CONFIG` to correctly suppress buttons instead of defaulting to "D'ACORD".
    *   **2/2/2026, 12:55:03**: Added a `noButtons` property to modal configurations and conditional rendering for buttons. This enables modals that display information without requiring user interaction buttons.
    *   **2/2/2026, 13:07:37 - 13:12:25**: Refined navigation focus handling for modals. If a modal has `noButtons: true`, it now calls `nav.disable()` (instead of `nav.capture()`) when opening and `nav.enable()` when closing. This ensures that navigation is completely disabled for buttonless modals.
    *   **2/2/2026, 13:22:01**: Introduced a global `window.isUserModalVisible` flag, setting it to `true` when any `AppModal` is open and `false` when closed. This allows other parts of the app, like keyboard navigation, to be aware of an active modal.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerController.js`** (Significant changes on 2/2/2026 at 13:36:14, 13:41:16, 13:56:25):
    *   **2/2/2026, 13:36:14**: Added `initNetworkHandlers` to pause the player on `evNetworkDisconnected` and play (conditionally, not during ads) on `evNetworkConnected`.
    *   **2/2/2026, 13:41:16**: Refactored network event handlers to be instance methods and re-introduced the condition to prevent playing during ad breaks on network reconnection.
    *   **2/2/2026, 13:56:25**: Added a `hasNetwork` property to the `PlayerController` class and a `hasNetworkConnection()` method, allowing the player to internally track network status.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\player\playerOverlay.jsx`** (Significant changes on 2/2/2026 at 13:57:54, 13:59:00):
    *   **2/2/2026, 13:57:54 - 13:59:00**: Modified `showPlayerControls` to check `playerController.hasNetworkConnection()` before displaying player controls, preventing UI interactions if there's no network.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\webos\webos.js`** (Significant change on 2/2/2026 at 14:12:47):
    *   **2/2/2026, 14:12:47**: Refactored `initNetworkStateListener` to dynamically determine the correct WebOS connection manager service based on the SDK version (`com.webos.service.connectionmanager` vs `com.palm.connectionmanager`). It also added logic to prevent redundant network event dispatches.

*   **`c:\Users\Usuario\Documents\Trabajo\3cat_pro\gateway\js\app.js`** (2/2/2026, 14:16:27):
    *   This gateway application initializes based on WebOS SDK version. It directs to different remote URLs (`smartv-dev` vs `smartv-pro`) and handles network connectivity, either redirecting to the main app on success or showing an alert and handling the back key for exit if offline. This code exists in a separate project, likely a loader for the main SmartTV app.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\infoGroup\index.jsx`** (2/2/2026, 16:31:34):
    *   This component dynamically renders media information such as titles, descriptions, tags, age ratings, and duration. It includes specific logic for displaying episode/season counts, expiration dates, and handling external content and live streams. It makes use of helper functions for text and date formatting.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\mediaInfo\mediaTitle\styles.scss`** (2/2/2026, 16:33:36):
    *   Defines core styling for media titles, including font sizes, weights, and line clamping. It provides distinct styles for `title_program`, `live`, `stream`, `menu_detail`, and `external` titles.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\styles.scss`** (2/2/2026, 16:39:57):
    *   Styles portrait-oriented items in rows, including visual feedback for focused states (box-shadow, outline) and styling for tags (e.g., 'future-date') and external platform logos.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\keyboard\styles.scss`** (Significant change on 2/2/2026 at 17:09:25):
    *   **2/2/2026, 17:09:25**: Added hover effects to `.keyboard-key` to match the existing focused styles, improving user experience on platforms that support mouse interaction or pointer focus.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\sideMenu\index.jsx`** (2/2/2026, 17:36:22):
    *   Removed the assignment of `window.__isEntry` within a `useEffect`, indicating that this global flag's management has been shifted elsewhere in the application to control entry point behavior.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\views\onboarding\usersScreen\index.jsx`** (Many changes, key ones on 2/2/2026 at 18:05:33, 18:06:13, 18:10:38, 18:14:59):
    *   **2/2/2026, 18:05:33 - 18:14:59**: The management of the `window.__isEntry` and `window.__foceEntry` flags for determining if the current view is an application entry point was frequently altered. Initially, it read from `location.state`, then was forced to `true`, then removed, and finally `window.__foceEntry` was introduced and managed via `useEffect` for force-entry behavior. The `PageHead`'s `onBackClick` was made to always call `window.AppGlobal.Actions.openExitAppModal`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\goBackHistory.js`** (2/2/2026, 18:15:16):
    *   This utility function now checks for `window.__isEntry` or `window.__foceEntry` flags, in addition to specific pathnames, to decide whether to call a provided callback function (for exiting the app) or navigate back in history. It also contains specific logic for handling back navigation from the media player or audio/subs menu.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`** (Significant changes on 2/2/2026 at 18:51:35, 18:54:07):
    *   **2/2/2026, 18:51:35 - 18:54:07**: The `openExitAppModal` function underwent refactoring. It was initially simplified to rely more on the `DidomiProvider`, but then restored to explicitly perform actions like calling `AppMenu.exitMenu()`, `AppMenu.manageFocused()`, setting `window.isUserModalVisible`, saving current navigation focus (`nav.storedFocus`), and setting the `exitModal` state. This indicates a more direct and comprehensive control flow for opening the exit application modal.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pro\config.xml`** (3/2/2026, 13:24:24):
    *   This Tizen configuration file specifies application metadata, required privileges (e.g., `application.launch`, `system`, `internet`, `tv.inputdevice`), screen orientation, context menu, and background support settings. It also includes specific metadata for Samsung TVs, such as prelaunch support and search format. The app version is `3.4.6`.

**Patterns and Recurring Elements:**

*   **Global State Management (`window.AppGlobal`)**: A pervasive pattern across the application is the use of `window.AppGlobal` to expose and manage shared state and actions, including keyboard memory, player controls, screen saver status, and modal triggers. This facilitates communication between disparate parts of the application.
*   **Decoupled Event Handling**: The extensive use of custom DOM events like `evNetworkDisconnected`, `evNetworkConnected`, `evExitApplication`, `customKeyDown`, etc., indicates a strategy for loosely coupled components, where different modules can react to global application states without direct dependencies.
*   **Platform Abstraction**: There are dedicated files and conditional logic (`if (window.AppGlobal.platform === 'webos')`, `tizen.*` APIs, `webOS.service.*` calls) to handle the specific requirements and APIs of different Smart TV platforms (WebOS, Tizen, HbbTV). This ensures cross-platform compatibility.
*   **Centralized Player Actions**: A clear shift towards centralizing player actions under `window.AppGlobal.Player.Actions` (e.g., `play`, `pause`, `togglePlayPause`) is observed, moving away from direct calls to `Player.Controller` methods.
*   **Modal Focus and State**: A recurring pattern for managing UI modals involves saving and restoring navigation focus (`nav.storedFocus`), controlling navigation enablement (`nav.disable()`, `nav.enable()`), and using a global flag (`window.isUserModalVisible`) to signal modal presence. This helps maintain a consistent user experience during modal interactions.
*   **Consent Management**: The integration of Didomi highlights a focus on privacy and user consent, with specific logic for displaying, hiding, and responding to consent notices and preferences.
*   **Network Resilience**: Multiple components (Tizen platform, Didomi context, Player controller, App modals) implement listeners for network connectivity changes, demonstrating an effort to make the application robust against network interruptions.
*   **Debugging Flags**: The `window.appConfig.test_app` and `window.appConfig.test_player` flags scattered throughout the code indicate a comprehensive internal debugging and testing framework, allowing developers to toggle various debug displays and overrides.