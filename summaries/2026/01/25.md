# Activity Summary for 25/1/2026

## 0:04:01
The changes in the log primarily revolve around the `3cat_smarttv` project, focusing on build processes, platform-specific configurations, and image handling, all within a narrow timeframe of January 17th to 23rd, 2026.

**File-Specific Updates:**

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\README.md`**:
    *   **17/1/2026, 10:37:02**: Initial content describes the purpose of the `build_templates` folder: to generate 3CAT Smart TV Apps for Tizen and WebOS across DEV, PRE, and PRO environments. It outlines the folder structure and expected output file names for `launcher_apps` (minimal shell apps loading web versions) and future `embedded_apps`.
    *   **17/1/2026, 11:11:00**: A minor update to the folder structure example, changing `webos/App3Cat_DEV/` to `webos/3cat_dev/` (and similar for PRE/PRO), making the WebOS naming consistent with Tizen templates.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\README.md`**:
    *   **17/1/2026, 10:37:46**: Provides commands for Tizen app development, including `tizen package` (for `.wgt` files), `sdb devices` (to list devices), and `tizen install`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_dev\gateway\js\app.js`**:
    *   **17/1/2026, 10:45:06**: Defines the `init` function for the Tizen DEV environment. It configures the `REMOTE` URL to `https://smartv-dev.3cat.website/index.html`. It checks for network connectivity and redirects to the `REMOTE` URL if connected, otherwise it displays an alert and registers event listeners for network state changes and exit keys (VK_BACK, VK_EXIT). The Tizen platform version `3.0` is specifically checked.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pre\gateway\js\app.js`**:
    *   **17/1/2026, 10:45:19**: Similar to the DEV version, but configures the `REMOTE` URL to `https://smartv-pre.3cat.website/index.html` for the PRE environment. The logic for network connectivity, redirection, and key handling remains the same.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\package-launcher-apps.cjs`**:
    *   **17/1/2026, 10:56:17 to 22/1/2026, 18:02:56**: This Node.js script is responsible for packaging launcher applications for WebOS and Tizen. It includes functions for parsing CLI arguments (`--platform`, `--env`), generating dates, reading app names from `package.json`, prompting for binary versions, and managing directories.
        *   Initial version includes a `chooseTizenProfile` function to select a security profile for signing.
        *   The script handles WebOS packaging by iterating through 720p and 1080p resolutions, copying templates, updating `appinfo.json` with resolution and version, running `ares-package`, and renaming the output `.ipk` files.
        *   For Tizen, it copies templates, updates `config.xml` with the binary version, and runs `tizen package`.
        *   Minor formatting changes and consistent use of backticks for command strings are observed across multiple commits on **17/1/2026** and **22/1/2026**. The core logic remains consistent, focusing on automating the build and packaging of platform-specific launcher apps.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_dev\config.xml`**:
    *   **17/1/2026, 11:02:30**: Configuration for the Tizen DEV app. Sets widget ID (`http://tizen.tv3.ccma.cat`), version (`3.4.6`), and various Tizen-specific metadata and privileges (e.g., `application.launch`, `internet`, `network.public`). Mentions a `devel.api.version` of `8.0` and a `use.preview` endpoint.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pre\config.xml`**:
    *   **17/1/2026, 11:03:00**: Configuration for the Tizen PRE app. Identical to the DEV `config.xml` except for the `tizen:application id` attribute which is `PMVOmA9N8K.3Cat`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_dev\.project`**:
    *   **17/1/2026, 11:16:08**: Sets the project name to `3catdev`.
    *   **17/1/2026, 11:16:32**: Changes the project name from `3catdev` to `3catDev`.
    *   **17/1/2026, 11:20:39**: Reverts the project name from `3catDev` back to `3cat_dev`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pre\.project`**:
    *   **17/1/2026, 11:16:17**: Sets the project name to `3cat_pre`.
    *   **17/1/2026, 11:16:26**: Changes the project name from `3cat_pre` to `3catPre`.
    *   **17/1/2026, 11:20:59**: Reverts the project name from `3catPre` back to `3cat_pre`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_dev\.project`**:
    *   **17/1/2026, 11:20:30**: Initial content setting the project name to `3cat_dev` for WebOS.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_dev\gateway\js\app.js`**:
    *   **17/1/2026, 11:21:52**: Defines the `init` function for WebOS DEV environment. It determines the correct connection manager service based on SDK version and sets the `REMOTE` URL to `https://smartv-dev.3cat.website/index.html`. It handles network connectivity, redirects if connected, or displays an alert and registers for network state changes and a back key (VK_BACK). A specific query parameter `?pr=true` is added if the SDK version is below 3.50.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_pre\.project`**:
    *   **17/1/2026, 11:34:16**: Sets the project name to `3cat_pre` for WebOS.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_pre\appinfo.json`**:
    *   **17/1/2026, 11:34:24**: Sets basic app info like `title` ("3Cat_pre"), `version` ("2.4.3"), `id` ("cat.3cat.webos"), and `resolution` ("1920x1080").
    *   **17/1/2026, 11:35:20**: Changes the `id` from `cat.3cat.webos` to `com.mediapro.3cat`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_dev\appinfo.json`**:
    *   **17/1/2026, 11:34:33**: Sets basic app info like `title` ("3Cat_dev"), `version` ("2.4.3"), `id` ("cat.3cat.webos"), and `resolution` ("1920x1080").
    *   **17/1/2026, 11:35:29**: Changes the `id` from `cat.3cat.webos` to `com.mediapro.3cat`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_pre\gateway\js\app.js`**:
    *   **17/1/2026, 11:36:57**: Similar to the DEV WebOS version, sets the `REMOTE` URL to `https://smartv-pre.3cat.website/index.html` for the PRE environment.
    *   **17/1/2026, 11:43:23**: Adds a `query` parameter `?pr=true` to the `REMOTE` URL redirection for the PRE environment, if the SDK version is below 3.50.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\platformUtils.js`**:
    *   **17/1/2026, 12:23:41 to 20/1/2026, 11:56:50**: This file defines global utility functions related to platform detection and resolution configuration.
        *   Initial version includes support for "browser", "tizen", "webos", "hisense", "lg", and "hbbtv" platforms, with specific logic for injecting `webOSTV.js` for WebOS. It also defines `configurePlatformResolution` to set `AppGlobal.scale` and body classes based on screen resolution (720p, 1080p, 2160p). `getOSVersion` fetches platform-specific OS versions.
        *   **17/1/2026, 12:31:11**: Adds `WebOS` (capitalized) to the user agent check for `webos` platform detection.
        *   **17/1/2026, 12:31:32**: Removes "hisense" from the list of platform strings in the comment, but the code logic remains to detect "Hisense" in the user agent.
        *   **17/1/2026, 12:32:29**: Introduces a `platformOverride` parameter to `getPlatform` to allow overriding the detected platform using a query string.
        *   **17/1/2026, 12:33:58**: Removes the "hisense" case from the `getOSVersion` switch statement.
        *   **17/1/2026, 12:43:11**: Refactors `getPlatform` to read `platform` from `window.location.search` first, then fall back to user agent detection.
        *   **20/1/2026, 11:07:34**: Introduces a `return borwser` statement, likely a typo that was immediately corrected.
        *   **20/1/2026, 11:07:44**: Corrects the typo to `return "browser";` in a specific branch of `getPlatform`.
        *   **20/1/2026, 11:23:38**: Removes the erroneous `return "browser";` statement, restoring the original logic.
        *   **20/1/2026, 11:30:28**: Adds `console.log(window.KeyEvent)` for debugging purposes.
        *   **20/1/2026, 11:56:50**: Removes the `console.log(window.KeyEvent)` statement.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`**:
    *   **17/1/2026, 12:27:06 to 17/1/2026, 12:28:11**: This React component is the main entry point of the application, handling routing, context providers, and initial platform setup.
        *   **17/1/2026, 12:27:06**: Adds `platformOverride` parameter to `InitApp` in the `App` component's `useEffect`, passing `qsPlatform` (platform from query string).
        *   **17/1/2026, 12:27:35**: Removes `qsPlatform` parameter from `InitApp` call.
        *   **17/1/2026, 12:27:45**: Adds `qsPlatform` parameter back to `InitApp` call.
        *   **17/1/2026, 12:28:11**: Adds `qsPlatform` parameter back to `InitApp` call, after a previous change removed it.
        *   **17/1/2026, 12:43:32**: Removes the `qsPlatform` variable and parameter passing to `InitApp`. This indicates `Platform.getPlatform()` now handles query string parsing internally.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\platform.js`**:
    *   **17/1/2026, 12:37:07**: Centralized platform initialization and keyboard handling logic. It imports platform-specific devices (TizenDevice, WebosDevice, HbbTVDevice, BrowserDevice) and keyboard navigation functions. `Platform.getPlatform` is assigned `window.PlatformUtils.getPlatform`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`**:
    *   **17/1/2026, 12:57:09**: Defines `IinitKeyboardNavigation_SmartTV` for generic Smart TV keyboard navigation. It includes key codes for UP, DOWN, LEFT, RIGHT, ENTER, and a range of BACK/EXIT keys (PC browser, Samsung Tizen, LG WebOS, Hisense, TIVO, VK_ESCAPE, VK_BACK_SPACE). It dispatches custom navigation events and calls `AppGlobal.Actions.openExitAppModal` on back key presses.
    *   **17/1/2026, 12:59:31**: Corrects key codes, specifically changing `0x1cd` to `461` for TIVO back key and `0xa6` to `166` and `0x1b` to `27` for VK_ESCAPE/VK_BACK_SPACE. It also comments out `case 10182` (EXIT key for Samsung).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\package.json`**:
    *   **20/1/2026, 11:00:55**: Updates the package metadata (`version`, `build`, `date`). Significantly expands the `scripts` section, adding comprehensive commands for:
        *   `upgrade`: scripts to update version, build number, date, and environment variables.
        *   `dev` and `dev-local`: local development modes with different Vite modes.
        *   `build:webos`, `build:tizen`, `build:smarttv:dev/pre/prod`: base and SmartTV platform-specific builds.
        *   `build:hbbtv`: HbbTV builds.
        *   `preview`: preview commands for built `dist` directories.
        *   `package:launcher_app`: detailed commands for packaging launcher apps for WebOS and Tizen across DEV/PRE/PRO environments, and aggregated "all" commands.
        *   `package:embedded_app`: placeholder "TODO" commands for future embedded app packaging.
        *   `build:smarttv:hosted_webapp` / `build:hbbtv:hosted_webapp`: commands for building hosted web applications for SmartTV and HbbTV across environments.
        *   `deploy`: commands for deploying hosted web apps to Google Cloud Storage (GCS) buckets, including cache control headers.

*   **`c:\tizen-studio-data\profile\profiles.xml`**:
    *   **21/1/2026, 11:41:12**: Defines two Tizen security profiles: `SHTV_PARTNER` and `SHTV_PUBLIC`, each with paths to `author.p12` and `distributor.p12` certificate files. There's a duplicate `SHTV_PUBLIC` entry referencing `CCMA` certificates.
    *   **21/1/2026, 11:41:44**: Corrects the duplicate `SHTV_PUBLIC` entry by renaming the second one to `CCMA`, making it a distinct security profile.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\libs\img.js`**:
    *   **21/1/2026, 12:24:48 to 21/1/2026, 15:40:18**: This file contains image utility functions for generating image proxy URLs and selecting the best image from a list based on various criteria.
        *   Initial version (12:24:48) has `getImgProxyUrl` commented out and returning `options.imgUrl`, indicating direct URL usage. `getBestImage` includes a `forceFormat` parameter which is now processed as an array of formats. `getBestImageV2` is more complex, handling desired aspect ratios and filtering `NOT_ALLOWED_FORMATS`.
        *   **21/1/2026, 12:43:50**: Modifies `getBestImage` to handle `forceFormat` as an array or a single string.
        *   **21/1/2026, 12:44:45**: No significant content change, likely a re-save or minor formatting.
        *   **21/1/2026, 12:48:14**: Uncomments and reactivates `getImgProxyUrl` to generate proxy URLs using `window.appConfig.IMGPROXY_URL`.
        *   **21/1/2026, 14:33:41**: Introduces a new `getImgProxyUrl` function (duplicate definition, likely an error or pending refactor) that validates if an image URL is "safe for proxy" (same origin and no search parameters) before applying `IMGPROXY_URL`. The previous `getImgProxyUrl` is still present above it.
        *   **21/1/2026, 14:34:10**: Removes the duplicate `getImgProxyUrl` definition, keeping only the new validated version.
        *   **21/1/2026, 15:26:59**: Modifies `getBestImage` to include `is_external` property in the `bestImage` object.
        *   **21/1/2026, 15:27:06 to 21/1/2026, 15:27:13**: Small changes in how `is_external` is assigned in `getBestImage`, ensuring it's always included.
        *   **21/1/2026, 15:27:33**: Updates `getBestImage` to apply `getImgProxyUrl` only if `bestImage.is_external` is false.
        *   **21/1/2026, 15:29:21**: Removes the `else { return null; }` block from `getBestImage` if `bestImage.is_external` is true, causing it to return `bestImage || ''`. This indicates external images are not processed by the proxy.
        *   **21/1/2026, 15:30:10**: Modifies `getBestImageV2` to also include `is_external` in the `bestImage` object and to apply `getImgProxyUrl` only if `bestImage.is_external` is false.
        *   **21/1/2026, 15:36:09**: Adds `else { return null; }` back to `getBestImage` for the case where `bestPreset` or `bestImage` is null, or if `bestImage.is_external` is true and `IMGPROXY_URL` should not be used. This seems to be a slight rollback or clarification of the previous change.
        *   **21/1/2026, 15:36:29**: Adds `else return null;` back to `getBestImageV2` under the `if (bestPreset && bestImage)` block.
        *   **21/1/2026, 15:37:10**: No discernible code change, likely a re-save.
        *   **21/1/2026, 15:39:37**: The logic in `getBestImage` and `getBestImageV2` for applying `getImgProxyUrl` is refined. It explicitly checks `!bestImage.is_external` *inside* the `if (bestPreset && bestImage)` block.
        *   **21/1/2026, 15:40:18**: No discernible code change, likely a re-save.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\index.jsx`**:
    *   **21/1/2026, 12:44:34**: Uses `generateImageData` to get image data for `PortraitItem`. Includes logic for external content, adjusting image frame height if a `platformLogo` is present. Sets various `data-nav-` attributes for focus management.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\externalContentModal\index.jsx`**:
    *   **21/1/2026, 12:46:58 to 21/1/2026, 13:17:26**: This React component displays a modal for external content.
        *   **21/1/2026, 12:46:58**: Initial version uses `generateImageData` with `'modal-portrait'` format. It displays an `<img>` tag for the image.
        *   **21/1/2026, 12:47:08**: Changes the `forceFormat` parameter in `generateImageData` from a string `'modal-portrait'` to an array `['modal-portrait', 'portrait']`.
        *   **21/1/2026, 12:57:22**: Adds conditional rendering for the image: if `imgData?.image?.file` exists, it uses an `<img>` tag, otherwise, it renders a `<div className="no-image" />`.
        *   **21/1/2026, 13:01:01 to 21/1/2026, 13:01:09**: Minor changes in image rendering logic, specifically for the `imgData?.image?.file` check and the `no-image` div.
        *   **21/1/2026, 13:06:51**: Removes the `img` tag and only renders a `<div className="no-image" />` placeholder, indicating an issue with image display.
        *   **21/1/2026, 13:07:38**: Reverts the previous change, bringing back the conditional rendering of the `<img>` tag.
        *   **21/1/2026, 13:09:03**: Clarifies the `no-image` div condition from `imgData?.image === null` to `(!imgData?.image)`.
        *   **21/1/2026, 13:14:10**: Replaces the direct `<img>` tag with the `ImageCropper` component for displaying `imgData.image.file`.
        *   **21/1/2026, 13:16:48 to 21/1/2026, 13:17:26**: No discernible code change, likely re-saves.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\externalContentModal\styles.scss`**:
    *   **21/1/2026, 13:36:16 to 21/1/2026, 13:52:29**: Styles for the `ExternalContentModal`.
        *   **21/1/2026, 13:36:16**: Initial styles for modal overlay, popup, left/right sections, promo and platform text rows, and buttons. Defines `popupLeft img` to take up 544px height and have `position: absolute`.
        *   **21/1/2026, 13:38:27**: Removes explicit height and object-fit for `.popupLeft img`, meaning it will rely on its parent `ImageCropper` for size.
        *   **21/1/2026, 13:46:14**: No discernible code change, likely a re-save.
        *   **21/1/2026, 13:52:29**: Changes `.platformLogoContainer`'s `position` from `absolute` to `relative` and adds `top: 544px`, attempting to position it directly below the main image within the `popupLeft` container.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\imageCropper\index.jsx`**:
    *   **21/1/2026, 14:06:50 to 21/1/2026, 14:27:28**: This React component is responsible for cropping and displaying images.
        *   **21/1/2026, 14:06:50**: Initial version, calculates image aspect ratio and scales/centers the image within a frame. Includes a `useState` to `showImage` and handles `onError`.
        *   **21/1/2026, 14:07:57**: Removes the ternary `imageSize.h ? imageSize.w / imageSize.h : 1` and directly uses `imageSize.w / imageSize.h`, implying `imageSize.h` is always expected to be non-zero.
        *   **21/1/2026, 14:09:02**: Reverts the `imageAspectRatio` calculation back to `imageSize.h ? imageSize.w / imageSize.h : 1` to handle potential division by zero.
        *   **21/1/2026, 14:09:36**: Reverts the `imageAspectRatio` calculation back to `imageSize.w / imageSize.h`.
        *   **21/1/2026, 14:09:50**: Reverts the `imageAspectRatio` calculation back to `imageSize.h ? imageSize.w / imageSize.h : 1`.
        *   **21/1/2026, 14:10:22**: Reverts the `imageAspectRatio` calculation back to `imageSize.w / imageSize.h`. These rapid changes suggest debugging around aspect ratio handling.
        *   **21/1/2026, 14:24:22**: Sets `imageAspectRatio` to a fixed `1`. This will make the image behave as a square, which is likely not the desired behavior for cropping.
        *   **21/1/2026, 14:25:32**: Reverts `imageAspectRatio` calculation to `imageSize.w / imageSize.h`.
        *   **21/1/2026, 14:26:15**: Adds a new "protection" block at the beginning to return a `<div className="no-image" />` early if essential `imageSource`, `frameSize`, or `imageSize` properties are missing or zero.
        *   **21/1/2026, 14:27:28**: Removes the "protection" block added at 14:26:15, reverting to the previous state.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\settingsContext.jsx`**:
    *   **21/1/2026, 15:47:39**: Introduces `SettingsContextProvider` which fetches settings data via `ApiGetSettings`. It sets global `window.currentGeozone`, `window.AppProfile`, and `window.appConfig.IMGPROXY_URL` from the fetched data. The context only renders children once `loading` is false, ensuring settings are loaded.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\sitecatalystContext.jsx`**:
    *   **23/1/2026, 12:17:56**: `SitecatalystProvider` is defined for analytics tracking. It initializes `staticPagesJson` and `previousPage` refs, sets constants like `OMACCOUNT`, `DEVACCOUNT`, `VISITORID`, `APP_NAME`, `EMPTYVALUE`. It includes functions to set the analytics account, clear variables, get user/device IDs, URLs, and login state. `setPageVars` and `setVideoVars` are used to populate `s` object (likely Adobe Analytics) with specific `eVar` and `prop` values. `setCommonVars` sets global variables, including platform (using `AppGlobal.platform`), device ID, login state, and consent status. `sendPageMark` and `sendVideoMark` trigger analytics calls.
    *   **23/1/2026, 12:18:43**: Modifies `setCommonVars` to explicitly distinguish between 'HbbTV' and 'SmartTV' based on `window.AppGlobal.platform` when setting `s.eVar23` and `s.prop23`.
    *   **23/1/2026, 13:35:06**: Adds `s.eVar10 = s.prop10 = s.eVar24 = s.prop24 = window.AppGlobal.platform;` in `setCommonVars`, explicitly setting platform information in more variables.

**Patterns and Recurring Elements:**

1.  **Platform-Specific Development**: A strong pattern of targeting `tizen` and `webos` platforms is evident.
    *   Separate template directories (`build_templates/tizen/3cat_dev`, `build_templates/webos/3cat_dev`).
    *   Different configuration files (`config.xml` for Tizen, `appinfo.json` for WebOS).
    *   Platform-specific API calls in `app.js` gateway files (e.g., `tizen.systeminfo`, `webOS.service.request`).
    *   Distinct build/packaging commands in `package-launcher-apps.cjs` (using `tizen package` and `ares-package`).
    *   Keyboard navigation also has platform-specific initialization (`IinitKeyboardNavigation_SmartHbbTV` vs `IinitKeyboardNavigation_SmartTV`).
2.  **Environment Configuration**: The DEV, PRE (preproduction), and PRO environments are consistently managed across platforms and build steps.
    *   Separate folders for each environment (`3cat_dev`, `3cat_pre`, `3cat_pro`).
    *   Different remote URLs in `app.js` (`smartv-dev.3cat.website`, `smartv-pre.3cat.website`).
    *   Specific packaging and deployment scripts for each environment.
3.  **Build Automation**: The `package-launcher-apps.cjs` script centralizes the build and packaging logic, including argument parsing, file copying, modification (e.g., updating version in config files), command execution, and file renaming. The `package.json` further orchestrates these scripts.
4.  **Image Handling and Optimization**: Multiple changes in `src\libs\img.js` and components like `PortraitItem` and `ExternalContentModal` show a focus on how images are fetched, processed (e.g., cropping, format removal), and displayed. The introduction and refinement of `getImgProxyUrl` indicate a move towards using an image proxy for optimized delivery. There's also attention to handling external content images differently.
5.  **Analytics Integration**: `sitecatalystContext.jsx` demonstrates integration with Adobe Analytics (Omniture), tracking page views and video events with various custom variables (`eVar`, `prop`) that include platform and user information.
6.  **Global `window.AppGlobal` and `window.PlatformUtils`**: These global objects are used consistently to store application-wide state and utility functions, particularly for platform detection and resolution configuration.
7.  **Version Control and Debugging**: Frequent minor updates and comments, along with console logs (`console.log`, `ajsrConsole.log`), suggest active development and debugging. The `package.json` also includes scripts for `upgrade` and various `dev-local` modes.

The overall theme of the changes points to a mature development cycle for Smart TV applications, covering infrastructure (build templates, packaging scripts), core application logic (platform detection, network handling), UI components (image display, modals), and analytics.

## 1:04:00
The provided log shows a series of changes related to a Smart TV application named "3CAT", focusing on build templates, platform-specific configurations, image handling, and analytics integration. The changes span from January 17th to January 23rd, 2026.

### File-Specific Updates:

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\README.md`**
    *   **17/1/2026, 10:37:02**: Initial addition describing the purpose of the `build_templates` folder, which contains base project templates for 3CAT Smart TV Apps across Tizen and WebOS platforms. It defines structure for `DEV`, `PRE`, `PRO` environments and distinguishes `launcher_app` (minimal shell loading hosted web) from `embedded_app` (future fully embedded). It also details expected build outputs in `dist/launcher_apps/` for both WebOS (.ipk) and Tizen (.wgt) with naming conventions including app name, platform, date, version, environment, and resolution for WebOS.
    *   **17/1/2026, 11:11:00**: Updated the folder structure section to reflect consistent naming for WebOS environments (`3cat_dev`, `3cat_pre`, `3cat_pro`), mirroring the Tizen structure. Previously, WebOS folders were `App3Cat_DEV`, etc.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\README.md`**
    *   **17/1/2026, 10:37:46**: Added specific Tizen CLI commands for packaging (`tizen package`), listing devices (`sdb devices`), and installing (`tizen install`).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_dev\gateway\js\app.js`**
    *   **17/1/2026, 10:45:06**: Introduced JavaScript logic for the Tizen DEV environment. This `init` function sets the `REMOTE` URL to `https://smartv-dev.3cat.website/index.html`. It checks network connectivity using `webapis.network.isConnectedToGateway()`. If connected, it redirects to the `REMOTE` URL. If not, it displays an alert, registers back/exit keys for the TV remote, and adds a network state change listener to redirect once connected.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pre\gateway\js\app.js`**
    *   **17/1/2026, 10:45:19**: Similar to the `_dev` version, but configured for the PRE environment, setting the `REMOTE` URL to `https://smartv-pre.3cat.website/index.html`. The core logic for network check, key handling, and redirection remains the same.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\package-launcher-apps.cjs`**
    *   **17/1/2026, 10:56:17**: Initial addition of a Node.js script for packaging launcher applications. This script parses CLI arguments for `platform` and `env`, prompts for a binary version, reads app name from `package.json`, and handles packaging for WebOS (multi-resolution .ipk files, updating `appinfo.json`) and Tizen (.wgt files, updating `config.xml`). It includes functions for directory management, package listing, and Tizen security profile selection.
    *   **17/1/2026, 10:57:03**: Minor change, likely whitespace or comment adjustment, as the code appears identical to the previous version.
    *   **22/1/2026, 17:59:52**, **18:00:20**, **18:01:35**, **18:02:56**: These timestamps show minor changes (likely formatting or trivial edits) in the Node.js packaging script, as the content is virtually identical across these entries. The core logic for WebOS multi-resolution packaging and Tizen packaging with version updates and security profile prompts remains consistent.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_dev\config.xml`**
    *   **17/1/2026, 11:02:30**: Added a Tizen `config.xml` file for the DEV environment, specifying application ID (`i40jdPIQJb.3Cat`), package, required version (3.0), content (`index.html`), screen features, and various Tizen privileges (e.g., `application.launch`, `internet`, `tv.inputdevice`). It also includes metadata for prelaunch support, network usage, API version, and a preview endpoint URL.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pre\config.xml`**
    *   **17/1/2026, 11:03:00**: Added a Tizen `config.xml` file for the PRE environment, similar to the DEV version but with a different application ID (`PMVOmA9N8K.3Cat`).

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_dev\.project`**
    *   **17/1/2026, 11:16:08**: Initial addition of a Tizen `.project` file for the DEV environment, defining project name (`3catdev`), build commands (`json.validation.builder`, `org.tizen.web.project.builder.WebBuilder`), and natures (`json.validation.nature`, `org.eclipse.wst.jsdt.core.jsNature`, `org.tizen.web.project.builder.WebNature`).
    *   **17/1/2026, 11:16:32**: Changed the project name from `3catdev` to `3catDev`.
    *   **17/1/2026, 11:20:39**: Changed the project name back to `3cat_dev`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\tizen\3cat_pre\.project`**
    *   **17/1/2026, 11:16:17**: Initial addition of a Tizen `.project` file for the PRE environment, naming it `3cat_pre`.
    *   **17/1/2026, 11:16:26**: Changed the project name from `3cat_pre` to `3catPre`.
    *   **17/1/2026, 11:20:59**: Changed the project name back to `3cat_pre`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_dev\.project`**
    *   **17/1/2026, 11:20:30**: Added a WebOS `.project` file for the DEV environment, naming it `3cat_dev`, specifying WebOS-specific builders and natures.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_dev\gateway\js\app.js`**
    *   **17/1/2026, 11:21:52**: Introduced JavaScript logic for WebOS DEV environment. This `init` function sets the `REMOTE` URL to `https://smartv-dev.3cat.website/index.html`. It uses `webOS.service.request` to get system info (SDK version) and network status. Based on SDK version, it adapts connection manager service and redirects to `REMOTE` if connected, or displays an alert and subscribes to network state changes if not.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_pre\.project`**
    *   **17/1/2026, 11:34:16**: Added a WebOS `.project` file for the PRE environment, naming it `3cat_pre`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_pre\appinfo.json`**
    *   **17/1/2026, 11:34:24**: Initial addition of `appinfo.json` for WebOS PRE, setting app title `3Cat_pre`, resolution `1920x1080`, version `2.4.3`, and ID `cat.3cat.webos`.
    *   **17/1/2026, 11:35:20**: Updated the app ID from `cat.3cat.webos` to `com.mediapro.3cat`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_dev\appinfo.json`**
    *   **17/1/2026, 11:34:33**: Initial addition of `appinfo.json` for WebOS DEV, setting app title `3Cat_dev`, resolution `1920x1080`, version `2.4.3`, and ID `cat.3cat.webos`.
    *   **17/1/2026, 11:35:29**: Updated the app ID from `cat.3cat.webos` to `com.mediapro.3cat`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\build_templates\webos\3cat_pre\gateway\js\app.js`**
    *   **17/1/2026, 11:36:57**: Similar to the `_dev` version, but configured for the PRE environment, setting the `REMOTE` URL to `https://smartv-pre.3cat.website/index.html`.
    *   **17/1/2026, 11:43:23**: Modified the `REMOTE` URL redirection to include a query parameter `?pr=true`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\utils\platformUtils.js`**
    *   **17/1/2026, 12:23:41**: Added utility functions for platform detection (`getPlatform`), user agent retrieval, and resolution configuration (`configurePlatformResolution`). It defines `window.AppGlobal` for shared application state and `window.PlatformUtils` for utilities. Platform detection relies on user agent strings for HbbTV, Tizen, WebOS, Hisense, and LG NetCast. It also includes `getOSVersion` logic for various platforms.
    *   **17/1/2026, 12:31:11**: Modified `getPlatform` to include "WebOS" in the user agent check alongside "Web0S". Removed "hisense" from `getPlatform`'s platform detection strings in the comment, but not from the actual logic.
    *   **17/1/2026, 12:31:32**: Removed "hisense" from the list of platform strings in the comment for `getPlatform`.
    *   **17/1/2026, 12:32:29**: Introduced a `platformOverride` parameter to `getPlatform` allowing the platform to be explicitly set from a query string, overriding user agent detection.
    *   **17/1/2026, 12:33:58**: Removed `hisense` from the `switch` statement in `getOSVersion`.
    *   **17/1/2026, 12:43:11**: Refactored `getPlatform` to extract `qsPlatform` from `window.location.search` directly within the function, removing the `platformOverride` parameter.
    *   **20/1/2026, 11:07:34**: Removed a `return borwser` statement, which was likely a typo and incorrect, ensuring the `platform` variable is returned.
    *   **20/1/2026, 11:07:44**: Corrected the `return` statement to `return "browser";` if no specific platform is detected.
    *   **20/1/2026, 11:23:38**: Removed the `return "browser";` statement, as the default `platform` variable is initialized to "browser" and returned if no other platform is detected.
    *   **20/1/2026, 11:30:28**: Added `console.log(window.KeyEvent)` for debugging.
    *   **20/1/2026, 11:56:50**: Removed `console.log(window.KeyEvent)`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\App.jsx`**
    *   **17/1/2026, 12:27:06**: Introduced the main React application component (`App.jsx`). It sets up React Router routes for various application views (e.g., `WelcomeScreen`, `Collection`, `PlayerLoader`). It initializes global `AppGlobal.Actions` and `window.appConfig`, and defines `BuildInfo` component for displaying debug information. It uses multiple context providers (Auth, Broadcast, History, Sitecatalyst, Capabilities, Options, Didomi, ParentalControl, Settings, Texts, Highlight). It also has logic for handling exit/logout modals and platform-specific redirection. The `InitApp` function now accepts `platformOverride`.
    *   **17/1/2026, 12:27:35**: Removed the `platformOverride` parameter from `InitApp` function call in `useEffect`.
    *   **17/1/2026, 12:27:45**: Minor, likely whitespace or comment adjustment.
    *   **17/1/2026, 12:28:11**: Reinstated the `platformOverride` parameter to `InitApp` function call within `useEffect`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\platform.js`**
    *   **17/1/2026, 12:37:07**: Defines `Platform` object with methods `initPlatform` (to initialize specific device handlers like TizenDevice, WebosDevice, HbbTVDevice, BrowserDevice), `initKeyboard` (to set up keyboard navigation based on platform), and `launchApp` (to launch other apps on Tizen/WebOS). It directly imports `PlatformUtils.getPlatform`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\platform\generic.js`**
    *   **17/1/2026, 12:57:09**: Added `IinitKeyboardNavigation_SmartTV` function for generic Smart TV keyboard navigation. It registers an `actionFunction` for the ENTER key to simulate a click on the focused element. It also defines `onKeyDownHandler` to manage arrow key movements, and specific key codes for BACK/EXIT on PC browsers, Samsung Tizen, LG WebOS, Hisense, and TIVO, triggering `goBackHistory` or `openExitAppModal`.
    *   **17/1/2026, 12:59:31**: Corrected key codes for `VK_ESCAPE` (from `0xa6` to `27`) and `VK_BACK_SPACE` (from `0x1b` to `27`), and added `461` for TIVO as a back key. The previous `0x1cd` was mistakenly commented as TIVO.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\package.json`**
    *   **20/1/2026, 11:00:55**: Updated `package.json` with a new version (`1.0.4`), build number (`328`), and date (`2026-01-16`). It significantly expanded the `scripts` section, categorizing them into:
        *   `UPGRADE`: Scripts to update version, build, date, and environment.
        *   `LOCAL DEVELOPMENT MODES`: Various `vite` development commands.
        *   `BASE DEVICE BUILDS`: `vite build` commands for `webos` and `tizen`.
        *   `SMARTTV BUILDS` and `HBBTV BUILDS`: Specific `vite build` commands for different environments (`dev`, `pre`, `prod`) with distinct output directories.
        *   `PREVIEW`: `vite preview` commands for serving built `dist` folders.
        *   `LINTING`: `eslint` command.
        *   `DEVICE PACKAGING: LAUNCHER APPS`: Comprehensive `node package-launcher-apps.cjs` commands for WebOS and Tizen, across all environments and a combined "all" script.
        *   `DEVICE PACKAGING: EMBEDDED APPS (TODO)`: Placeholder scripts for future embedded app packaging.
        *   `HOSTED WEBAPP BUILDS`: `vite build` commands for hosted webapps with specific output directories.
        *   `DEPLOY HOSTED WEBAPPS (GCS)`: `gsutil` commands for deploying hosted webapps to Google Cloud Storage buckets for `dev`, `pre`, `prod` environments across SmartTV and HbbTV.
        *   Dependencies and devDependencies were also updated.

*   **`c:\tizen-studio-data\profile\profiles.xml`**
    *   **21/1/2026, 11:41:12**: This file contains Tizen security profiles. An entry for `SHTV_PUBLIC` with certificate paths under `C:\Users\Usuario\SamsungCertificate\CCMA\` was added.
    *   **21/1/2026, 11:41:44**: The `SHTV_PUBLIC` profile with CCMA certificates was renamed to `CCMA`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\libs\img.js`**
    *   **21/1/2026, 12:24:48**: Introduced functions for image handling, including `getImgProxyUrl` (which appears commented out but returns `options.imgUrl`), `removeItemsFromArray`, `getBestImage` (to find the most suitable image based on dimensions, aspect ratio, and priority formats), `getBestImageV2` (an enhanced version considering landscape/portrait and excluding more formats), `getLogoImage`, `getImageByFormat`, `generateImageData`, and `generateImageDataFromLiveChannelInHome_v2`. It defines `IMGPROXY_PRESETS` for various image widths and `NOT_ALLOWED_FORMATS`.
    *   **21/1/2026, 12:43:50**: Modified `getBestImage` to handle `forceFormat` as an array of formats or a single string.
    *   **21/1/2026, 12:44:45**: Minor, likely whitespace or comment adjustment.
    *   **21/1/2026, 12:48:14**: Uncommented `getImgProxyUrl` to conditionally use `window.appConfig.IMGPROXY_URL` to construct proxy URLs.
    *   **21/1/2026, 14:33:41**: Refactored `getImgProxyUrl` again. The previous implementation was completely replaced with a new one that checks if `imgUrl` is safe for proxying (same origin and no query parameters) before using `IMGPROXY_URL`.
    *   **21/1/2026, 14:34:10**: Reverted `getImgProxyUrl` to its state before the 14:33:41 change, restoring the simpler `if (window.appConfig.IMGPROXY_URL) ... return null;` logic.
    *   **21/1/2026, 15:26:59**: Modified `getBestImage` to include `is_external: image.is_external || false` in the returned `bestImage` object.
    *   **21/1/2026, 15:27:06**: Corrected `is_external` assignment in `getBestImage` to `is_external: image.is_external`.
    *   **21/1/2026, 15:27:33**: Added a condition `!bestImage.is_external` before applying `getImgProxyUrl` in `getBestImage` (for `bestImage.file` assignment).
    *   **21/1/2026, 15:29:21**: Removed the `else { return null; }` branch when `bestImage.is_external` is true, causing `bestImage.file` not to be proxied but the original file to be returned if `bestPreset` and `bestImage` exist. This essentially means external images might not be proxied. Also added `bestImage.is_external` to `getBestImageV2`.
    *   **21/1/2026, 15:30:10**: Corrected `bestImage.is_external` assignment in `getBestImageV2` for consistency with `getBestImage`.
    *   **21/1/2026, 15:36:09**: Reinstated the `else { return null; }` branch in `getBestImage` for cases where `bestPreset` or `bestImage` is null, or `bestImage.is_external` is true, ensuring `null` is returned if the proxy condition isn't met or no suitable image is found.
    *   **21/1/2026, 15:36:29**: Reinstated the `else return null;` branch in `getBestImageV2` similar to the change in `getBestImage`.
    *   **21/1/2026, 15:37:10**: Removed the explicit `else { return null; }` condition inside the `if (bestPreset && bestImage && !bestImage.is_external)` block in `getBestImage`, simplifying the logic to only apply proxy if internal. The overall `else { return null; }` remains for general null checks.
    *   **21/1/2026, 15:39:37**: Reverted the change made at 15:37:10. Now, the `getImgProxyUrl` is only applied if `bestImage.is_external` is false. If `bestImage.is_external` is true, the original `bestImage.file` is kept.
    *   **21/1/2026, 15:40:18**: Reverted the change made at 15:39:37 in `getBestImage` and `getBestImageV2`. The logic now uses `if (bestPreset && bestImage)` and then conditionally applies `getImgProxyUrl` only if `!bestImage.is_external`, otherwise, it keeps the original URL. If `bestPreset` or `bestImage` is null, it returns null.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\items\rowItems\portraitItem\index.jsx`**
    *   **21/1/2026, 12:44:34**: The `PortraitItem` component was updated to conditionally adjust `imgData.frameSize.h` if the item is external and has a platform logo, to account for a footer. It also makes the `onClick` handler conditional for future/external items.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\externalContentModal\index.jsx`**
    *   **21/1/2026, 12:46:58**: Introduced `ExternalContentModal` component for displaying external content information. It uses `generateImageData` for `modal-portrait` format. It displays title, description, duration, age rating, promo text, platform text, and provides buttons to open external content or continue in the app.
    *   **21/1/2026, 12:47:08**: Modified `generateImageData` call to accept an array `['modal-portrait', 'portrait']` for `forceFormat`.
    *   **21/1/2026, 12:57:22**: Added conditional rendering for `imgData.image?.file` in `popupLeft`, displaying a `<div className="no-image" />` if the image file is not present.
    *   **21/1/2026, 13:01:01**: Minor, likely whitespace or comment adjustment.
    *   **21/1/2026, 13:01:09**: Corrected the `imgData?.image?.file` check to `imgData?.image` for the `<img src=... />` element.
    *   **21/1/2026, 13:06:51**: Removed the explicit `<img src={imgData.image.file} alt={title} className="popupImage" />` and directly rendered `<div className="no-image" />`, which might be a temporary debugging step or an error.
    *   **21/1/2026, 13:07:38**: Reinstated the conditional rendering of the `<img>` tag for `imgData.image?.file` if it exists, along with the `no-image` div.
    *   **21/1/2026, 13:09:03**: Changed the condition for displaying "no-image" from `(!imgData?.image)` to `(imgData?.image === null)`.
    *   **21/1/2026, 13:14:10**: Replaced the direct `<img>` tag with `ImageCropper` component for displaying `imgData.image.file`.
    *   **21/1/2026, 13:16:48**: Changed the condition for displaying "no-image" back to `(!imgData?.image)`.
    *   **21/1/2026, 13:17:10**: Uncommented `import ImageCropper from '../../../imageCropper';` and added `import ImageCropper from '../../../imageCropper';` again in the same file. This indicates a repeated, possibly conflicting, import.
    *   **21/1/2026, 13:17:26**: Corrected the `ImageCropper` import path to `import ImageCropper from '../../imageCropper';`.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\modals\externalContentModal\styles.scss`**
    *   **21/1/2026, 13:36:16**: Initial styling for `externalModalOverlay` and `externalPopup`, defining layout, colors, and font styles for the modal, promo text, platform text, and buttons.
    *   **21/1/2026, 13:38:27**: Removed an `img` rule from `.popupLeft` that explicitly set `width: 428px; height: 544px; object-fit: fill; display: block;`, likely relying on the `ImageCropper` component to handle image sizing.
    *   **21/1/2026, 13:46:14**: Minor, likely whitespace or comment adjustment.
    *   **21/1/2026, 13:52:29**: Changed the `position` of `.platformLogoContainer` from `absolute` to `relative` and added `top: 544px;`. This change would likely visually alter the placement of the platform logo.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\components\imageCropper\index.jsx`**
    *   **21/1/2026, 14:06:50**: Introduced `ImageCropper` component for cropping and displaying images. It handles frame size, image size, optional offsets, and horizontal/vertical centering. It uses `useState` and `useEffect` to manage image visibility and reload on `imageSource` change, displaying a "no-image" div on error.
    *   **21/1/2026, 14:07:57**: Removed a conditional check `imageSize.h ? ... : 1` when calculating `imageAspectRatio`, assuming `imageSize.h` will always be present or non-zero.
    *   **21/1/2026, 14:09:02**: Reinstated the conditional check `imageSize.h ? ... : 1` for `imageAspectRatio` to prevent division by zero.
    *   **21/1/2026, 14:09:36**: Removed the conditional check for `imageAspectRatio` again.
    *   **21/1/2026, 14:09:50**: Reinstated the conditional check for `imageAspectRatio`.
    *   **21/1/2026, 14:10:22**: Removed the conditional check for `imageAspectRatio`.
    *   **21/1/2026, 14:24:22**: Set `imageAspectRatio = 1` unconditionally, which would force a square aspect ratio regardless of original image dimensions. This seems like a potential bug or temporary debug.
    *   **21/1/2026, 14:25:32**: Reverted `imageAspectRatio` calculation to `imageSize.w / imageSize.h`.
    *   **21/1/2026, 14:26:15**: Added an explicit "protection" check at the beginning of the component to return a `no-image` div if essential props (`imageSource`, `frameSize.w/h`, `imageSize.w/h`) are missing, improving robustness.
    *   **21/1/2026, 14:27:28**: Reverted the "protection" check, making the component less robust again.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\settingsContext.jsx`**
    *   **21/1/2026, 15:47:39**: Added `SettingsContextProvider` which fetches application settings using `ApiGetSettings`. It sets `window.currentGeozone`, `window.AppProfile`, and `window.appConfig.IMGPROXY_URL` from the fetched data. It also populates `staticPagesJson` via `setStaticPagesJson` from `useSitecatalyst`. The context ensures children are only rendered once settings are loaded.

*   **`c:\Users\Usuario\Documents\Trabajo\MEDIAPRO\3cat_smarttv\src\contexts\sitecatalystContext.jsx`**
    *   **23/1/2026, 12:17:56**: Initial addition of `SitecatalystProvider` for analytics integration (Adobe SiteCatalyst). It manages `staticPagesJson`, `previousPage`, and defines constants for analytics. It includes functions to set the analytics account (`setAccount`), clear variables (`clearVars`), get user and device IDs, URLs, and login state. It has `setPageVars` for page-specific analytics, `setVideoVars` for video tracking, and `setCommonVars` for general properties. `sendPageMark` and `sendVideoMark` are provided to dispatch analytics events.
    *   **23/1/2026, 12:18:43**: Modified `setCommonVars` to update `s.eVar23` and `s.prop23` to include "HbbTV" or "SmartTV" based on `window.AppGlobal.platform`.
    *   **23/1/2026, 13:35:06**: Modified `setCommonVars` to also set `s.eVar10` and `s.prop10` as `window.AppGlobal.platform`, and `s.eVar24` and `s.prop24` also as `window.AppGlobal.platform`.

### Patterns and Recurring Elements:

1.  **Platform and Environment Specificity**: Many changes revolve around tailoring the application for different platforms (`tizen`, `webos`, `hbbtv`) and environments (`DEV`, `PRE`, `PRO`). This is evident in:
    *   `build_templates` folder structure.
    *   `gateway/js/app.js` files with different remote URLs (`smartv-dev.3cat.website` vs `smartv-pre.3cat.website`).
    *   `config.xml` and `appinfo.json` files with environment-specific IDs and titles.
    *   `package-launcher-apps.cjs` script explicitly handling `webos` and `tizen` builds with resolution and versioning.
    *   `package.json` scripts defining build and package commands for `webos`, `tizen`, and `hbbtv` across multiple environments.
    *   `platformUtils.js` detecting platform based on user agent and `platform.js` initializing platform-specific devices.
    *   `sitecatalystContext.jsx` setting analytics variables based on the detected platform.

2.  **Versioning and Build Process Automation**: The `package-launcher-apps.cjs` script and `package.json` reveal a strong emphasis on automating the build and packaging process, including:
    *   Prompting for binary versions.
    *   Generating date-based filenames (`YYYYMMDD`).
    *   Updating `appinfo.json` (WebOS) and `config.xml` (Tizen) with version and resolution details.
    *   Handling temporary directories and cleaning them up.
    *   Providing a wide array of npm scripts for development, various builds, packaging, and deployment to Google Cloud Storage.

3.  **Image Handling and Optimization**: The `src\libs\img.js` file shows a dedicated module for managing images, including:
    *   `IMGPROXY_PRESETS` for various image sizes.
    *   Functions to select the "best" image based on dimensions, aspect ratio, and specific formats.
    *   Exclusion of certain image formats (`NOT_ALLOWED_FORMATS`).
    *   Conditional use of an image proxy URL (`window.appConfig.IMGPROXY_URL`) for non-external images.

4.  **Global Application State and Utilities**: `window.AppGlobal` and `window.PlatformUtils` are frequently used to store and manage global application state and utility functions, such as platform detection, resolution configuration, and actions.

5.  **React Component Development**: Multiple React components (`App.jsx`, `PortraitItem`, `ExternalContentModal`, `ImageCropper`) are being developed or refined, utilizing hooks (`useState`, `useEffect`, `useMemo`) and context providers for state management and data flow.

6.  **Analytics Integration**: `sitecatalystContext.jsx` indicates a comprehensive integration with Adobe SiteCatalyst for tracking page views and video events, with custom variables for user, device, and platform information.

7.  **Key Handling and Navigation**: `src\platform\generic.js` outlines a generic keyboard navigation system for Smart TVs, handling common remote control keys (arrows, ENTER, BACK/EXIT) and dispatching custom navigation events. Specific key codes for different TV brands (Samsung, LG, Hisense, TIVO) are noted.

8.  **Modal Management**: `ExternalContentModal` and associated styling demonstrate the handling of UI modals, particularly for external content, with specific focus management upon opening and closing.

In summary, the changes reflect ongoing development of a feature-rich Smart TV application, focusing on platform adaptability, efficient build processes, robust image management, comprehensive analytics, and intuitive user interaction through remote control navigation.