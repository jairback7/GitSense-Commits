# Activity Summary for 26/1/2026

## 9:03:52
The log details significant updates across the "3CAT Smart TV" application, primarily focusing on its build and packaging processes, platform-specific adaptations, image handling, and analytics integration. The changes span from January 17, 2026, to January 23, 2026.

### File-Specific Updates:

*   **`build_templates\README.md` (17/1/2026, 10:37:02 and 11:11:00):** This file was updated twice.
    *   The initial update provided a comprehensive overview of the `build_templates` folder, explaining its role in generating 3CAT Smart TV apps for Tizen and WebOS platforms across DEV, PRE, and PRO environments. It detailed the two app types (launcher\_app and future embedded\_app) and outlined the expected output package formats (`.ipk` for WebOS, `.wgt` for Tizen), including naming conventions with date, version, environment, and resolution.
    *   The second update at 11:11:00 modified the folder structure example to standardize `webos` environment template names from `App3Cat_DEV/` to `3cat_dev/`, aligning them with the `tizen` structure.

*   **`build_templates\tizen\README.md` (17/1/2026, 10:37:46):** This file was added or updated to provide specific Tizen CLI commands for packaging (`tizen package`), listing devices (`sdb devices`), and installing packages (`tizen install`).

*   **`build_templates\tizen\3cat_dev\gateway\js\app.js` (17/1/2026, 10:45:06):** This JavaScript file for the Tizen DEV environment configures the remote URL to `https://smartv-dev.3cat.website/index.html`. It includes logic to check network connectivity, redirect to the remote URL if connected, and register back/exit key handlers to exit the application if offline. A specific check for Tizen platform version '3.0' is present.

*   **`build_templates\tizen\3cat_pre\gateway\js\app.js` (17/1/2026, 10:45:19):** Similar to its DEV counterpart, this file for the Tizen PRE environment sets the remote URL to `https://smartv-pre.3cat.website/index.html` and implements network connectivity checks and exit handling.

*   **`package-launcher-apps.cjs` (17/1/2026, 10:56:17; 10:57:03; 22/1/2026, 17:59:52; 18:00:20; 18:01:35; 18:02:56):** This Node.js script is central to the packaging process. It received multiple minor updates, mostly related to fixing partial commits or line endings, maintaining its core functionality throughout.
    *   It defines logic for parsing CLI arguments (`--platform`, `--env`), generating unique package names with date and version, reading the app name from `package.json`, and prompting for a binary version.
    *   It manages output directories (`dist/launcher_apps`), copies template files (`build_templates/{platform}/3cat_{env}`), and updates platform-specific configuration files (`appinfo.json` for WebOS, `config.xml` for Tizen) with resolution and version information.
    *   For WebOS, it generates packages for both 720p and 1080p resolutions. For Tizen, it includes a mechanism to prompt the user to select a security profile for signing PRO packages.
    *   The script uses `execSync` to run platform-specific commands (`ares-package` for WebOS, `tizen package` for Tizen) and includes robust directory management (create, copy, remove).

*   **`build_templates\tizen\3cat_dev\config.xml` (17/1/2026, 11:02:30):** An XML configuration file for the Tizen DEV application. It defines widget properties, access permissions, application ID (`i40jdPIQJb.3Cat`), content source, features (e.g., `screen.size.normal.1080.1920`), metadata for Samsung TV, privileges (e.g., `internet`, `application.launch`), and profile/setting details. The version is `3.4.6`.

*   **`build_templates\tizen\3cat_pre\config.xml` (17/1/2026, 11:03:00):** Similar to the DEV config, this XML for Tizen PRE defines application ID (`PMVOmA9N8K.3Cat`), content, features, metadata, and privileges, also with version `3.4.6`.

*   **`build_templates\tizen\3cat_dev\.project` (17/1/2026, 11:16:08; 11:16:32; 11:20:39):** This XML file defines the Tizen development project. It was updated multiple times, primarily changing the project `<name>` tag from `3catdev` to `3catDev` and finally to `3cat_dev`. It includes builders for JSON validation and Web project, and natures for JSON validation, JavaScript, and Web.

*   **`build_templates\tizen\3cat_pre\.project` (17/1/2026, 11:16:17; 11:16:26; 11:20:59):** Similar to the Tizen DEV project file, this was updated to reflect project name changes from `3cat_pre` to `3catPre` and back to `3cat_pre`.

*   **`build_templates\webos\3cat_dev\.project` (17/1/2026, 11:20:30):** This XML file defines the WebOS development project, setting the name to `3cat_dev`. It specifies builders and natures for WebOS, JavaScript, and common project facets.

*   **`build_templates\webos\3cat_dev\gateway\js\app.js` (17/1/2026, 11:21:52):** This JavaScript file for the WebOS DEV environment handles network connectivity for the hosted web app. It dynamically determines the connection manager service based on SDK version and redirects to `https://smartv-dev.3cat.website/index.html` if connected. If offline, it displays an alert and subscribes to network state changes, also handling the back key (`VK_BACK`).

*   **`build_templates\webos\3cat_pre\.project` (17/1/2026, 11:34:16):** Defines the WebOS PRE project, setting the name to `3cat_pre`.

*   **`build_templates\webos\3cat_pre\appinfo.json` (17/1/2026, 11:34:24; 11:35:20):** This JSON file configures the WebOS PRE application.
    *   Initially, it set the `id` to `cat.3cat.webos` and `title` to `3Cat_pre`.
    *   The subsequent update changed the `id` to `com.mediapro.3cat`, while maintaining other properties like version (`2.4.3`) and resolution (`1920x1080`).

*   **`build_templates\webos\3cat_dev\appinfo.json` (17/1/2026, 11:34:33; 11:35:29):** This JSON file configures the WebOS DEV application.
    *   Initially, it set the `id` to `cat.3cat.webos` and `title` to `3Cat_dev`.
    *   The subsequent update changed the `id` to `com.mediapro.3cat`, with version `2.4.3` and resolution `1920x1080`.

*   **`build_templates\webos\3cat_pre\gateway\js\app.js` (17/1/2026, 11:36:57; 11:43:23):** This file for WebOS PRE handles network connectivity and redirects, similar to its DEV counterpart.
    *   The initial version redirected to `https://smartv-pre.3cat.website/index.html`.
    *   The later update introduced a query parameter `?pr=true` to the remote URL, indicating a potential change in pre-production environment behavior or tracking.

*   **`src\utils\platformUtils.js` (17/1/2026, 12:23:41 to 20/1/2026, 11:56:50; with 10 changes):** This utility file manages platform-specific logic and global application state. It received numerous updates:
    *   Initial changes established `window.AppGlobal` for global state (actions, platform, versions, UI state) and `window.PlatformUtils` for platform-specific functions like `getUserAgent`, `getPlatform`, and `configurePlatformResolution`.
    *   The `getPlatform` function was refined multiple times to:
        *   Initially include "hisense" in the platform detection logic but later remove it.
        *   Accept an optional `platformOverride` argument, allowing the platform to be forced via a query string parameter, which was later removed from the function signature itself (instead, `qsPlatform` is read directly from `window.location.search` within the function).
        *   Corrected `Web0S` to `WebOS` in user agent checks to properly identify LG WebOS devices.
    *   The `getOSVersion` function includes platform-specific logic for WebOS (using `luna://com.webos.service.tv.systemproperty`), Tizen (`tizen.systeminfo.getCapabilities().platformVersion`), browser, Hisense (later removed), LG NetCast, and HbbTV.
    *   Resolution configuration (`configurePlatformResolution`) and body class application (`setBodyResolutionClass`) logic remained consistent, adapting UI scaling based on `window.innerWidth/Height`.
    *   A minor log statement `return borwser` was corrected to be commented out or removed, preventing a syntax error.

*   **`src\App.jsx` (17/1/2026, 12:27:06 to 17/1/2026, 12:28:11; with 4 changes):** This main React component defines the application's structure, routing, and context providers.
    *   Initial changes included the `platformOverride` parameter in `InitApp` to allow platform detection via query string, aligning with the `platformUtils.js` changes.
    *   Subsequent changes removed the `qsPlatform` parameter from `InitApp` calls, indicating a shift for `Platform.getPlatform` to handle query string parsing internally, which was reflected in the `platformUtils.js` updates. The component remained stable in its routing and context setup otherwise.

*   **`src\platform\platform.js` (17/1/2026, 12:37:07):** This file centralizes platform initialization and keyboard handling.
    *   It imports platform-specific device modules (TizenDevice, WebosDevice, HbbTVDevice, BrowserDevice) and keyboard navigation functions (`IinitKeyboardNavigation_SmartHbbTV`, `IinitKeyboardNavigation_SmartTV`).
    *   The `initPlatform` function dispatches to the correct device initializer based on `window.AppGlobal.platform`.
    *   The `initKeyboard` function conditionally initializes HbbTV-specific or generic SmartTV keyboard navigation.
    *   The `launchApp` function provides a unified interface for launching other apps on Tizen and WebOS.
    *   Crucially, `Platform.getPlatform` was explicitly assigned to `window.PlatformUtils.getPlatform`, solidifying the platform detection mechanism.

*   **`src\platform\generic.js` (17/1/2026, 12:57:09; 12:59:31):** This file defines generic SmartTV keyboard navigation.
    *   It sets up `nav.actionFunction` to simulate a click on the focused element.
    *   The `onKeyDownHandler` maps key codes to navigation actions (up, down, left, right) and handles the back/exit key by calling `goBackHistory` or `window.AppGlobal.Actions.openExitAppModal`.
    *   The second update at 12:59:31 corrected the TIVO back key code from `0x1cd` to `461` (which was already present for WebOS TV) and added `VK_ESCAPE` as `27`.

*   **`package.json` (20/1/2026, 11:00:55):** This core configuration file was extensively updated.
    *   The `version`, `build`, and `date` fields were updated to `1.0.4`, `328`, and `2026-01-16 08:40:40` respectively.
    *   Numerous new NPM scripts were added, organized into categories:
        *   **Upgrade:** Scripts for updating version, build number, date, and environment variables.
        *   **Local Development:** Various `vite` commands for local development with different modes.
        *   **Base Device Builds:** `vite build` commands for `webos` and `tizen`.
        *   **SmartTV Builds & HbbTV Builds:** Detailed `vite build` commands for different environments (dev, pre, prod) and output directories.
        *   **Preview:** `vite preview` commands for serving built `dist` folders.
        *   **Device Packaging (Launcher Apps):** Comprehensive `node package-launcher-apps.cjs` commands for WebOS and Tizen across DEV, PRE, PRO environments, including "all" scripts.
        *   **Device Packaging (Embedded Apps):** Placeholder "TODO" scripts for future embedded app packaging.
        *   **Hosted Webapp Builds & Deploy:** Scripts for building hosted web apps to GCS buckets (`gs://smartv-dev`, `gs://hbbtv-dev`, etc.) for different environments, including `Cache-Control` headers for deployment.
    *   Dependencies and devDependencies were also listed.

*   **`c:\tizen-studio-data\profile\profiles.xml` (21/1/2026, 11:41:12; 11:41:44):** This XML file manages Tizen security profiles.
    *   The first entry added a `<profile>` named `SHTV_PUBLIC` with certificate paths under `C:\Users\Usuario\SamsungCertificate\SHTV_PUBLIC`.
    *   The second entry corrected the name of this newly added profile from `SHTV_PUBLIC` to `CCMA`, indicating a change in the certificate profile's identifier. The paths for `author.p12` and `distributor.p12` under `C:\Users\Usuario\SamsungCertificate\CCMA` were also specified.

*   **`src\libs\img.js` (21/1/2026, 12:24:48 to 21/1/2026, 15:40:18; with 10 changes):** This file contains image utility functions. It underwent significant restructuring and refinements.
    *   Initially, `getImgProxyUrl` either returned the original `imgUrl` or a proxy URL, but its logic was commented out. It was then updated to conditionally use `IMGPROXY_URL` only if `window.appConfig.IMGPROXY_URL` exists and the image URL is "safe for proxy" (same origin and no search parameters). If not safe or no proxy URL, it returns the original `imgUrl`.
    *   The `getBestImage` function was enhanced to:
        *   Allow `forceFormat` to be an array of formats for filtering candidate images, not just a single format.
        *   Add an `is_external` property to the `bestImage` object.
        *   The logic for applying the `IMGPROXY_URL` via `getImgProxyUrl` in `getBestImage` and `getBestImageV2` was refined: it now only applies the image proxy if `bestImage.is_external` is false. This prevents external images from being routed through the internal image proxy.
    *   The `getBestImageV2` function also received the `is_external` addition to its `bestImage` object.
    *   The overall goal appears to be better handling of image formats, external content images, and conditional usage of an image proxy.

*   **`src\components\items\rowItems\portraitItem\index.jsx` (21/1/2026, 12:44:34; 12:44:45):** This React component renders a portrait-style item in a row.
    *   It was initially updated to check `item.is_external` and `item.external_content_data` to render a platform logo and adjust image frame height for external content.
    *   A minor change at 12:44:45 seems to be a re-save or insignificant edit as the code content is identical to the previous timestamp.

*   **`src\components\modals\externalContentModal\index.jsx` (21/1/2026, 12:46:58 to 21/1/2026, 13:17:26; with 7 changes):** This React component renders a modal for external content.
    *   The `generateImageData` call was updated to use an array `['modal-portrait', 'portrait']` for `forceFormat`, providing more flexibility in image selection.
    *   Conditional rendering was introduced for the image: if `imgData.image?.file` exists, an `<img>` tag is rendered; otherwise, a `div` with class `no-image` is shown. This was further refined to explicitly check for `imgData?.image?.file` and `(!imgData?.image)` to ensure either an image is displayed or a "no-image" placeholder.
    *   The `ImageCropper` component was explicitly imported and used for rendering the image, replacing a direct `<img>` tag in one of the updates.

*   **`src\components\modals\externalContentModal\styles.scss` (21/1/2026, 13:36:16; 13:38:27; 13:46:14; 13:52:29):** This SCSS file styles the external content modal.
    *   Initial changes simplified the image styling within `.popupLeft` by removing direct `img` width/height/object-fit rules, likely expecting `ImageCropper` to handle it.
    *   A subsequent change (`13:52:29`) adjusted the positioning of `.platformLogoContainer` from `position: absolute; bottom: 0;` to `position: relative; top: 544px;`, indicating a layout adjustment for the platform logo in the modal.

*   **`src\components\imageCropper\index.jsx` (21/1/2026, 14:06:50 to 21/1/2026, 14:27:28; with 7 changes):** This React component handles image cropping and display.
    *   A change at 14:07:57 removed a safety check (`imageSize.h ? imageSize.w / imageSize.h : 1`), assuming `imageSize.h` would always be available. This was then reverted at 14:09:02 to reintroduce the safety check for `imageSize.h`.
    *   Another change at 14:24:22 temporarily set `imageAspectRatio = 1` which was immediately reverted, suggesting a debug or testing modification.
    *   A significant update at 14:26:15 added a **protection** block to return a `no-image` placeholder if essential `imageSource`, `frameSize`, or `imageSize` properties are missing. This improves robustness.
    *   This protection block was then removed at 14:27:28, reverting to the state without explicit checks, implying that the robust check might have been deemed unnecessary or moved elsewhere in the logic flow.

*   **`src\contexts\settingsContext.jsx` (21/1/2026, 15:47:39):** This React context manages application settings.
    *   It fetches settings using `ApiGetSettings`.
    *   Crucially, it sets `window.currentGeozone`, `window.AppProfile`, and `window.appConfig.IMGPROXY_URL` based on fetched data. This indicates that the image proxy URL is now dynamically configured from the API settings, rather than being hardcoded. It also populates `staticPagesJson` for analytics.

*   **`src\contexts\sitecatalystContext.jsx` (23/1/2026, 12:17:56; 12:18:43; 13:35:06):** This React context handles Adobe Sitecatalyst (Omniture) analytics tracking.
    *   Initial updates defined constants like `OMACCOUNT`, `DEVACCOUNT`, `VISITORID`, `APP_NAME`, `EMPTYVALUE`, and functions for setting/clearing variables, getting user/device IDs, URLs, and login states.
    *   The `setCommonVars` function was updated to set `s.eVar23` and `s.prop23` to `HbbTV_3cat` or `SmartTV_3cat` based on `window.AppGlobal.platform`, indicating platform-specific tracking.
    *   A new update at 13:35:06 introduced `s.eVar10 = s.prop10 = s.eVar24 = s.prop24 = window.AppGlobal.platform;` in `setCommonVars`, explicitly tracking the platform as `eVar10` and `eVar24` for broader analytics.

### Patterns and Recurring Elements:

*   **Platform-Specific Logic:** A dominant pattern is the strong segregation and adaptation of code for different Smart TV platforms, primarily Tizen and WebOS, and also HbbTV. This is evident in:
    *   Separate template directories (`build_templates/tizen`, `build_templates/webos`).
    *   Distinct configuration files (`config.xml` for Tizen, `appinfo.json` for WebOS).
    *   Platform-specific JavaScript in gateway apps (`app.js`) to handle network checks and remote URL loading.
    *   The `package-launcher-apps.cjs` script explicitly handles WebOS (multi-resolution `.ipk` packages using `ares-package`) and Tizen (`.wgt` packages using `tizen package`).
    *   `platformUtils.js` and `platform.js` centralize platform detection and initialization, including loading platform-specific SDKs (e.g., `webOSTV.js`).
    *   Analytics context (`sitecatalystContext.jsx`) also incorporates platform-specific tracking.
*   **Environment Configuration:** The application clearly distinguishes between `DEV`, `PRE`, and `PRO` environments, affecting:
    *   Folder structures (`3cat_dev`, `3cat_pre`, `3cat_pro`).
    *   Remote URLs in gateway `app.js` files.
    *   Build and deployment scripts in `package.json` and `package-launcher-apps.cjs`.
*   **Image Handling and Optimization:** There is a dedicated `src/libs/img.js` file for managing images, including:
    *   `IMGPROXY_PRESETS` for different image widths.
    *   Functions (`getBestImage`, `getBestImageV2`, `getLogoImage`, `getImageByFormat`) to select the most appropriate image based on dimensions, formats, and priority (e.g., `has_text`).
    *   Conditional use of an image proxy (`window.appConfig.IMGPROXY_URL`) to generate optimized image URLs, with logic to prevent external images from being proxied.
*   **Modals and UI Components:** Common UI elements like `PortraitItem` and `ExternalContentModal` are React components with styling (`.scss`). `ExternalContentModal` shows particular attention to rendering external content details, including platform logos and promotional text, and handling missing image data.
*   **Build Automation:** The `package.json` scripts show a strong emphasis on build automation using `vite` and custom Node.js scripts for versioning, building, and packaging for various platforms and environments. Google Cloud Storage (`gsutil`) is used for deploying hosted web applications.
*   **Keyboard Navigation:** Generic Smart TV keyboard navigation is implemented (`src\platform\generic.js`) with mappings for common keys (arrows, enter, back/exit) and event dispatching.
*   **Global State and Utilities:** `window.AppGlobal` and `window.PlatformUtils` are extensively used for managing global application state, platform information, and utility functions, often initialized or updated dynamically.
*   **Analytics Integration:** Adobe Sitecatalyst is integrated via `SitecatalystProvider` to track page views and video events, with platform-specific context for data collection.

## 10:04:00
This log details changes in a Smart TV application project named "3CAT Smart TV Apps," focusing on build processes, platform utilities, image handling, and UI components, spanning from January 17, 2026, to January 23, 2026.

**File-specific updates:**

*   **`build_templates\README.md` (17/1/2026, 10:37:02 and 11:11:00):** This file, describing the base project templates, was updated twice. The first update provided an initial overview of the folder structure (tizen/3cat\_dev, 3cat\_pre, 3cat\_pro and webos/App3Cat\_DEV, App3Cat\_PRE, App3Cat\_PRO) and expected output filenames for launcher apps. The second update streamlined the folder structure examples for `webos` to match the `tizen` pattern (webos/3cat\_dev, 3cat\_pre, 3cat\_pro), removing the "App" prefix.

*   **`build_templates\tizen\README.md` (17/1/2026, 10:37:46):** This document was introduced, detailing Tizen-specific commands for packaging (`tizen package`), listing devices (`sdb devices`), and installing (`tizen install`) `.wgt` packages.

*   **`build_templates\tizen\3cat_dev\gateway\js\app.js` (17/1/2026, 10:45:06) and `build_templates\tizen\3cat_pre\gateway\js\app.js` (17/1/2026, 10:45:19):** These JavaScript files for Tizen development and pre-production environments initialize the app, checking network connectivity. If connected, they redirect to platform-specific remote URLs (e.g., `https://smartv-dev.3cat.website/index.html` for DEV, `https://smartv-pre.3cat.website/index.html` for PRE). They also implement basic key handling for "Back" and "Exit" to close the application. The content is nearly identical except for the remote URL.

*   **`package-launcher-apps.cjs` (17/1/2026, 10:56:17, 10:57:03, 22/1/2026, 17:59:52, 18:00:20, 18:01:35, 18:02:56):** This Node.js script, responsible for packaging launcher applications, underwent multiple minor changes. Initial versions included `execSync(cmd, { stdio: 'inherit' }); console.log('ðŸ§¹ Removing temporary copy'); removeDirRecursive(tmpDirRes); if (fs.existsSync(tmpDirRes)) fs.rmdirSync(tmpDirRes);` for WebOS packaging and `execSync(cmd,` for Tizen. Subsequent changes were mostly formatting and potentially minor fixes, as the core logic remained consistent. A notable change at 22/1/2026, 18:02:56, simplified the cleanup for Tizen by removing the explicit `fs.rmdirSync(tmpDir)` after `removeDirRecursive(tmpDir)`, as the latter handles directory removal. The script defines functions for parsing CLI arguments, formatting dates, reading app names from `package.json`, prompting for binary versions, managing directories, listing packages, and picking the latest generated package. It supports both WebOS (multi-resolution `.ipk` packages) and Tizen (`.wgt` packages).

*   **`build_templates\tizen\3cat_dev\config.xml` (17/1/2026, 11:02:30) and `build_templates\tizen\3cat_pre\config.xml` (17/1/2026, 11:03:00):** These Tizen configuration files were added, defining widget properties like ID, version (3.4.6), content source (`index.html`), app control operations, application ID (e.g., `i40jdPIQJb.3Cat` for DEV, `PMVOmA9N8K.3Cat` for PRE), required platform version (3.0), features, icons, metadata for prelaunch support, network usage, API version, and search format. Both files include extensive Tizen privileges for various device functionalities. The `id` and `package` attributes are different for DEV and PRE.

*   **`build_templates\tizen\3cat_dev\.project` (17/1/2026, 11:16:08, 11:16:32, 11:20:39):** This Tizen project configuration file was modified, mainly changing the project name from "3catdev" to "3catDev" and finally to "3cat\_dev". It specifies build commands for JSON validation and WebBuilder, and natures for JSON validation, JavaScript, and Tizen Web projects.

*   **`build_templates\tizen\3cat_pre\.project` (17/1/2026, 11:16:17, 11:16:26, 11:20:59):** Similar to the dev version, this Tizen project file also saw name changes from "3cat\_pre" to "3catPre" and back to "3cat\_pre", with consistent build commands and natures.

*   **`build_templates\webos\3cat_dev\.project` (17/1/2026, 11:20:30) and `build_templates\webos\3cat_pre\.project` (17/1/2026, 11:34:16):** These WebOS project configuration files were added, defining project name, build commands (`org.eclipse.wst.common.project.facet.core.builder`, `org.eclipse.wst.jsdt.core.javascriptValidator`, `com.webos.ide.nature.WebOSBuilder`, `org.eclipse.wst.validation.validationbuilder`), and natures specific to WebOS development.

*   **`build_templates\webos\3cat_dev\gateway\js\app.js` (17/1/2026, 11:21:52) and `build_templates\webos\3cat_pre\gateway\js\app.js` (17/1/2026, 11:36:57, 11:43:23):** These JavaScript files for WebOS similarly initialize the app, checking network connectivity and redirecting to platform-specific remote URLs (e.g., `https://smartv-dev.3cat.website/index.html` for DEV, `https://smartv-pre.3cat.website/index.html` for PRE). They handle different WebOS SDK versions and use `webOS.platformBack()` for key events. The PRE version received an update to append `?pr=true` to the `REMOTE` URL for a specific query string parameter.

*   **`build_templates\webos\3cat_pre\appinfo.json` (17/1/2026, 11:34:24, 11:35:20) and `build_templates\webos\3cat_dev\appinfo.json` (17/1/2026, 11:34:33, 11:35:29):** These WebOS `appinfo.json` files define application metadata such as `appDescription`, `icon`, `main`, `title`, `type`, `resolution`, `version` (2.4.3), `vendor`, and `id`. Both DEV and PRE versions were updated to change the `id` from `cat.3cat.webos` to `com.mediapro.3cat`.

*   **`src\utils\platformUtils.js` (17/1/2026, 12:23:41, 12:31:11, 12:31:32, 12:32:29, 12:33:58, 12:43:11, 20/1/2026, 11:07:34, 11:07:44, 11:23:38, 11:30:28, 11:56:50):** This utility file, central to platform detection and resolution configuration, underwent numerous small changes. Early versions included "hisense" as a platform string, which was later removed. The `getPlatform` function was refined to accept an optional `platformOverride` from query strings, allowing dynamic platform simulation for testing (first introduced at 17/1/2026, 12:32:29, then moved query string parsing inside the function at 12:43:11). Later changes removed a `return browser` statement and added console logs for `window.KeyEvent` (20/1/2026, 11:30:28), then removed the `console.log(window.KeyEvent)` statement (20/1/2026, 11:56:50). The core functionality remains: detecting platform (HbbTV, Tizen, WebOS, LG NetCast, browser), injecting `webOSTV.js` for WebOS, configuring display resolution, and retrieving OS version via platform-specific APIs.

*   **`src\App.jsx` (17/1/2026, 12:27:06, 12:27:35, 12:27:45, 12:28:11, 12:43:32):** This React main application file also saw several minor, mostly structural and formatting changes. Initially, `InitApp` accepted `platformOverride`, which was later removed (17/1/2026, 12:27:35) then re-added (17/1/2026, 12:28:11). The changes primarily affected how the platform is initialized, either directly detecting it or using a query string override. The file manages routing, global actions, debugging console initialization, build information display, and context providers (Auth, Broadcast, History, Sitecatalyst, Capabilities, Options, Didomi, ParentalControl, Settings, Texts, Highlight, Virtualization).

*   **`src\platform\platform.js` (17/1/2026, 12:37:07):** This file was updated to use `window.PlatformUtils.getPlatform` for platform detection, making the `getPlatform` function a direct alias. It also added `launchAppWebOS` for both 'webos' and 'web0s' platforms.

*   **`src\platform\generic.js` (17/1/2026, 12:57:09, 12:59:31):** This file, containing generic Smart TV keyboard navigation logic, was updated to correct the key code for "TIVO" (from `0x1cd` to `461`) and add `27` for `VK_BACK_SPACE`, while commenting out a `VK_ESCAPE` case. It sets up `nav.actionFunction` for handling "Enter" key presses and an `onKeyDownHandler` for navigation (up, down, left, right) and "Back" key actions, including opening an exit modal if not displaying Didomi consent.

*   **`package.json` (20/1/2026, 11:00:55):** This file received a significant update, specifically adding comprehensive `npm run` scripts for various build and packaging tasks. These include scripts for upgrading versions, local development modes (dev, dummy, development, preproduction, production), base device builds for WebOS and Tizen, SmartTV and HbbTV builds for different environments, previewing built distributions, linting, and device packaging for both "launcher apps" (WebOS .ipk and Tizen .wgt for DEV, PRE, PRO) and "embedded apps" (marked as TODO). It also includes scripts for building and deploying hosted web applications to Google Cloud Storage (GCS) for SmartTV and HbbTV environments. The `version`, `build`, and `date` fields were also updated.

*   **`c:\tizen-studio-data\profile\profiles.xml` (21/1/2026, 11:41:12, 11:41:44):** This Tizen Studio configuration file was updated to add a new security profile named "CCMA," defining author and distributor certificate paths and passwords.

*   **`src\libs\img.js` (21/1/2026, 12:24:48, 12:43:50, 12:44:45, 12:47:46, 12:48:14, 15:26:59, 15:27:06, 15:27:13, 15:29:21, 15:30:10, 15:36:09, 15:36:29, 15:37:10, 15:39:37, 15:40:18):** This file, handling image processing and URL generation, saw numerous changes.
    *   Initially, `getImgProxyUrl` returned `options.imgUrl`.
    *   An early change enabled `getImgProxyUrl` to generate a proxy URL if `window.appConfig.IMGPROXY_URL` is set, appending a `presetName` and `extension` (png/jpg).
    *   At 21/1/2026, 12:43:50, `getBestImage` was updated to handle `forceFormat` as an array of formats.
    *   The `getImgProxyUrl` function at 21/1/2026, 14:33:41, was significantly rewritten to include logic for checking if the `imgUrl` is "safe for proxy" (same origin and no query string) before using the IMGPROXY_URL. If not safe or IMGPROXY_URL is not configured, it returns the original `imgUrl`. This change was reverted shortly after.
    *   A series of changes (21/1/2026, 15:26:59 to 15:40:18) focused on ensuring `is_external` property is included in the `bestImage` object returned by `getBestImage` and `getBestImageV2`. Also, the logic for generating image proxy URLs was refined to *only* apply the proxy if `!bestImage.is_external`, preventing external images from being routed through the local proxy.

*   **`src\components\items\rowItems\portraitItem\index.jsx` (21/1/2026, 12:44:34):** This component, responsible for rendering portrait-oriented items in rows, was updated. It calculates image data using `generateImageData` and conditionally adjusts `imgData.frameSize.h` if the item is external and has a platform logo, to make space for the footer. It also includes conditional rendering for audio icons, ranking, future date labels, and external platform logos/icons.

*   **`src\components\modals\externalContentModal\index.jsx` (21/1/2026, 12:46:58, 12:47:08, 12:57:22, 13:01:01, 13:01:09, 13:06:51, 13:07:38, 13:09:03, 13:14:10, 13:16:48, 13:17:10, 13:17:26):** This modal component, displaying information for external content, underwent multiple iterative changes.
    *   The `generateImageData` call for `imgData` was modified to explicitly pass `['modal-portrait', 'portrait']` as `forceFormat`, indicating a preference for image formats (21/1/2026, 12:47:08).
    *   Logic was added to show a "no-image" placeholder `div` if `imgData.image.file` is not available, first using `imgData?.image?.file ? <img...> : <div/>` (12:57:22), then `(imgData?.image === null)` (13:09:03), and finally `(!imgData?.image)` (13:16:48).
    *   The import for `ImageCropper` was commented out then re-added as a relative import (21/1/2026, 13:17:10, 13:17:26).

*   **`src\components\modals\externalContentModal\styles.scss` (21/1/2026, 13:36:16, 13:38:27, 13:46:14, 13:52:29):** This SCSS file styling the external content modal had minor adjustments. A specific change was made at 21/1/2026, 13:52:29, to change the `position` of `.platformLogoContainer` from `absolute` with `bottom: 0` to `relative` with `top: 544px`, affecting the placement of the platform logo within the modal.

*   **`src\components\imageCropper\index.jsx` (21/1/2026, 14:06:50, 14:07:57, 14:09:02, 14:09:36, 14:09:50, 14:10:22, 14:24:22, 14:25:32, 14:26:15, 14:27:28):** This image cropping component received multiple small updates.
    *   The calculation of `imageAspectRatio` was changed from `imageSize.h ? imageSize.w / imageSize.h : 1` to `imageSize.w / imageSize.h` (14:07:57), then back (14:09:02), then back again (14:09:36), and finally restored to the `imageSize.h ? ... : 1` form (14:09:50, 14:10:22, 14:25:32, 14:27:28).
    *   A brief change set `imageAspectRatio` to `1` explicitly (14:24:22).
    *   At 21/1/2026, 14:26:15, a protection check was added to ensure minimum required image and frame size data exists before proceeding with calculations, returning a simple `no-image` div otherwise. This protection was subsequently removed (14:27:28).

*   **`src\contexts\settingsContext.jsx` (21/1/2026, 15:47:39):** This React context file, managing application settings, was updated to directly call `fetchSettings()` instead of using a `setTimeout` of 3000ms, indicating a desire for more immediate settings loading.

*   **`src\contexts\sitecatalystContext.jsx` (23/1/2026, 12:17:56, 12:18:43, 13:35:06):** This React context file for Sitecatalyst (Adobe Analytics) tracking was updated.
    *   At 23/1/2026, 12:18:43, the `setCommonVars` function was modified to dynamically set `s.eVar23` and `s.prop23` based on whether the platform is HbbTV (displaying "HbbTV\_3cat") or other (displaying "SmartTV\_3cat").
    *   At 23/1/2026, 13:35:06, `s.eVar10` and `s.prop10` were added to `setCommonVars`, and `s.eVar24` and `s.prop24` were also set to `window.AppGlobal.platform`, aligning Sitecatalyst tracking with the detected platform.

**Timestamps of significant changes:**

*   **January 17, 2026, around 10:37:** Initial setup and documentation of `build_templates`, including `README.md` and basic `tizen` instructions.
*   **January 17, 2026, around 10:45:** Addition of core JavaScript logic for Tizen DEV/PRE gateway apps, redirecting to remote URLs based on network status.
*   **January 17, 2026, around 10:56 - 18:02 on January 22, 2026:** Iterative development and refinement of `package-launcher-apps.cjs`, including handling WebOS multi-resolution packages, Tizen packages, and security profiles.
*   **January 17, 2026, around 11:02 - 11:20:** Introduction and minor naming changes in Tizen and WebOS `.project` and `config.xml`/`appinfo.json` files, setting up build configurations and application metadata.
*   **January 17, 2026, around 11:21 - 11:43:** Addition and refinement of WebOS DEV/PRE gateway `app.js` logic, including specific SDK version handling and query string additions.
*   **January 17, 2026, around 12:23 - 12:43:** Frequent updates to `src\utils\platformUtils.js` for platform detection, user agent parsing, and resolution configuration, including dynamic platform override via query strings.
*   **January 20, 2026, 11:00:55:** Major update to `package.json`, expanding build and packaging scripts significantly.
*   **January 21, 2026, 11:41:** Addition of "CCMA" Tizen security profile in `profiles.xml`.
*   **January 21, 2026, around 12:24 - 15:40:** Extensive development and refinement of `src\libs\img.js` for image proxying, format filtering, and selection logic, with a focus on handling external images and their URLs.
*   **January 21, 2026, around 12:46 - 13:17:** Iterative changes to `src\components\modals\externalContentModal\index.jsx` and its styles, including image fallback, explicit format selection, and styling adjustments.
*   **January 21, 2026, around 14:06 - 14:27:** Minor fixes and temporary additions/removals in `src\components\imageCropper\index.jsx` related to aspect ratio calculation and data validation.
*   **January 21, 2026, 15:47:39:** Removal of a `setTimeout` from `src\contexts\settingsContext.jsx`, suggesting a change to immediate settings loading.
*   **January 23, 2026, around 12:17 - 13:35:** Updates to `src\contexts\sitecatalystContext.jsx` for improved platform-specific Sitecatalyst tracking variables.

**Patterns or recurring elements:**

*   **Platform-specific implementations:** There is a clear pattern of creating separate templates and JavaScript logic for `tizen` and `webos` platforms, often mirrored between `_dev` and `_pre` environments. This includes distinct remote URLs for each environment (`smartv-dev.3cat.website` vs `smartv-pre.3cat.website`).
*   **Build Automation and Packaging:** The `package-launcher-apps.cjs` script and `package.json` reveal a strong emphasis on automated build and packaging for different platforms and environments, producing `.ipk` (WebOS) and `.wgt` (Tizen) files. The process involves copying templates, modifying configuration files (`appinfo.json`, `config.xml`), running platform-specific commands (`ares-package`, `tizen package`), and renaming output files.
*   **Image Handling and Optimization:** The `src\libs\img.js` file and related components (`PortraitItem`, `ExternalContentModal`, `ImageCropper`) show a recurring need for robust image handling, including selecting the "best" image based on resolution, aspect ratio, and format, and utilizing an image proxy (`IMGPROXY_URL`) for optimization. There's also a specific concern for how external images are handled with the proxy.
*   **Debugging and Logging:** The frequent use of `console.log` statements with `[Platform]` or `[APP]` prefixes, and the presence of `InitDevConsole` and `DebugModalsLauncher` in `App.jsx`, indicate a focus on debugging and providing developer insights.
*   **Global Objects for App State:** `window.AppGlobal` and `window.PlatformUtils` are heavily used to store global application state and utility functions, centralizing platform-specific configurations and actions.
*   **Network Connectivity Checks:** Both Tizen and WebOS gateway applications (`app.js`) include logic to check for internet connectivity before redirecting to the hosted web app, and display alerts or handle reconnections if not available.
*   **Key Event Handling:** Platform-specific `app.js` files and `src\platform\generic.js` include basic keydown event listeners to handle navigation and critical actions like "Back" or "Exit" for Smart TV environments.
*   **Version Management:** The `package.json` includes explicit `version`, `build`, and `date` fields, along with scripts to `upgrade` these, indicating a structured approach to version control.
*   **Analytics Integration:** The `sitecatalystContext.jsx` demonstrates integration with Adobe Analytics (Sitecatalyst) for tracking user activity, including platform-specific variable setting.

## 11:04:23
The code changes detail ongoing development for a multi-platform smart TV application, focusing on platform adaptation, build processes, image handling, and analytics/consent integration.

**File-Specific Updates:**

*   **`appinfo.json` files (`3cat_pre`, `3cat_dev`)**:
    *   Timestamp: January 17, 2026, around 11:35.
    *   These files were configured for WebOS environments, with `3cat_pre` and `3cat_dev` showing distinct titles (`3Cat_pre`, `3Cat_dev`) but identical version (`2.4.3`) and application ID (`com.mediapro.3cat`), indicating environment-specific builds.
*   **`build_templates\webos\3cat_pre\gateway\js\app.js`**:
    *   Timestamp: January 17, 2026, 11:36:57 and 11:43:23.
    *   The `init` function was modified to append a `?pr=true` query parameter to the remote URL (`https://smartv-pre.3cat.website/index.html`). This suggests a specific flag for pre-production or parental control environments. The script checks WebOS SDK versions to use appropriate connection managers (`PALM_MANAGER` or `WEBOS_MANAGER`) and redirects if internet is available, otherwise displays an alert and monitors network status.
*   **`src\utils\platformUtils.js`**:
    *   Timestamps: January 17, 2026 (12:23 - 12:43), January 20, 2026 (11:07 - 11:56), January 26, 2026 (10:40 - 10:44).
    *   This file saw numerous updates to its platform detection logic (`getPlatform`). Initially, it detected "hisense," which was then removed and later fully removed from the OS version retrieval. The `getPlatform` function was refactored to check for a `platform` query parameter to allow overriding the detected platform. There were also temporary, quickly reverted changes related to treating "LG NetCast" as a "browser" platform, and debugging console logs. A significant structural change to `window.AppGlobal` occurred, and a resize event listener for `configurePlatformResolution` was temporarily updated to consider `screen.width`/`height` but then reverted to using `window.innerWidth`/`innerHeight`.
*   **`src\App.jsx`**:
    *   Timestamps: January 17, 2026 (12:27 - 12:43).
    *   The main React application component was modified to align with `platformUtils.js` changes, specifically removing the `platformOverride` parameter from `InitApp()` calls and centralizing platform detection within `Platform.getPlatform()`. There were also minor formatting changes from double to single quotes and back. The component includes extensive routing, context providers, and debugging displays.
*   **`src\platform\platform.js`**:
    *   Timestamp: January 17, 2026, 12:37:07.
    *   Defines the core `Platform` object responsible for initializing platform-specific devices (WebOS, HbbTV, Tizen, Browser) and keyboard navigation. It also includes a `launchApp` method for Tizen and WebOS.
*   **`src\platform\generic.js`**:
    *   Timestamp: January 17, 2026, 12:57:09 and 12:59:31.
    *   The `IinitKeyboardNavigation_SmartTV` function was updated with revised key codes for back/exit actions to accommodate different Smart TV remote controls (e.g., Tizen, WebOS, Hisense). It handles navigation, action triggers, and exiting the app via a modal.
*   **`package.json`**:
    *   Timestamp: January 20, 2026, 11:00:55.
    *   The project version was updated to `1.0.4`, build to `328`, and date to `2026-01-16`. Crucially, new script sections were added for "DEVICE PACKAGING: LAUNCHER APPS" (for WebOS/Tizen, including environment-specific builds), placeholder "EMBEDDED APPS", "HOSTED WEBAPP BUILDS", and "DEPLOY HOSTED WEBAPPS (GCS)" to Google Cloud Storage. This significantly expands the build and deployment capabilities.
*   **`src\libs\img.js`**:
    *   Timestamps: January 21, 2026 (12:24 - 15:40).
    *   Underwent frequent and significant changes related to image handling:
        *   The `getImgProxyUrl` function was activated to use `window.appConfig.IMGPROXY_URL` and refined to include checks for safe URLs (same origin, no query string) before applying the image proxy. It now returns the original URL if not proxied, rather than `null`.
        *   `getBestImage` and `getBestImageV2` were updated to support arrays for `forceFormat` (allowing multiple preferred image formats) and to include an `is_external` property in the `bestImage` object.
        *   A key change was introduced to prevent image proxying for images marked as `is_external` in both `getBestImage` and `getBestImageV2`, ensuring external image URLs are used directly.
*   **`src\components\items\rowItems\portraitItem\index.jsx`**:
    *   Timestamp: January 21, 2026, 12:44:34.
    *   This React component for displaying portrait-oriented items now explicitly accounts for external content by rendering platform logos and external link icons, and adjusting image frame height.
*   **`src\components\modals\externalContentModal\index.jsx`**:
    *   Timestamps: January 21, 2026 (12:46 - 13:17).
    *   This modal component for external content saw iterative changes:
        *   The `forceFormat` parameter for `generateImageData` was expanded to `['modal-portrait', 'portrait']`.
        *   The logic for displaying the main image was refined, including conditional rendering for a "no-image" state and, notably, switching from a direct `<img>` tag to using the `ImageCropper` component for dynamic image display. Import paths for `ImageCropper` were also corrected.
*   **`src\components\modals\externalContentModal\styles.scss`**:
    *   Timestamps: January 21, 2026 (13:36 - 13:52).
    *   Styling for the external content modal was adjusted. Initial explicit image sizing was removed, likely delegating it to the `ImageCropper` component. The `platformLogoContainer`'s positioning was changed from `absolute` with `bottom: 0` to `relative` with `top: 544px`, indicating a layout adjustment.
*   **`src\components\imageCropper\index.jsx`**:
    *   Timestamps: January 21, 2026 (14:06 - 14:27).
    *   This component saw frequent minor changes, primarily toggling the `imageAspectRatio` calculation between a safe division and a raw division. A temporary data validation check at the start of the component was introduced to handle missing props, then reverted.
*   **`src\contexts\settingsContext.jsx`**:
    *   Timestamp: January 21, 2026, 15:47:39.
    *   The `SettingsContextProvider` was updated to fetch application settings (including `IMGPROXY_URL`, `currentGeozone`, `AppProfile`) from an API on mount, making the app configuration dynamic.
*   **`package-launcher-apps.cjs`**:
    *   Timestamps: January 22, 2026 (17:59 - 18:02).
    *   A new Node.js script was added to automate the packaging of WebOS (`.ipk`) and Tizen (`.wgt`) launcher applications. This script handles CLI argument parsing, version injection into `appinfo.json` (WebOS, including multi-resolution builds) and `config.xml` (Tizen), temporary directory management, execution of platform-specific packaging commands (`ares-package`, `tizen package`), and optional Tizen security profile selection for signing.
*   **`src\contexts\sitecatalystContext.jsx`**:
    *   Timestamps: January 23, 2026 (12:17 - 13:35).
    *   The `SitecatalystProvider` was modified to refine how platform information is sent to Adobe Analytics. Specifically, `s.eVar23` and `s.prop23` were updated to explicitly categorize the platform as "HbbTV" or "SmartTV" based on `window.AppGlobal.platform`. New `eVar10` and `eVar24` properties were added to capture the raw `window.AppGlobal.platform` value.
*   **`src\index.scss`**:
    *   Timestamps: January 26, 2026 (10:04 - 10:59).
    *   This CSS file shows persistent adjustments to Didomi (cookie consent) related styling. There were multiple instances of commenting out, adding, and re-adding specific `width` and `height` properties, along with media queries, for `#didomi-host` and its child elements (`.didomi-notice-main`, `.didomi-notice-side`, `.didomi-preferences-main`, `.didomi-preferences-side-menu`). This suggests ongoing challenges or refinements in controlling the display and responsiveness of the consent UI.

**Patterns and Recurring Elements:**

1.  **Platform-Specific Adaptation**: A strong recurring theme is the application's effort to adapt to various Smart TV platforms (WebOS, Tizen, HbbTV, LG NetCast). This is evident in `platformUtils.js` for detection, `generic.js` for keyboard mapping, `appinfo.json` for environment-specific builds, and `sitecatalystContext.jsx` for analytics.
2.  **Image Handling and Optimization**: The `img.js` file, along with components like `externalContentModal` and `imageCropper`, shows a consistent focus on how images are sourced, processed (via image proxy), cropped, and displayed, with special considerations for external content. There's a clear move towards not proxying external images and using a dedicated `ImageCropper` component.
3.  **Build and Deployment Automation**: The `package.json` and `package-launcher-apps.cjs` script highlight a comprehensive approach to automating the build, packaging, and deployment for different environments and platforms, including multi-resolution builds and cloud deployment.
4.  **UI/UX Refinements and Debugging**: Frequent, sometimes rapidly toggled, changes in styling (`index.scss`) and component rendering (`externalContentModal`, `imageCropper`) suggest active UI/UX development and debugging efforts, especially concerning the integration of third-party UI elements like the Didomi consent modal.
5.  **Analytics Integration**: `sitecatalystContext.jsx` demonstrates continuous refinement of data collection for analytics, ensuring platform details are accurately captured.

The log indicates a dynamic development environment with significant work being done on cross-platform compatibility, build pipelines, image rendering, and integration with external services, often involving iterative changes and debugging.