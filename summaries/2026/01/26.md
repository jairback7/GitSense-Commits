# Activity Summary for 26/1/2026

## 9:03:52
The log details significant updates across the "3CAT Smart TV" application, primarily focusing on its build and packaging processes, platform-specific adaptations, image handling, and analytics integration. The changes span from January 17, 2026, to January 23, 2026.

### File-Specific Updates:

*   **`build_templates\README.md` (17/1/2026, 10:37:02 and 11:11:00):** This file was updated twice.
    *   The initial update provided a comprehensive overview of the `build_templates` folder, explaining its role in generating 3CAT Smart TV apps for Tizen and WebOS platforms across DEV, PRE, and PRO environments. It detailed the two app types (launcher\_app and future embedded\_app) and outlined the expected output package formats (`.ipk` for WebOS, `.wgt` for Tizen), including naming conventions with date, version, environment, and resolution.
    *   The second update at 11:11:00 modified the folder structure example to standardize `webos` environment template names from `App3Cat_DEV/` to `3cat_dev/`, aligning them with the `tizen` structure.

*   **`build_templates\tizen\README.md` (17/1/2026, 10:37:46):** This file was added or updated to provide specific Tizen CLI commands for packaging (`tizen package`), listing devices (`sdb devices`), and installing packages (`tizen install`).

*   **`build_templates\tizen\3cat_dev\gateway\js\app.js` (17/1/2026, 10:45:06):** This JavaScript file for the Tizen DEV environment configures the remote URL to `https://smartv-dev.3cat.website/index.html`. It includes logic to check network connectivity, redirect to the remote URL if connected, and register back/exit key handlers to exit the application if offline. A specific check for Tizen platform version '3.0' is present.

*   **`build_templates\tizen\3cat_pre\gateway\js\app.js` (17/1/2026, 10:45:19):** Similar to its DEV counterpart, this file for the Tizen PRE environment sets the remote URL to `https://smartv-pre.3cat.website/index.html` and implements network connectivity checks and exit handling.

*   **`package-launcher-apps.cjs` (17/1/2026, 10:56:17; 10:57:03; 22/1/2026, 17:59:52; 18:00:20; 18:01:35; 18:02:56):** This Node.js script is central to the packaging process. It received multiple minor updates, mostly related to fixing partial commits or line endings, maintaining its core functionality throughout.
    *   It defines logic for parsing CLI arguments (`--platform`, `--env`), generating unique package names with date and version, reading the app name from `package.json`, and prompting for a binary version.
    *   It manages output directories (`dist/launcher_apps`), copies template files (`build_templates/{platform}/3cat_{env}`), and updates platform-specific configuration files (`appinfo.json` for WebOS, `config.xml` for Tizen) with resolution and version information.
    *   For WebOS, it generates packages for both 720p and 1080p resolutions. For Tizen, it includes a mechanism to prompt the user to select a security profile for signing PRO packages.
    *   The script uses `execSync` to run platform-specific commands (`ares-package` for WebOS, `tizen package` for Tizen) and includes robust directory management (create, copy, remove).

*   **`build_templates\tizen\3cat_dev\config.xml` (17/1/2026, 11:02:30):** An XML configuration file for the Tizen DEV application. It defines widget properties, access permissions, application ID (`i40jdPIQJb.3Cat`), content source, features (e.g., `screen.size.normal.1080.1920`), metadata for Samsung TV, privileges (e.g., `internet`, `application.launch`), and profile/setting details. The version is `3.4.6`.

*   **`build_templates\tizen\3cat_pre\config.xml` (17/1/2026, 11:03:00):** Similar to the DEV config, this XML for Tizen PRE defines application ID (`PMVOmA9N8K.3Cat`), content, features, metadata, and privileges, also with version `3.4.6`.

*   **`build_templates\tizen\3cat_dev\.project` (17/1/2026, 11:16:08; 11:16:32; 11:20:39):** This XML file defines the Tizen development project. It was updated multiple times, primarily changing the project `<name>` tag from `3catdev` to `3catDev` and finally to `3cat_dev`. It includes builders for JSON validation and Web project, and natures for JSON validation, JavaScript, and Web.

*   **`build_templates\tizen\3cat_pre\.project` (17/1/2026, 11:16:17; 11:16:26; 11:20:59):** Similar to the Tizen DEV project file, this was updated to reflect project name changes from `3cat_pre` to `3catPre` and back to `3cat_pre`.

*   **`build_templates\webos\3cat_dev\.project` (17/1/2026, 11:20:30):** This XML file defines the WebOS development project, setting the name to `3cat_dev`. It specifies builders and natures for WebOS, JavaScript, and common project facets.

*   **`build_templates\webos\3cat_dev\gateway\js\app.js` (17/1/2026, 11:21:52):** This JavaScript file for the WebOS DEV environment handles network connectivity for the hosted web app. It dynamically determines the connection manager service based on SDK version and redirects to `https://smartv-dev.3cat.website/index.html` if connected. If offline, it displays an alert and subscribes to network state changes, also handling the back key (`VK_BACK`).

*   **`build_templates\webos\3cat_pre\.project` (17/1/2026, 11:34:16):** Defines the WebOS PRE project, setting the name to `3cat_pre`.

*   **`build_templates\webos\3cat_pre\appinfo.json` (17/1/2026, 11:34:24; 11:35:20):** This JSON file configures the WebOS PRE application.
    *   Initially, it set the `id` to `cat.3cat.webos` and `title` to `3Cat_pre`.
    *   The subsequent update changed the `id` to `com.mediapro.3cat`, while maintaining other properties like version (`2.4.3`) and resolution (`1920x1080`).

*   **`build_templates\webos\3cat_dev\appinfo.json` (17/1/2026, 11:34:33; 11:35:29):** This JSON file configures the WebOS DEV application.
    *   Initially, it set the `id` to `cat.3cat.webos` and `title` to `3Cat_dev`.
    *   The subsequent update changed the `id` to `com.mediapro.3cat`, with version `2.4.3` and resolution `1920x1080`.

*   **`build_templates\webos\3cat_pre\gateway\js\app.js` (17/1/2026, 11:36:57; 11:43:23):** This file for WebOS PRE handles network connectivity and redirects, similar to its DEV counterpart.
    *   The initial version redirected to `https://smartv-pre.3cat.website/index.html`.
    *   The later update introduced a query parameter `?pr=true` to the remote URL, indicating a potential change in pre-production environment behavior or tracking.

*   **`src\utils\platformUtils.js` (17/1/2026, 12:23:41 to 20/1/2026, 11:56:50; with 10 changes):** This utility file manages platform-specific logic and global application state. It received numerous updates:
    *   Initial changes established `window.AppGlobal` for global state (actions, platform, versions, UI state) and `window.PlatformUtils` for platform-specific functions like `getUserAgent`, `getPlatform`, and `configurePlatformResolution`.
    *   The `getPlatform` function was refined multiple times to:
        *   Initially include "hisense" in the platform detection logic but later remove it.
        *   Accept an optional `platformOverride` argument, allowing the platform to be forced via a query string parameter, which was later removed from the function signature itself (instead, `qsPlatform` is read directly from `window.location.search` within the function).
        *   Corrected `Web0S` to `WebOS` in user agent checks to properly identify LG WebOS devices.
    *   The `getOSVersion` function includes platform-specific logic for WebOS (using `luna://com.webos.service.tv.systemproperty`), Tizen (`tizen.systeminfo.getCapabilities().platformVersion`), browser, Hisense (later removed), LG NetCast, and HbbTV.
    *   Resolution configuration (`configurePlatformResolution`) and body class application (`setBodyResolutionClass`) logic remained consistent, adapting UI scaling based on `window.innerWidth/Height`.
    *   A minor log statement `return borwser` was corrected to be commented out or removed, preventing a syntax error.

*   **`src\App.jsx` (17/1/2026, 12:27:06 to 17/1/2026, 12:28:11; with 4 changes):** This main React component defines the application's structure, routing, and context providers.
    *   Initial changes included the `platformOverride` parameter in `InitApp` to allow platform detection via query string, aligning with the `platformUtils.js` changes.
    *   Subsequent changes removed the `qsPlatform` parameter from `InitApp` calls, indicating a shift for `Platform.getPlatform` to handle query string parsing internally, which was reflected in the `platformUtils.js` updates. The component remained stable in its routing and context setup otherwise.

*   **`src\platform\platform.js` (17/1/2026, 12:37:07):** This file centralizes platform initialization and keyboard handling.
    *   It imports platform-specific device modules (TizenDevice, WebosDevice, HbbTVDevice, BrowserDevice) and keyboard navigation functions (`IinitKeyboardNavigation_SmartHbbTV`, `IinitKeyboardNavigation_SmartTV`).
    *   The `initPlatform` function dispatches to the correct device initializer based on `window.AppGlobal.platform`.
    *   The `initKeyboard` function conditionally initializes HbbTV-specific or generic SmartTV keyboard navigation.
    *   The `launchApp` function provides a unified interface for launching other apps on Tizen and WebOS.
    *   Crucially, `Platform.getPlatform` was explicitly assigned to `window.PlatformUtils.getPlatform`, solidifying the platform detection mechanism.

*   **`src\platform\generic.js` (17/1/2026, 12:57:09; 12:59:31):** This file defines generic SmartTV keyboard navigation.
    *   It sets up `nav.actionFunction` to simulate a click on the focused element.
    *   The `onKeyDownHandler` maps key codes to navigation actions (up, down, left, right) and handles the back/exit key by calling `goBackHistory` or `window.AppGlobal.Actions.openExitAppModal`.
    *   The second update at 12:59:31 corrected the TIVO back key code from `0x1cd` to `461` (which was already present for WebOS TV) and added `VK_ESCAPE` as `27`.

*   **`package.json` (20/1/2026, 11:00:55):** This core configuration file was extensively updated.
    *   The `version`, `build`, and `date` fields were updated to `1.0.4`, `328`, and `2026-01-16 08:40:40` respectively.
    *   Numerous new NPM scripts were added, organized into categories:
        *   **Upgrade:** Scripts for updating version, build number, date, and environment variables.
        *   **Local Development:** Various `vite` commands for local development with different modes.
        *   **Base Device Builds:** `vite build` commands for `webos` and `tizen`.
        *   **SmartTV Builds & HbbTV Builds:** Detailed `vite build` commands for different environments (dev, pre, prod) and output directories.
        *   **Preview:** `vite preview` commands for serving built `dist` folders.
        *   **Device Packaging (Launcher Apps):** Comprehensive `node package-launcher-apps.cjs` commands for WebOS and Tizen across DEV, PRE, PRO environments, including "all" scripts.
        *   **Device Packaging (Embedded Apps):** Placeholder "TODO" scripts for future embedded app packaging.
        *   **Hosted Webapp Builds & Deploy:** Scripts for building hosted web apps to GCS buckets (`gs://smartv-dev`, `gs://hbbtv-dev`, etc.) for different environments, including `Cache-Control` headers for deployment.
    *   Dependencies and devDependencies were also listed.

*   **`c:\tizen-studio-data\profile\profiles.xml` (21/1/2026, 11:41:12; 11:41:44):** This XML file manages Tizen security profiles.
    *   The first entry added a `<profile>` named `SHTV_PUBLIC` with certificate paths under `C:\Users\Usuario\SamsungCertificate\SHTV_PUBLIC`.
    *   The second entry corrected the name of this newly added profile from `SHTV_PUBLIC` to `CCMA`, indicating a change in the certificate profile's identifier. The paths for `author.p12` and `distributor.p12` under `C:\Users\Usuario\SamsungCertificate\CCMA` were also specified.

*   **`src\libs\img.js` (21/1/2026, 12:24:48 to 21/1/2026, 15:40:18; with 10 changes):** This file contains image utility functions. It underwent significant restructuring and refinements.
    *   Initially, `getImgProxyUrl` either returned the original `imgUrl` or a proxy URL, but its logic was commented out. It was then updated to conditionally use `IMGPROXY_URL` only if `window.appConfig.IMGPROXY_URL` exists and the image URL is "safe for proxy" (same origin and no search parameters). If not safe or no proxy URL, it returns the original `imgUrl`.
    *   The `getBestImage` function was enhanced to:
        *   Allow `forceFormat` to be an array of formats for filtering candidate images, not just a single format.
        *   Add an `is_external` property to the `bestImage` object.
        *   The logic for applying the `IMGPROXY_URL` via `getImgProxyUrl` in `getBestImage` and `getBestImageV2` was refined: it now only applies the image proxy if `bestImage.is_external` is false. This prevents external images from being routed through the internal image proxy.
    *   The `getBestImageV2` function also received the `is_external` addition to its `bestImage` object.
    *   The overall goal appears to be better handling of image formats, external content images, and conditional usage of an image proxy.

*   **`src\components\items\rowItems\portraitItem\index.jsx` (21/1/2026, 12:44:34; 12:44:45):** This React component renders a portrait-style item in a row.
    *   It was initially updated to check `item.is_external` and `item.external_content_data` to render a platform logo and adjust image frame height for external content.
    *   A minor change at 12:44:45 seems to be a re-save or insignificant edit as the code content is identical to the previous timestamp.

*   **`src\components\modals\externalContentModal\index.jsx` (21/1/2026, 12:46:58 to 21/1/2026, 13:17:26; with 7 changes):** This React component renders a modal for external content.
    *   The `generateImageData` call was updated to use an array `['modal-portrait', 'portrait']` for `forceFormat`, providing more flexibility in image selection.
    *   Conditional rendering was introduced for the image: if `imgData.image?.file` exists, an `<img>` tag is rendered; otherwise, a `div` with class `no-image` is shown. This was further refined to explicitly check for `imgData?.image?.file` and `(!imgData?.image)` to ensure either an image is displayed or a "no-image" placeholder.
    *   The `ImageCropper` component was explicitly imported and used for rendering the image, replacing a direct `<img>` tag in one of the updates.

*   **`src\components\modals\externalContentModal\styles.scss` (21/1/2026, 13:36:16; 13:38:27; 13:46:14; 13:52:29):** This SCSS file styles the external content modal.
    *   Initial changes simplified the image styling within `.popupLeft` by removing direct `img` width/height/object-fit rules, likely expecting `ImageCropper` to handle it.
    *   A subsequent change (`13:52:29`) adjusted the positioning of `.platformLogoContainer` from `position: absolute; bottom: 0;` to `position: relative; top: 544px;`, indicating a layout adjustment for the platform logo in the modal.

*   **`src\components\imageCropper\index.jsx` (21/1/2026, 14:06:50 to 21/1/2026, 14:27:28; with 7 changes):** This React component handles image cropping and display.
    *   A change at 14:07:57 removed a safety check (`imageSize.h ? imageSize.w / imageSize.h : 1`), assuming `imageSize.h` would always be available. This was then reverted at 14:09:02 to reintroduce the safety check for `imageSize.h`.
    *   Another change at 14:24:22 temporarily set `imageAspectRatio = 1` which was immediately reverted, suggesting a debug or testing modification.
    *   A significant update at 14:26:15 added a **protection** block to return a `no-image` placeholder if essential `imageSource`, `frameSize`, or `imageSize` properties are missing. This improves robustness.
    *   This protection block was then removed at 14:27:28, reverting to the state without explicit checks, implying that the robust check might have been deemed unnecessary or moved elsewhere in the logic flow.

*   **`src\contexts\settingsContext.jsx` (21/1/2026, 15:47:39):** This React context manages application settings.
    *   It fetches settings using `ApiGetSettings`.
    *   Crucially, it sets `window.currentGeozone`, `window.AppProfile`, and `window.appConfig.IMGPROXY_URL` based on fetched data. This indicates that the image proxy URL is now dynamically configured from the API settings, rather than being hardcoded. It also populates `staticPagesJson` for analytics.

*   **`src\contexts\sitecatalystContext.jsx` (23/1/2026, 12:17:56; 12:18:43; 13:35:06):** This React context handles Adobe Sitecatalyst (Omniture) analytics tracking.
    *   Initial updates defined constants like `OMACCOUNT`, `DEVACCOUNT`, `VISITORID`, `APP_NAME`, `EMPTYVALUE`, and functions for setting/clearing variables, getting user/device IDs, URLs, and login states.
    *   The `setCommonVars` function was updated to set `s.eVar23` and `s.prop23` to `HbbTV_3cat` or `SmartTV_3cat` based on `window.AppGlobal.platform`, indicating platform-specific tracking.
    *   A new update at 13:35:06 introduced `s.eVar10 = s.prop10 = s.eVar24 = s.prop24 = window.AppGlobal.platform;` in `setCommonVars`, explicitly tracking the platform as `eVar10` and `eVar24` for broader analytics.

### Patterns and Recurring Elements:

*   **Platform-Specific Logic:** A dominant pattern is the strong segregation and adaptation of code for different Smart TV platforms, primarily Tizen and WebOS, and also HbbTV. This is evident in:
    *   Separate template directories (`build_templates/tizen`, `build_templates/webos`).
    *   Distinct configuration files (`config.xml` for Tizen, `appinfo.json` for WebOS).
    *   Platform-specific JavaScript in gateway apps (`app.js`) to handle network checks and remote URL loading.
    *   The `package-launcher-apps.cjs` script explicitly handles WebOS (multi-resolution `.ipk` packages using `ares-package`) and Tizen (`.wgt` packages using `tizen package`).
    *   `platformUtils.js` and `platform.js` centralize platform detection and initialization, including loading platform-specific SDKs (e.g., `webOSTV.js`).
    *   Analytics context (`sitecatalystContext.jsx`) also incorporates platform-specific tracking.
*   **Environment Configuration:** The application clearly distinguishes between `DEV`, `PRE`, and `PRO` environments, affecting:
    *   Folder structures (`3cat_dev`, `3cat_pre`, `3cat_pro`).
    *   Remote URLs in gateway `app.js` files.
    *   Build and deployment scripts in `package.json` and `package-launcher-apps.cjs`.
*   **Image Handling and Optimization:** There is a dedicated `src/libs/img.js` file for managing images, including:
    *   `IMGPROXY_PRESETS` for different image widths.
    *   Functions (`getBestImage`, `getBestImageV2`, `getLogoImage`, `getImageByFormat`) to select the most appropriate image based on dimensions, formats, and priority (e.g., `has_text`).
    *   Conditional use of an image proxy (`window.appConfig.IMGPROXY_URL`) to generate optimized image URLs, with logic to prevent external images from being proxied.
*   **Modals and UI Components:** Common UI elements like `PortraitItem` and `ExternalContentModal` are React components with styling (`.scss`). `ExternalContentModal` shows particular attention to rendering external content details, including platform logos and promotional text, and handling missing image data.
*   **Build Automation:** The `package.json` scripts show a strong emphasis on build automation using `vite` and custom Node.js scripts for versioning, building, and packaging for various platforms and environments. Google Cloud Storage (`gsutil`) is used for deploying hosted web applications.
*   **Keyboard Navigation:** Generic Smart TV keyboard navigation is implemented (`src\platform\generic.js`) with mappings for common keys (arrows, enter, back/exit) and event dispatching.
*   **Global State and Utilities:** `window.AppGlobal` and `window.PlatformUtils` are extensively used for managing global application state, platform information, and utility functions, often initialized or updated dynamically.
*   **Analytics Integration:** Adobe Sitecatalyst is integrated via `SitecatalystProvider` to track page views and video events, with platform-specific context for data collection.